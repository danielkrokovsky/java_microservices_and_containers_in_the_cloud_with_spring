<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">

<head>
  <title>CI/CD for Microservice Containers</title>
  <link href="../css/springer_epub.css" rel="styleSheet" type="text/css"/>
</head>

<body>

  <div epub:type="chapter" role="doc-chapter">

    <div class="ChapterContextInformation">

      <div class="ContextInformation" id="b979-8-8688-0555-4_13"><div class="ChapterCopyright">© The Author(s), under exclusive license to APress Media, LLC, part of Springer Nature 2024</div><span class="ContextInformationAuthorEditorNames">B. A. Christudas</span><span class="ContextInformationBookTitles"><span class="BookTitle">Java Microservices and Containers in the Cloud</span></span><span class="ChapterDOI"><a href="https://doi.org/10.1007/979-8-8688-0555-4_13">https://doi.org/10.1007/979-8-8688-0555-4_13</a></span></div>

    </div>

    <!--Begin Abstract-->

    <div class="MainTitleSection">

      <h1 class="ChapterTitle" lang="en">13. CI/CD for Microservice Containers</h1>

    </div>

    <div class="AuthorGroup">

      <div class="AuthorNames"><span class="Author"><span class="AuthorName">Binildas A. Christudas</span><sup><a href="#Aff2">1</a> <span class="ContactIcon"> </span></sup></span></div>

      <div class="Affiliations">

        <div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">NBCRA 45, Christbin, Thiruvananthapuram, Kerala, India</div></div>

        <div class="ClearBoth"> </div>

      </div>

    </div>

    <!--End Abstract-->

    <div class="Fulltext">

      <p class="Para" id="Par2">When the number of microservices and the number of deployment environments increase, you have to deal with many <span id="ITerm1">YAML files</span>. In the last chapter, you learned that Helm is a handy tool that maintains a single deployment YAML file with version information. This file lets you set up and manage very large Kubernetes clusters with a few commands.</p>

      <p class="Para" id="Par3">Another problem with a large number of <span id="ITerm2">microservices</span> is that you can have as many teams building code as you have microservices, if you need true parallelism to improve release speed. An app is an aggregate of many microservices, and code changes must be regularly built, tested, and merged to a shared repository. You may have a <span id="ITerm3">single repository</span> or <span id="ITerm4">multiple repositories</span> for an app, such as a separate repository for each microservice. When there are many branches in a single repository, this can lead to merge conflicts in the build cycles. If there are multiple repositories, there could be conflicts during the integration process. Regardless of the repository strategy, there must be a process to minimize such conflicts and enable a continuous, frictionless release. CI (Continuous Integration) and CD (Continuous Deployment) are intended to minimize these issues.</p>

      <div class="Para" id="Par4">This chapter covers the following concepts:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par5">Introduction to CI and CD</p></li><li><p class="Para" id="Par6">Example demonstrating a simple CI/CD pipeline</p></li></ul></div></div>

      <section class="Section1 RenderAsSection1" id="Sec1">

        <h2 class="Heading">CI and CD</h2>

        <p class="Para" id="Par7">The motivations for modern day software release automation and several standard DevOps practices—such as automated build and test, Continuous Integration (CI), and Continuous Delivery (CD)—originated in the Agile world of software engineering.</p>

        <section class="Section2 RenderAsSection2" id="Sec2">

          <h3 class="Heading">DevOps</h3>

          <div class="Para" id="Par8"><span id="ITerm5">DevOps</span> is a methodology from the software development industry. Used as a set of practices and tools, DevOps is intended to integrate and automate the work of software development (Dev) and IT operations (Ops) as a means for improving and shortening the software development lifecycle. Microservices-based architecture is intended to increase delivery speed, and to enable releases of parts of an app independent of other parts. Microservices are smaller in size, which allows the architecture of an individual service to emerge through continuous refactoring. Shared repositories and artefacts, which are version controlled, are the essence of DevOps <span id="ITerm6">practices</span>, and the roles of Dev and Ops personnel are converging into a single pipeline of stages. Each stage identifies the discrete steps of the Dev and Ops processes with a blurred boundary between the Dev and Ops. If you look at the typical stages in a release process, these concepts will become clearer. See Figure <span class="InternalRef"><a href="#Fig1">13-1</a></span>.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="" aria-describedby="d64e210" src="../images/619782_1_En_13_Chapter/Imagem-138.jpg" style="width:35.15em"/><div class="TextObject" id="d64e210"><p class="Para" id="Par59">A flow diagram has the following flow, microservice dev team 1 to n, version control or branch management, build, package, and test under build pipeline and continuous integration, package with instructions, operations team, auto scripts, test environment, and acceptance and auto acceptance test under release pipeline and continuous delivery and deployment, and release to global.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 13-1</span><p class="SimplePara">CI and CD</p></div></figcaption></figure></div>

          <p class="Para" id="Par9">CI/CD stands for Continuous Integration and Continuous <span id="ITerm7">Delivery</span> (or Continuous Deployment). This chapter investigates each component.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec3">

          <h3 class="Heading">Continuous Integration (CI)</h3>

          <p class="Para" id="Par10"><em class="EmphasisTypeItalic ">Continuous Integration</em><span id="ITerm8"></span> defines how developers integrate code using a shared repository, multiple times a day with the help of automation. New code changes are regularly built, tested, and merged to a shared repository.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec4">

          <h3 class="Heading">Continuous Delivery (CD)</h3>

          <p class="Para" id="Par11"><em class="EmphasisTypeItalic ">Continuous Delivery</em><span id="ITerm9"></span> is about automatically releasing software to the test or production environment. Continuous Delivery usually means a developer’s changes to an app are automatically bug tested and uploaded to a repository (like GitHub or a container registry like Docker Hub), where they can then be deployed to a live production environment by the operations team.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec5">

          <h3 class="Heading">Continuous Deployment (CD)</h3>

          <p class="Para" id="Par12"><em class="EmphasisTypeItalic ">Continuous Deployment</em><span id="ITerm10"></span> is about releasing software to production automatically, without human intervention. It addresses the problem of overloading operations teams with manual processes of testing and pushing buttons, which slow down app delivery. Continuous Deployment builds over the benefits of Continuous Delivery by automating the next stage in the pipeline, as shown in Figure <span class="InternalRef"><a href="#Fig1">13-1</a></span>.</p>

          <p class="Para" id="Par13">The following section investigates these aspects in the context of a tool, Skaffold.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec6">

        <h2 class="Heading">Google Skaffold</h2>

        <p class="Para" id="Par14"><span id="ITerm11">Skaffold</span> is an open-source command-line tool that facilitates developer productivity by orchestrating Continuous Development, Continuous Integration (CI), and Continuous Delivery (CD). It handles the workflow for building, pushing, and deploying your application and you can use it to easily configure a local development workspace. Due to how easy it is to set up, this chapter uses Skaffold to show a few of the aspects of <span id="ITerm12">CI/CD</span> in the microservice example.</p>

        <section class="Section2 RenderAsSection2" id="Sec7">

          <h3 class="Heading">Skaffold Workflow</h3>

          <div class="Para" id="Par15">Skaffold provides a single, simple command that will simplify your development workflow by organizing common development stages. Here’s a typical workflow when you execute the Skaffold <span class="EmphasisFontCategoryNonProportional ">dev</span> <span id="ITerm13">command</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par16">Collects and watches your source code for changes.</p></li><li><p class="Para" id="Par17">Syncs files directly to pods if the user marks them as able to be synced.</p></li><li><p class="Para" id="Par18">Builds artifacts from the source.</p></li><li><p class="Para" id="Par19">Tests the built artifacts using container-structure-tests or custom scripts.</p></li><li><p class="Para" id="Par20">Tags the artifacts.</p></li><li><p class="Para" id="Par21">Pushes the artifacts.</p></li><li><p class="Para" id="Par22">Deploys the artifacts.</p></li><li><p class="Para" id="Par23">Monitors the deployed artifacts.</p></li><li><p class="Para" id="Par24">Cleans up the deployed artifacts on exit (Ctrl+C).</p></li></ul></div></div>

          <p class="Para" id="Par25">Skaffold is <span id="ITerm14">flexible</span> so that if you are coding on a local machine, you can configure it to build artifacts with your local Docker daemon and deploy them to Minikube using kubectl, which is what you will do next in the example. In production, you can switch to your production profile and start building with different profiles and then deploy with Helm.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec8">

        <h2 class="Heading">CI and CD Example for Microservices</h2>

        <div class="Para" id="Par26">You will use Skaffold to enable CI/CD to the example in the previous chapter. This example assumes that Skaffold is already installed in your machine. On the Mac, you can install it using <span class="EmphasisFontCategoryNonProportional ">brew</span>:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">brew skaffold</div></div></div></div>

        <p class="Para" id="Par27">This section starts by investigating the project structure.</p>

        <section class="Section2 RenderAsSection2" id="Sec9">

          <h3 class="Heading">Code Organization</h3>

          <div class="Para" id="Par28">The source <span id="ITerm15">code</span> for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The source code for this example is organized as shown in Listing <span class="InternalRef"><a href="#PC2">13-1</a></span>, inside the <span class="EmphasisFontCategoryNonProportional ">ch13\ch13-01</span> folder.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">./ch13-01/</div><div class="FixedLine">├── README.txt</div><div class="FixedLine">├── build.sh</div><div class="FixedLine">├── clean.sh</div><div class="FixedLine">├── k8s</div><div class="FixedLine">│   ├── deployment.yml</div><div class="FixedLine">│   └── service.yml</div><div class="FixedLine">├── make.sh</div><div class="FixedLine">├── pom.xml</div><div class="FixedLine">├── run.sh</div><div class="FixedLine">├── skaffold.yaml</div><div class="FixedLine">└── src</div><div class="FixedLine">    └── main</div><div class="FixedLine">        ├── java</div><div class="FixedLine">        │   └── com</div><div class="FixedLine">        │       └── acme</div><div class="FixedLine">        │           └── ecom</div><div class="FixedLine">        │               └── product</div><div class="FixedLine">        │                   └── Application.java</div><div class="FixedLine">        └── resources</div><div class="FixedLine">            ├── application.yml</div><div class="FixedLine">            └── log4j2-spring.xml</div></div><div class="LineGroup"><div class="FixedLine">9 directories, 12 files</div><div class="FixedLine">binildass-MacBook-Pro:ch13 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-1</span><p class="SimplePara"><span id="ITerm16">Spring Boot Microservices Source Code Organization</span></p></div></div></div></div>

          <p class="Para" id="Par29">Since you are <span id="ITerm17">using</span> Google <span class="EmphasisFontCategoryNonProportional ">jib-maven-plugin</span><span id="ITerm18"></span><span id="ITerm19"></span> to automate the Docker image creation, Docker daemon does not have to be running on your local machine, nor do you need a Docker file for your Spring Boot application.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec10">

          <h3 class="Heading">Understanding the Source Code</h3>

          <div class="Para" id="Par30">The single application component is the <span class="EmphasisFontCategoryNonProportional ">Application.java</span> class, which is a REST controller. You saw this code in the third example in Chapter <span class="ExternalRef"><a href="Capítulo-14.html"><span class="RefSource">12</span></a></span>, and there are more configurations to the <span class="EmphasisFontCategoryNonProportional ">jib</span> plugin, so the <span id="ITerm20">Maven configurations</span> are shown in Listing <span class="InternalRef"><a href="#PC3">13-2</a></span>.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">&lt;project&gt;</div><div class="FixedLine">    ...</div><div class="FixedLine">    &lt;build&gt;</div><div class="FixedLine">        &lt;plugins&gt;</div></div><div class="LineGroup"><div class="FixedLine">            &lt;plugin&gt;</div><div class="FixedLine">                &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;</div><div class="FixedLine">                &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;</div><div class="FixedLine">                &lt;version&gt;3.3.2&lt;/version&gt;</div><div class="FixedLine">                &lt;configuration&gt;</div><div class="FixedLine">                    &lt;to&gt;</div><div class="FixedLine">                        &lt;image&gt;</div><div class="FixedLine">                            binildas/${project.artifactId}</div><div class="FixedLine">                        &lt;/image&gt;</div><div class="FixedLine">                    &lt;/to&gt;</div><div class="FixedLine">                    &lt;container&gt;</div><div class="FixedLine">                        &lt;creationTime&gt;</div><div class="FixedLine">                            USE_CURRENT_TIMESTAMP</div><div class="FixedLine">                        &lt;/creationTime&gt;</div><div class="FixedLine">                        &lt;ports&gt;</div><div class="FixedLine">                            &lt;port&gt;8080&lt;/port&gt;</div><div class="FixedLine">                        &lt;/ports&gt;</div><div class="FixedLine">                    &lt;/container&gt;</div><div class="FixedLine">                &lt;/configuration&gt;</div><div class="FixedLine">            &lt;/plugin&gt;</div></div><div class="LineGroup"><div class="FixedLine">        &lt;/plugins&gt;</div><div class="FixedLine">    &lt;/build&gt;</div><div class="FixedLine">&lt;/project&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-2</span><p class="SimplePara">Maven pom.xml (ch13/ch13-01/pom.xml)</p></div></div></div></div>

          <p class="Para" id="Par31">You are mainly configuring the container port in Listing <span class="InternalRef"><a href="#PC3">13-2</a></span>.</p>

          <div class="Para" id="Par32">This example also looks at the application source code. The single application component is the <span class="EmphasisFontCategoryNonProportional ">Application.java</span> class, which is a <span id="ITerm21">REST controller</span> (see Listing <span class="InternalRef"><a href="#PC4">13-3</a></span>).<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">@SpringBootApplication</div><div class="FixedLine">@RestController</div><div class="FixedLine">public class Application {</div></div><div class="LineGroup"><div class="FixedLine">    private static final Logger LOGGER =</div><div class="FixedLine">        LoggerFactory.getLogger(Application.class);</div></div><div class="LineGroup"><div class="FixedLine">    private static volatile long times = 0L;</div><div class="FixedLine">    private static String appVersion = "1";</div></div><div class="LineGroup"><div class="FixedLine">    @RequestMapping("/")</div><div class="FixedLine">    public String home() {</div></div><div class="LineGroup"><div class="FixedLine">        LOGGER.info("Start");</div><div class="FixedLine">        ++times;</div><div class="FixedLine">        LOGGER.debug("Inside hello.Application.home() :</div><div class="FixedLine">            Counted {} times by App Version: {}", times,</div><div class="FixedLine">                appVersion);</div><div class="FixedLine">        LOGGER.info("Returning...");</div><div class="FixedLine">        return "Hello Docker World : Counted " + times +</div><div class="FixedLine">            " times by App Version: " + appVersion;</div><div class="FixedLine">    }</div></div><div class="LineGroup"><div class="FixedLine">    public static void main(String[] args) {</div></div><div class="LineGroup"><div class="FixedLine">        SpringApplication.run(Application.class, args);</div><div class="FixedLine">        LOGGER.info("Started...");</div><div class="FixedLine">    }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-3</span><p class="SimplePara">Application REST Controller (ch13/ch13-01/src/main/java/com/acme/ecom/product\Application.java)</p></div></div></div></div>

          <p class="Para" id="Par33">An <span class="EmphasisFontCategoryNonProportional ">appVersion</span> field is introduced in the Java class file in Listing <span class="InternalRef"><a href="#PC4">13-3</a></span>. You will make changes to this field to understand the Skaffold CI/CD feature.</p>

          <div class="Para" id="Par34">Next, take a look at the <span id="ITerm22">Skaffold descriptor</span>, as shown in Listing <span class="InternalRef"><a href="#PC5">13-4</a></span>.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">apiVersion: skaffold/v1beta4</div><div class="FixedLine">kind: Config</div><div class="FixedLine">build:</div><div class="FixedLine">  local:</div><div class="FixedLine">    push: false</div><div class="FixedLine">  artifacts:</div><div class="FixedLine">    - image: binildas/spring-boot-docker-k8s-helm</div><div class="FixedLine">      # jibGradle: {}</div><div class="FixedLine">      jibMaven: {}</div><div class="FixedLine">deploy:</div><div class="FixedLine">  kubectl:</div><div class="FixedLine">    manifests:</div><div class="FixedLine">      - k8s/*.yml</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-4</span><p class="SimplePara">Skaffold Descriptor (ch13/ch13-01/skaffold.yaml)</p></div></div></div></div>

          <div class="Para" id="Par35">A few of the descriptor <span id="ITerm23">fields</span> are explained here:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par36"><span id="ITerm24"><span class="EmphasisFontCategoryNonProportional ">build.local.push</span></span>: False enforces Skaffold to use <span class="EmphasisFontCategoryNonProportional ">jibDockerBuild</span>.</p></li><li><p class="Para" id="Par37"><span id="ITerm25"><span class="EmphasisFontCategoryNonProportional ">build.artifacts</span></span> is a list of images you’re going to build.</p></li><li><p class="Para" id="Par38"><span id="ITerm26"><span class="EmphasisFontCategoryNonProportional ">build.artifacts.jibMaven</span></span> configures Skaffold to use <span class="EmphasisFontCategoryNonProportional ">jib</span> during the image-building phase, with type <span class="EmphasisFontCategoryNonProportional ">maven</span>, since you are using Maven as a build tool.</p></li><li><p class="Para" id="Par39"><span id="ITerm27"><span class="EmphasisFontCategoryNonProportional ">deploy.kubectl.manifests</span></span> sets the folder name where you have the Kubernetes manifest files. If you skip this attribute, the default directory name would be <span class="EmphasisFontCategoryNonProportional ">k8s</span>.</p></li></ul></div></div>

          <p class="Para" id="Par40">You are almost done setting up a CI/CD pipeline in this Dev environment.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec11">

          <h3 class="Heading">Build and Run the Microservice</h3>

          <div class="Para" id="Par41">The <span class="EmphasisFontCategoryNonProportional ">ch13\ch13-01</span> folder contains the Maven scripts required to build and run the examples. You will build using the <span class="EmphasisFontCategoryNonProportional ">mvn clean compile jib:build</span> <span id="ITerm28">command</span>, as shown in Listing <span class="InternalRef"><a href="#PC6">13-5</a></span>.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch13-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-04/Code/ch13/ch13-01</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch13-01 binil$ sh build.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] -&lt; com.acme.ecom.product:spring-boot-docker-k8s-helm &gt;-</div><div class="FixedLine">[INFO] Building Spring Boot μS 0.0.1-SNAPSHOT</div><div class="FixedLine">[INFO] ---------------------[ jar ]---------------------</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Built and pushed image as binildas/spring-boot-docker-k8s-helm</div><div class="FixedLine">[INFO] Executing tasks:</div><div class="FixedLine">[INFO] [============================  ] 91.7% complete</div><div class="FixedLine">[INFO] &gt; launching layer pushers</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] -------------------------------------------------</div><div class="FixedLine">[INFO] BUILD SUCCESS</div><div class="FixedLine">[INFO] --------------------------------------------------</div><div class="FixedLine">[INFO] Total time:  33.855 s</div><div class="FixedLine">[INFO] Finished at: 2023-05-23T15:43:14+05:30</div><div class="FixedLine">[INFO] --------------------------------------------------</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch13-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-5</span><p class="SimplePara">Building the Microservice Using Scripts</p></div></div></div></div>

          <p class="Para" id="Par42">This build will push the image to Docker Hub. When you execute the <span class="EmphasisFontCategoryNonProportional ">dev</span> mode of the Skaffold, it will build the application, create the image, deploy in your local cluster, and keep watching your sources to see if there is a change. When there is a change, it will repeat the same flow upon code change so that you have a fresh deployment for testing and debugging.</p>

          <div class="Para" id="Par43">Before you trigger any changes to the code, first run the microservice as the next step. Note that you are going to use the <span class="EmphasisFontCategoryNonProportional ">skaffold</span> <span id="ITerm29">command</span> to run the microservices. See Listing <span class="InternalRef"><a href="#PC7">13-6</a></span>.<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch13-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-04/Code/ch13/ch13-01</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch13-01 binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch13-01 binil$ skaffold dev --trigger notify -v debug</div><div class="FixedLine">DEBU[0000] skaffold API not starting as it's not requested  subtask=-1 task=DevLoop</div><div class="FixedLine">...</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Built image to Docker daemon as binildas/spring-boot-docker-k8s-helm</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] -------------------------------------------------------</div><div class="FixedLine">[INFO] BUILD SUCCESS</div><div class="FixedLine">[INFO] -------------------------------------------------------</div><div class="FixedLine">...</div><div class="FixedLine">Press Ctrl+C to exit</div><div class="FixedLine">DEBU[0017] Change detected&lt;nil&gt;      subtask=-1 task=DevLoop</div><div class="FixedLine">Watching for changes...</div><div class="FixedLine">...</div><div class="FixedLine">[springboothelm]</div><div class="FixedLine">[springboothelm]   .   ____          _            __ _ _</div><div class="FixedLine">[springboothelm]  /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">[springboothelm] ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine">[springboothelm]  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">[springboothelm]   '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine">[springboothelm]  =========|_|==============|___/=/_/_/_/</div><div class="FixedLine">[springboothelm]  :: Spring Boot ::                (v3.2.0)</div><div class="FixedLine">[springboothelm]</div><div class="FixedLine">...</div><div class="FixedLine">[springboothelm] 2023-06-01 12:55:42 INFO  StartupInfoLogger.logStarted:57 - Started Application ...</div><div class="FixedLine">[springboothelm] 2023-06-01 12:55:42 INFO  Application.main:51 - Started...</div><div class="FixedLine">...<span id="ITerm30"></span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-6</span><p class="SimplePara">Running the Microservice Using Skaffold</p></div></div></div></div>

          <p class="Para" id="Par44">This will build your image and deploy it to Minikube for every change you make in your project.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec12">

          <h3 class="Heading">Testing the Microservices</h3>

          <div class="Para" id="Par45">Once the <span id="ITerm31">microservice</span> is up, you can access the web application using your browser and pointing to the URL, which you will discover in Listing <span class="InternalRef"><a href="#PC8">13-7</a></span>.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ minikube service springboothelm --url</div><div class="FixedLine">http://192.168.64.6:31831</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-7</span><p class="SimplePara">Finding the Service URL</p></div></div></div></div>

          <div class="Para" id="Par46">You can <span id="ITerm32">test</span> using this URL in a browser or by using cURL, as shown in Listing <span class="InternalRef"><a href="#PC9">13-8</a></span>.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ curl http://192.168.64.6:31831</div><div class="FixedLine">Hello Docker World : Counted 1 times by App Version: 1</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-8</span><p class="SimplePara">Testing the Microservice Using cURL</p></div></div></div></div>

          <div class="Para" id="Par47">The corresponding logs will also be visible in the microservice terminal window, as shown in Listing <span class="InternalRef"><a href="#PC10">13-9</a></span>.<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">[springboothelm]</div><div class="FixedLine">[springboothelm]   .   ____          _            __ _ _</div><div class="FixedLine">[springboothelm]  /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">[springboothelm] ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine">[springboothelm]  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">[springboothelm]   '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine">[springboothelm]  =========|_|==============|___/=/_/_/_/</div><div class="FixedLine">[springboothelm]  :: Spring Boot ::                (v3.2.0)</div><div class="FixedLine">[springboothelm]</div><div class="FixedLine">...</div><div class="FixedLine">[springboothelm] 2023-06-01 12:55:42 INFO  StartupInfoLogger.logStarted:57 - Started Application ...</div><div class="FixedLine">[springboothelm] 2023-06-01 12:55:42 INFO  Application.main:51 - Started<span id="ITerm33"></span>...</div><div class="FixedLine">...</div><div class="FixedLine">[springboothelm] 2023-06-01 12:59:50 INFO  Application.home:41 - Start</div><div class="FixedLine">[springboothelm] 2023-06-01 12:59:50 DEBUG Application.home:43 - Inside hello.Application.home() : Counted 1 times by App Version: 1</div><div class="FixedLine">[springboothelm] 2023-06-01 12:59:50 INFO  Application.home:44 - Returning...</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-9</span><p class="SimplePara">Microservice Terminal Window Logs</p></div></div></div></div>

          <div class="Para" id="Par48">You will now make some <span id="ITerm34">changes</span> to the source code of the project. While making the change, keep watching the terminal window. Make this change (see Listing <span class="InternalRef"><a href="#PC12">13-10</a></span>):<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">private static String appVersion = "2";</div></div></div><div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">[springboothelm]</div><div class="FixedLine">[springboothelm]   .   ____          _            __ _ _</div><div class="FixedLine">[springboothelm]  /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">[springboothelm] ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine">[springboothelm]  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">[springboothelm]   '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine">[springboothelm]  =========|_|==============|___/=/_/_/_/</div><div class="FixedLine">[springboothelm]  :: Spring Boot ::                (v3.0.6)</div><div class="FixedLine">[springboothelm]</div><div class="FixedLine">...</div><div class="FixedLine">[springboothelm] 2023-06-01 13:01:23 INFO  Application.main:51 - Started...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-10</span><p class="SimplePara">Microservice Terminal Window Logs on Redeployment</p></div></div></div></div>

          <p class="Para" id="Par49">Any small <span id="ITerm35">change</span> will be picked up and Skaffold and will automatically trigger a new build of the Docker image, create a new pod, and redeploy the application.</p>

          <div class="Para" id="Par50">You can test the application again using cURL, as in Listing <span class="InternalRef"><a href="#PC13">13-11</a></span>.<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ curl http://192.168.64.6:31831</div><div class="FixedLine">Hello Docker World : Counted 1 times by App Version: 2</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-11</span><p class="SimplePara">Testing the Microservice Using cURL</p></div></div></div></div>

          <div class="Para" id="Par51">The corresponding logs are also visible in the terminal window, as shown in Listing <span class="InternalRef"><a href="#PC14">13-12</a></span>.<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">[springboothelm]</div><div class="FixedLine">[springboothelm]   .   ____          _            __ _ _</div><div class="FixedLine">[springboothelm]  /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">[springboothelm] ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine">[springboothelm]  \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">[springboothelm]   '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine">[springboothelm]  =========|_|==============|___/=/_/_/_/</div><div class="FixedLine">[springboothelm]  :: Spring Boot ::                (v3.0.6)</div><div class="FixedLine">[springboothelm]</div><div class="FixedLine">...</div><div class="FixedLine">[springboothelm] 2023-06-01 13:01:23 INFO  Application.main:51 - Started...</div><div class="FixedLine">[springboothelm] 2023-06-01 13:04:58 INFO  Application.home:41 - Start</div><div class="FixedLine">[springboothelm] 2023-06-01 13:04:58 DEBUG Application.home:43 - Inside hello.Application.home() : Counted 1 times by App Version: 2</div><div class="FixedLine">[springboothelm] 2023-06-01 13:04:58 INFO  Application.home:44 - Returning...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-12</span><p class="SimplePara">Microservice Terminal Window Logs After Redeployment</p></div></div></div></div>

          <p class="Para" id="Par52">You can clearly view the change you have made in the source code (<span class="EmphasisFontCategoryNonProportional ">appVersion = "2"</span>). Even the <span class="EmphasisFontCategoryNonProportional ">private static volatile long times = 0L</span> counter has been reset since the class binaries have been reloaded by the new container. See Listing <span class="InternalRef"><a href="#PC15">13-13</a></span>.</p>

          <div class="Para" id="Par53">You can stop the application by typing Ctrl+C in the terminal <span id="ITerm36">window</span>.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">^CCleaning up...</div><div class="FixedLine">...</div><div class="FixedLine">DEBU[0972] Running command: [kubectl --context minikube delete --ignore-not-found=true -f -]</div><div class="FixedLine"> - deployment.apps "springboothelm" deleted</div><div class="FixedLine"> - service "springboothelm" deleted</div><div class="FixedLine">INFO[0972] Cleanup complete in 273.772602ms</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch13-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 13-13</span><p class="SimplePara">Terminating the Microservice <span id="ITerm37">Application</span></p></div></div></div></div>

          <p class="Para" id="Par54">This completes the simple <span id="ITerm38">CI/CD pipeline</span> example for microservices.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec13">

        <h2 class="Heading">Summary</h2>

        <div class="Para" id="Par55"><span id="ITerm39">Faster release cycles</span> are one of the major promises of microservices architectures. However, without a good CI/CD process, you won’t achieve the agility that microservices promise.<blockquote class="BlockQuote"><p class="Para ParaOneEmphasisChild" id="Par56"><em class="EmphasisTypeItalic ">“We try to create teams that are no larger than can be fed by two pizzas. We call that the two-pizza team rule.”</em></p><p class="Para" id="Par57">—Bezos</p></blockquote></div>

        <p class="Para" id="Par58">When this becomes the norm, it is more important to have a strong CI/CD process, since you will have multiple teams working in their own separate repositories of microservices. You have seen an example demonstrating these concepts. Although the example and pipeline are simple, they served the purpose of introducing the concepts. Having looked at different aspects of microservices and containers, you are now ready to get into the public cloud, which you will do in the next chapter.</p>

      </section>

    </div>

  </div>

</body>

</html>