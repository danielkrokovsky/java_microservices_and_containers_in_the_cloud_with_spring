<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">

<head>
  <title>Microservice Containers</title>
  <link href="../css/springer_epub.css" rel="styleSheet" type="text/css"/>
</head>

<body>

  <div epub:type="chapter" role="doc-chapter">

    <div class="ChapterContextInformation">

      <div class="ContextInformation" id="b979-8-8688-0555-4_8"><div class="ChapterCopyright">© The Author(s), under exclusive license to APress Media, LLC, part of Springer Nature 2024</div><span class="ContextInformationAuthorEditorNames">B. A. Christudas</span><span class="ContextInformationBookTitles"><span class="BookTitle">Java Microservices and Containers in the Cloud</span></span><span class="ChapterDOI"><a href="https://doi.org/10.1007/979-8-8688-0555-4_8">https://doi.org/10.1007/979-8-8688-0555-4_8</a></span></div>

    </div>

    <!--Begin Abstract-->

    <div class="MainTitleSection">

      <h1 class="ChapterTitle" lang="en">8. Microservice Containers</h1>

    </div>

    <div class="AuthorGroup">

      <div class="AuthorNames"><span class="Author"><span class="AuthorName">Binildas A. Christudas</span><sup><a href="#Aff2">1</a> <span class="ContactIcon"> </span></sup></span></div>

      <div class="Affiliations">

        <div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">NBCRA 45, Christbin, Thiruvananthapuram, Kerala, India</div></div>

        <div class="ClearBoth"> </div>

      </div>

    </div>

    <!--End Abstract-->

    <div class="Fulltext">

      <p class="Para" id="Par2">The initial chapters introduced <span id="ITerm1">microservices</span>, which are self-contained, independent application units, each fulfilling related business functionalities from a specific domain. Each of them, or a collection of them together, can be considered an application in its own. In a multi-microservice application, you create many microservices for your app. What if you decide to build several microservices with different technology stacks? Your team will soon be in trouble, as developers have to manage even more environments than they would have been dealing with in a classical monolithic application development scenario. With Docker, it’s possible to manage, deploy, and even reduce performance overhead of hundreds if not thousands of microservices on the same server. <span id="ITerm2">Docker containers</span> require fewer computing resources than virtual machines, and containers also provide required isolation so that disparate technologies can coexist, side by side. Thus, containers are a natural fit with microservices.</p>

      <div class="Para" id="Par3">Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span> introduced how to run application containers using Docker images. This chapter continues that discussion, but with microservices examples that reflect real-life scenarios. Multiple microservices will interact, which means they need to communicate with each other. This chapter covers the following concepts:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par4">Microservice containers connecting with each other</p></li><li><p class="Para" id="Par5">Microservice containers connecting to a PostgreSQL database on a host machine</p></li><li><p class="Para" id="Par6">Microservice containers connecting to PostgreSQL in a container</p></li><li><p class="Para" id="Par7">Microservice containers connecting to MongoDB in a container</p></li></ul></div></div>

      <p class="Para" id="Par8">To understand <span id="ITerm3">inter-container communications</span>, you need to understand the networking options between containers, which is covered next.</p>

      <section class="Section1 RenderAsSection1" id="Sec1">

        <h2 class="Heading">Container Networking</h2>

        <p class="Para" id="Par9">Docker provides different ways to configure networking so that your containers can communicate with the outside world, whether with another server or with another <span id="ITerm4">Docker container</span>. The next section briefly looks at these options.</p>

        <section class="Section2 RenderAsSection2" id="Sec2">

          <h3 class="Heading">Links</h3>

          <p class="Para" id="Par10">When you install Docker, Docker defaults to a bridge network that is created automatically. <span id="ITerm5">Docker’s networking subsystem</span> is pluggable, using drivers. Before Docker introduced the networking feature, the Docker <span id="ITerm6">link feature</span> enabled containers to discover each other and securely transfer information about one container to another. With the introduction of the <span id="ITerm7">Docker networking feature</span>, you can still create links, but they behave differently compared to the default bridge network and the other user-defined networks. Even though the link option works, it is a legacy feature. The first example uses links; however, this feature may eventually be removed so you are advised to use other options (network) for this functionality. One feature that <span id="ITerm8">user-defined networks</span> do not support, which you can do with a link today, is share environment variables between containers. But volumes provide better options to share environment variables between containers in a more controlled way.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec3">

          <h3 class="Heading">Networks</h3>

          <div class="Para" id="Par11">There are multiple types of <span id="ITerm9">networks</span>. I only mention them here because detailed explanations are beyond the scope of this book.<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par12">Bridge networks are best when you need multiple containers to communicate on the same Docker host.</p></li><li><p class="Para" id="Par13">Host networks are best when the network stack should not be isolated from the Docker host, but you want other aspects of the container to be isolated.</p></li><li><p class="Para" id="Par14">Overlay networks are best when you need containers running on different Docker hosts to communicate, or when multiple applications work together using swarm services.</p></li><li><p class="Para" id="Par15">Macvlan networks are best when you are migrating from a VM setup or need your containers to look like physical hosts on your network, each with a unique MAC address.</p></li><li><p class="Para" id="Par16">Third-party network plugins allow you to integrate Docker with specialized network stacks.</p></li></ul></div></div>

          <p class="Para" id="Par17">You will look at working code soon so that you can learn by doing.</p>

          <p class="Para" id="Par18">Since you will be looking at multiple scenarios of container <span id="ITerm10">communications</span> in this chapter, it makes sense to also understand how to inspect container logs, which is covered next.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec4">

        <h2 class="Heading">Container Logs</h2>

        <p class="Para" id="Par19">You learned that Docker is an operating system-level virtualization platform and hence it allows you to run multiple <span id="ITerm11">applications</span> containers in the same host at the same time. It facilitates the separation of applications and infrastructure, but when you have many applications in the same infrastructure, you need a way to troubleshoot when things don’t go as intended. Docker Logs helps you here.</p>

        <section class="Section2 RenderAsSection2" id="Sec5">

          <h3 class="Heading">Console Output Logging</h3>

          <div class="Para" id="Par20">When you run a container, you can immediately see the <span class="EmphasisFontCategoryNonProportional ">STDOUT</span> <span id="ITerm12">logs</span> in the console. You saw this in Listing <span class="ExternalRef"><a href="Capítulo-09.html#PC28"><span class="RefSource">7-28</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span>, which is reproduced in Listing <span class="InternalRef"><a href="#PC1">8-1</a></span> here.<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$ docker run -it -p 8080:8080 binildas/product-web</div><div class="FixedLine">...</div><div class="FixedLine">f3636ebea575: Pull complete</div><div class="FixedLine">Digest: sha256:56254d5a6e84cbe625013d245d8fa7dfe157722d0a6dd50d434f8e63dfc339ad</div><div class="FixedLine">Status: Downloaded newer image for binildas/product-web:latest</div></div><div class="LineGroup"><div class="FixedLine">  .   ____          _            __ _ _</div><div class="FixedLine"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">  '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine"> =========|_|==============|___/=/_/_/_/</div><div class="FixedLine"> :: Spring Boot ::                (v3.2.0)</div></div><div class="LineGroup"><div class="FixedLine">2022-05-27 05:12:40 INFO  StartupInfoLogger.logStarting:55 - Starting EcomProductMicroserviceA...</div><div class="FixedLine">2022-05-27 05:12:40 DEBUG StartupInfoLogger.logStarting:56 - Running with Spring Boot ...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-1</span><p class="SimplePara">Running <span id="ITerm13">Product Web Microservice</span> Using Docker</p></div></div></div></div>

          <p class="Para" id="Par21">This command follows the logs like the Linux shell <span class="EmphasisFontCategoryNonProportional ">tail -f</span> command. In Linux, with <span class="EmphasisFontCategoryNonProportional ">--follow (-f)</span>, <span class="EmphasisFontCategoryNonProportional ">tail</span> defaults to following the file descriptor.</p>

          <div class="Para" id="Par22">From Listing <span class="ExternalRef"><a href="Capítulo-09.html#PC33"><span class="RefSource">7-30</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span>, you learned that the container ID is <span class="EmphasisFontCategoryNonProportional ">e95b2b5eb64e</span>. You can use these IDs to view the container logs, as shown in Listing <span class="InternalRef"><a href="#PC2">8-2</a></span>.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs e95b2b5eb64e</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-2</span><p class="SimplePara">Viewing <span id="ITerm14">Product Web Microservice</span> Container Logs</p></div></div></div></div>

          <div class="Para" id="Par23">In Listing <span class="InternalRef"><a href="#PC2">8-2</a></span>, the logs will contain the data of the output stream with the timestamp. However, this command doesn’t contain the continuous log output. To view the continuous log output of your container, you need to use the <span class="EmphasisFontCategoryNonProportional ">–follow</span> option in the <span class="EmphasisFontCategoryNonProportional ">docker logs</span> command, as shown in Listing <span class="InternalRef"><a href="#PC3">8-3</a></span>.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow e95b2b5eb64e</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-3</span><p class="SimplePara">Viewing Product Web Microservice Container Logs Continuously</p></div></div></div></div>

          <p class="Para" id="Par24">This <span class="EmphasisFontCategoryNonProportional ">–follow</span> option is a very useful Docker option, since it allows you to monitor the live logs of a container.</p>

          <p class="Para" id="Par25">With this little introduction, it’s time to move on to the code.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec6">

        <h2 class="Heading">Microservice and MongoDB Containers Using Links</h2>

        <p class="Para" id="Par26">This example reuses the microservices from the section titled “Microservices Using MongoDB and <span id="ITerm15">CrudRepository</span>” in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>. It uses the same two microservices—a consumer and a provider microservice communicating each other using the REST protocol. The provider microservice also interacts with a MongoDB. Refer to Figure <span class="ExternalRef"><a href="Capítulo-04.html#Fig1"><span class="RefSource">2-1</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-04.html"><span class="RefSource">2</span></a></span> for the overall design.</p>

        <section class="Section2 RenderAsSection2" id="Sec7">

          <h3 class="Heading">Designing the Container Topology</h3>

          <div class="Para" id="Par27">From this design in Figure <span class="ExternalRef"><a href="Capítulo-04.html#Fig1"><span class="RefSource">2-1</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-04.html"><span class="RefSource">2</span></a></span>, you also need to define a <span id="ITerm16">container-based deployment topology</span>. This is shown in Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span>.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="" aria-describedby="d64e516" src="../images/619782_1_En_8_Chapter/Imagem-093.jpg" style="width:35.15em"/><div class="TextObject" id="d64e516"><p class="Para" id="Par180">A diagram illustrates the microservices container topology. It includes user, browser, container engine, host O S, and hardware.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-1</span><p class="SimplePara"><span id="ITerm17">Microservices container topology design</span></p></div></figcaption></figure></div>

          <p class="Para" id="Par28">A consumer and a provider microservice communicate with each other using the <span id="ITerm18">REST protocol</span>. <span id="ITerm19">Product Web microservice</span> is the consumer microservice, which will be deployed as a single container. The provider microservice also interacts with a NoSQL database, MongoDB. Therefore, the deployment involves two containers—one for the Product Server component and the other for the MongoDB component. Here, the Product Web and Product Server containers provide business services, whereas the Mongo container provides application services for persisting data.</p>

          <p class="Para" id="Par29">Also note another aspect in Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span>. The Product Server and MongoDB containers are grouped together and are so called as a single microservice, the <span id="ITerm20">Product Server microservice</span>. This follows the standard conventions of microservices, where you define that a microservice is a self-contained unit owning its own data.</p>

          <div class="Para" id="Par30">Also note two kinds of interactions with the user doing with the deployment:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par31">The <span id="ITerm21">command-line interface</span>, or CLI, runs in what is called userspace memory, as a deployment management interface. This program runs just like other programs that run on top of the operating system. Programs running in the userspace can’t modify kernel space memory. The operating system is the interface between the user programs and the hardware that the computer is running on.</p></li><li><p class="Para" id="Par32">The user uses a browser to access the business functionality from the business services</p></li></ul></div></div>

          <p class="Para" id="Par33">Docker Engine and Docker CLI are two programs running in the userspace when you run Docker. Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span> shows three containers running. Each container is running as a child process of the <span id="ITerm22">Docker engine</span>, wrapped with a container, and the delegate process is running in its own memory subspace of the userspace. Programs running inside a container cannot access memory and resources scoped by the neighbor container.</p>

          <p class="Para" id="Par34">Further, in a way Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span> represents a logical view of microservices deployment too. While at an infrastructure architecture level the container deployment makes more sense, it’s the microservice architecture view that is more relevant to the application architect, hence I have shown that in the figure. That is why even though <span id="ITerm23">Product Server and MongoDB</span> are deployed as two separate containers, I have logically grouped them together to represent the single Product Server microservice. This specific instance of MongoDB is wholly owned by the Product Server microservice, and entities outside the Product Server microservice may not be concerned about this MongoDB instance for any reason.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec8">

          <h3 class="Heading">Understanding the Source Code</h3>

          <p class="Para" id="Par35">The source code for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The code for this example is organized inside the <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-01</span> folder. The <span id="ITerm24">source code</span> in this example is similar to <span class="EmphasisFontCategoryNonProportional ">ch03\ch03-02</span>, which was explained in detail in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>. What you need to understand more is the deployment schema, which is covered in the next section.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec9">

          <h3 class="Heading">Run Containers Using Dockerfiles</h3>

          <p class="Para" id="Par36">Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span> introduced how to build Docker images of microservices. This section extends that knowledge by building multiple microservice images.</p>

          <div class="Para" id="Par37">The first step is to start Minikube single-node Kubernetes cluster so that you have a Docker Daemon up. Refer to Appendix E for a quick reference to the container commands.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ minikube start</div></div><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ eval $(minikube docker-env)</div></div></div></div>

          <div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1">

            <div class="Heading">Note</div>

            <p class="Para FirstParaInFormalPara" id="Par38">For all the examples in this chapter, I assume the previous two steps that connect to the Docker Daemon to be executed if you are using the Minikube single-node Kubernetes cluster.</p>

          </div>

          <div class="Para" id="Par39">Listing <span class="InternalRef"><a href="#PC5">8-4</a></span> shows the commands organized into a single utility script.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean package</div><div class="FixedLine">docker build  --build-arg JAR_FILE=02-ProductWeb/target/*.jar -t ecom/product-web .</div><div class="FixedLine">docker build  --build-arg JAR_FILE=01-ProductServer/target/*.jar -t ecom/product-server .</div><div class="FixedLine">docker run -d -it -p 27017:27017 --name mongo mongo:3.6</div><div class="FixedLine">docker run -d -p 8081:8081  --link mongo:mongo --name product-server ecom/product-server</div><div class="FixedLine">docker run -d -p 8080:8080  --link product-server:product-server --name product-web ecom/product-web</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-4</span><p class="SimplePara">Script to Build and Run Microservices Docker Containers (ch08\ch08-01\makeandrun.sh)</p></div></div></div></div>

          <div class="Para" id="Par40">The first line builds both microservices <span id="ITerm25">and packages</span> them into .<span class="EmphasisFontCategoryNonProportional ">jar</span> files, one by one. The second and third lines build Docker images using the .<span class="EmphasisFontCategoryNonProportional ">jar</span> files. This build utilizes the Dockerfile you saw in Listing <span class="ExternalRef"><a href="Capítulo-09.html#PC38"><span class="RefSource">7-35</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span>, which is reproduced here in Listing <span class="InternalRef"><a href="#PC6">8-5</a></span>.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">FROM openjdk:8-jdk-alpine</div><div class="FixedLine">VOLUME /tmp</div><div class="FixedLine">ARG JAR_FILE</div><div class="FixedLine">COPY ${JAR_FILE} ecom.jar</div><div class="FixedLine">ENTRYPOINT ["java","-jar","/ecom.jar"]</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-5</span><p class="SimplePara">The <span id="ITerm26">Dockerfile</span> (ch08\ch08-01\Dockerfile)</p></div></div></div></div>

          <div class="Para" id="Par41">The <span id="ITerm27">Dockerfile</span> is template-enabled, so that the actual value of the .<span class="EmphasisFontCategoryNonProportional ">jar</span> file can be parameterized along with the <span class="EmphasisFontCategoryNonProportional ">build</span> command. See Listing <span class="InternalRef"><a href="#PC7">8-6</a></span>.<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-03/ch08/ch08-01</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ sh makeandrun.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO] ----------------------------------------------------</div><div class="FixedLine">[INFO] Reactor Build Order:</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">Sending build context to Docker daemon  67.45MB</div><div class="FixedLine">Step 1/5 : FROM openjdk:8-jdk-alpine</div><div class="FixedLine">...</div><div class="FixedLine">Successfully tagged ecom/product-web:latest</div><div class="FixedLine">...</div><div class="FixedLine">Successfully tagged ecom/product-server:latest</div><div class="FixedLine">e0e9a00ce90dac5076991a67611c938458049f915ff472fed96afe9b9ce</div><div class="FixedLine">03c80c666627fafda58611a9648b5c443010663311a6453187ccffd35a6</div><div class="FixedLine">f19bb132fa30fedbf2f2cf8c9a6f6b082280993829a536deac8b1d3f3ff</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-6</span><p class="SimplePara">The Dockerfile Build and Run Commands</p></div></div></div></div>

          <p class="Para" id="Par42">In Listing <span class="InternalRef"><a href="#PC5">8-4</a></span>, the second and third command use the same <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> as in Listing <span class="InternalRef"><a href="#PC6">8-5</a></span>, but they utilize different <span class="EmphasisFontCategoryNonProportional ">.jar</span> file paths during the build, and thus they build <span class="EmphasisFontCategoryNonProportional ">ecom/product-web:latest</span> and <span class="EmphasisFontCategoryNonProportional ">ecom/product-server:latest</span> and run the corresponding containers. Listing <span class="InternalRef"><a href="#PC7">8-6</a></span> reveals three containers instantiated from the last three log lines. Two are for the two business microservices (Product Server and Product Web) and the third line is for the MongoDB container you instantiated.</p>

          <p class="Para" id="Par43">The <span id="ITerm28">MongoDB</span> is an independent container. As shown in Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span>, the Product Server depends on MongoDB and Product Web depends on Product Server. These dependencies are specified explicit using links in the deployment scripts in Listing <span class="InternalRef"><a href="#PC5">8-4</a></span>.</p>

          <div class="Para" id="Par44">Once the containers are up and running, you can list the running containers. See Listing <span class="InternalRef"><a href="#PC8">8-7</a></span>.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ docker ps</div><div class="FixedLine">CONTAINER ID   IMAGE                 COMMAND                   CREATED              STATUS              PORTS                     NAMES</div><div class="FixedLine">f19bb132fa30   ecom/product-web      "java -jar /ecom.jar"     About a minute ago   Up 59 seconds       0.0.0.0:8080-&gt;8080/tcp    product-web</div><div class="FixedLine">03c80c666627   ecom/product-server   "java -jar /ecom.jar"     About a minute ago   Up About a minute   0.0.0.0:8081-&gt;8081/tcp    product-server</div><div class="FixedLine">e0e9a00ce90d   mongo:3.6             "docker-entrypoint.s..."  About a minute ago   Up About a minute  0.0.0.0:27017-&gt;27017/tcp  mongo</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-7</span><p class="SimplePara">List the Running Containers</p></div></div></div></div>

          <p class="Para" id="Par45">Since the<span class="EmphasisFontCategoryNonProportional ">–d</span> option is for running the containers, they are running as background daemon child processes. It would be convenient to keep watching the terminal logs while you access the application.</p>

          <div class="Para" id="Par46">Note the container IDs from Listing <span class="InternalRef"><a href="#PC8">8-7</a></span>. You can use these IDs to view the logs, as shown in Listings <span class="InternalRef"><a href="#PC9">8-8</a></span> and <span class="InternalRef"><a href="#PC10">8-9</a></span>.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow 03c80c666627</div></div><div class="LineGroup"><div class="FixedLine">  .   ____          _            __ _ _</div><div class="FixedLine"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">  '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine"> =========|_|==============|___/=/_/_/_/</div><div class="FixedLine"> :: Spring Boot ::                (v3.2.0)</div></div><div class="LineGroup"><div class="FixedLine">...</div><div class="FixedLine">2022-05-30 04:44:31 INFO  InitComponent.init:68 - Start...</div><div class="FixedLine">2022-05-30 04:44:31 DEBUG InitComponent.init:72 - Deleting all existing data on start...</div><div class="FixedLine">2022-05-30 04:44:31 DEBUG InitComponent.init:77 - Creating initial data on start...</div><div class="FixedLine">2022-05-30 04:44:31 INFO  InitComponent.init:126 - End</div><div class="FixedLine">2022-05-30 04:44:36 INFO  Startup.log:61 - Started EcomProd...</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-8</span><p class="SimplePara"><span id="ITerm29">Product Server</span> Container Logs</p></div></div></div></div>

          <div class="Para" id="Par47">Listing <span class="InternalRef"><a href="#PC9">8-8</a></span> shows the Product Server container logs. Similarly, Listing <span class="InternalRef"><a href="#PC10">8-9</a></span> shows the product Web container logs.<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow f19bb132fa30</div></div><div class="LineGroup"><div class="FixedLine">  .   ____          _            __ _ _</div><div class="FixedLine"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">  '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine"> =========|_|==============|___/=/_/_/_/</div><div class="FixedLine"> :: Spring Boot ::                (v3.2.0)</div></div><div class="LineGroup"><div class="FixedLine">...</div><div class="FixedLine">2022-05-30 04:44:30 INFO  InitComponent.init:58 - Start</div><div class="FixedLine">2022-05-30 04:44:30 DEBUG InitComponent.init:60 - Doing Nothing...</div><div class="FixedLine">2022-05-30 04:44:30 INFO  InitComponent.init:62 - End</div><div class="FixedLine">2022-05-30 04:44:35 INFO  Startup.log:61 - Started EcomProd...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-9</span><p class="SimplePara"><span id="ITerm30">Product Web</span> Container Logs</p></div></div></div></div>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec10">

          <h3 class="Heading">Testing the Microservice Containers</h3>

          <div class="Para" id="Par48">Once the microservices are up and running, you can access the <span id="ITerm31">Product Web</span> microservice. However, as mentioned in Appendix E, you have to get the Minikube IP first. See Listing <span class="InternalRef"><a href="#PC11">8-10</a></span>.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$ minikube ip</div><div class="FixedLine">192.168.64.5</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-10</span><p class="SimplePara">Finding Minikube IP</p></div></div></div></div>

          <p class="Para" id="Par49">You can now access the Product Web microservice using a browser with the URL formed with the Minikube IP.</p>

          <p class="Para ParaOneEmphasisChild" id="Par50"><span class="EmphasisFontCategoryNonProportional ">http://192.168.64.5:8080/product.html</span></p>

          <p class="Para" id="Par51">Refer to the section titled “Test the Microservice Using UI” in Chapter <span class="ExternalRef"><a href="Capítulo-03.html"><span class="RefSource">1</span></a></span> to test the Product Web microservice container. While you test the microservices, keep watching the log windows.</p>

          <div class="Para" id="Par52">Once you complete the testing process, you can stop and remove the microservice containers and clean the environment. The <span id="ITerm32">environment cleanup steps</span> are automated in the script in Listing <span class="InternalRef"><a href="#PC12">8-11</a></span>.<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean</div><div class="FixedLine">docker stop product-web</div><div class="FixedLine">docker stop product-server</div><div class="FixedLine">docker stop mongo</div><div class="FixedLine">docker rm product-web</div><div class="FixedLine">docker rm product-server</div><div class="FixedLine">docker rm mongo</div><div class="FixedLine">docker rmi -f ecom/product-web</div><div class="FixedLine">docker rmi -f ecom/product-server</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-11</span><p class="SimplePara">Script Automating the Environment Cleanup (ch08\ch08-01\clean.sh)</p></div></div></div></div>

          <div class="Para" id="Par53">You can execute the script in Listing <span class="InternalRef"><a href="#PC13">8-12</a></span> to stop and remove the microservice containers and clean the environment.<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-03/ch08/ch08-01</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ sh clean.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO] --------------------------------------------------</div><div class="FixedLine">[INFO] Reactor Build Order:</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Ecom-Product-Server-Microservice    [jar]</div><div class="FixedLine">[INFO] Ecom-Product-Web-Microservice       [jar]</div><div class="FixedLine">[INFO] Ecom                                [pom]</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">mongo</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">mongo</div><div class="FixedLine">Untagged: ecom/product-web:latest</div><div class="FixedLine">Deleted: sha256:42ce83c1cbcb195e66db8b9541f7bd391764d0759d99753725a0b97d34d2b2fd</div><div class="FixedLine">...</div><div class="FixedLine">Untagged: ecom/product-server:latest</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-12</span><p class="SimplePara">Stopping <span id="ITerm33">Microservice</span> Containers and Cleaning the Environment</p></div></div></div></div>

          <p class="Para" id="Par54">The next example slightly modifies the current example to use a network in place of a link.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec11">

        <h2 class="Heading">Microservice and MongoDB Containers Using a Network</h2>

        <p class="Para" id="Par55">In this section, you are going to reuse the same <span id="ITerm34">microservices</span> visited in the section titled “Microservices Using MongoDB and CrudRepository” in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>, which you ran in the previous section of this chapter. You will have the same two microservices—a consumer and a provider microservice communicating each other using the REST protocol. The provider microservice also interacts with a MongoDB. Refer to Figure <span class="ExternalRef"><a href="Capítulo-04.html#Fig1"><span class="RefSource">2-1</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-04.html"><span class="RefSource">2</span></a></span> for the overall design.</p>

        <section class="Section2 RenderAsSection2" id="Sec12">

          <h3 class="Heading">Designing the Container Topology</h3>

          <p class="Para" id="Par56">You reuse the deployment schema defined in the previous example in this chapter, as shown in Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span>. The only change is that you will replace <span class="EmphasisFontCategoryNonProportional ">link</span> with <span class="EmphasisFontCategoryNonProportional ">net</span> for the <span id="ITerm35">network connectivity option</span> between the containers.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec13">

          <h3 class="Heading">Understanding the Source Code</h3>

          <p class="Para" id="Par57">The <span id="ITerm36">source code</span> for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The code for this example is organized inside the <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-02</span> folder. The source code in this example is very similar to <span class="EmphasisFontCategoryNonProportional ">ch03\ch03-02</span>, which I explained in detail in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>, and which you deployed in the previous example of this chapter.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec14">

          <h3 class="Heading">Run Containers Using Dockerfiles</h3>

          <div class="Para" id="Par58">You will modify the scripts alone in the previous example in this chapter. Listing <span class="InternalRef"><a href="#PC14">8-13</a></span> shows the commands organized into a single script.<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean package</div><div class="FixedLine">docker build  --build-arg JAR_FILE=02-ProductWeb/target/*.jar -t ecom/product-web .</div><div class="FixedLine">docker build  --build-arg JAR_FILE=01-ProductServer/target/*.jar -t ecom/product-server .</div><div class="FixedLine">docker network create ecom-network</div><div class="FixedLine">docker pull mongo:3.6</div><div class="FixedLine">docker run -d -it -p 27017:27017 --name mongo  --net=ecom-network  mongo:3.6</div><div class="FixedLine">docker run -d -p 8081:8081  --net=ecom-network --name product-server ecom/product-server</div><div class="FixedLine">docker run -d -p 8080:8080  --net=ecom-network --name product-web ecom/product-web</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-13</span><p class="SimplePara">Script to Build and Run Microservices <span id="ITerm37">Docker Containers</span> (ch08\ch08-02\makeandrun.sh)</p></div></div></div></div>

          <p class="Para" id="Par59">Note the network creation command. This is the simplest form of the <span class="EmphasisFontCategoryNonProportional ">create network</span> command, and yet it will probably be the one you will use most often. It takes a default driver (you haven’t specified a driver, hence the default one will be used, which is <span class="EmphasisFontCategoryNonProportional ">bridge</span>). When you create the network, an ID is created. You can later use this identifier to refer to this network when connecting containers to it or when inspecting the network’s properties.</p>

          <p class="Para" id="Par60">The <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> for this example is the same <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> you used in the previous example, which is shown in Listing <span class="InternalRef"><a href="#PC6">8-5</a></span>.</p>

          <div class="Para" id="Par61">Listing <span class="InternalRef"><a href="#PC15">8-14</a></span> builds the microservices <span id="ITerm38">and docker images</span> and then runs the containers.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-03/ch08/ch08-02</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ sh makeandrun.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">...</div><div class="FixedLine">a9f5da94581b4f3a492938734edca433c1fc6afbe954ad4e28ead4621dd</div><div class="FixedLine">d762e59b315dfece79e7b98deb6b01796a9210b9536ede1f36a98af67af</div><div class="FixedLine">b51443e6a5d0cfcc16efc54e52858353ce5aa0ada1a23012dc88dfa49f0</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-14</span><p class="SimplePara">Executing the Script to Build and Run the Microservices</p></div></div></div></div>

          <div class="Para" id="Par62">You need to newly create the <span class="EmphasisFontCategoryNonProportional ">ecom-network</span> in Listing <span class="InternalRef"><a href="#PC14">8-13</a></span>, so you need to view the creation status. See Listing <span class="InternalRef"><a href="#PC16">8-15</a></span>.<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ docker network ls</div><div class="FixedLine">NETWORK ID     NAME              DRIVER    SCOPE</div><div class="FixedLine">435b063e810b   bridge            bridge    local</div><div class="FixedLine">129e1b5f4de5   ecom-network      bridge    local</div><div class="FixedLine">28731f4db9e0   host              host      local</div><div class="FixedLine">2480825a3deb   none              null      local</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-15</span><p class="SimplePara">Listing the <span id="ITerm39">Docker Networks</span></p></div></div></div></div>

          <p class="Para" id="Par63">The <span class="EmphasisFontCategoryNonProportional ">network ls</span> command simply lists networks available for your containers. It will output the network identifier, its name, the driver being used, and a scope of the network.</p>

          <div class="Para" id="Par64">To list all the containers you have on your system, execute the <span class="EmphasisFontCategoryNonProportional ">docker ps</span> command. See Listing <span class="InternalRef"><a href="#PC17">8-16</a></span>.<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ docker ps</div><div class="FixedLine">CONTAINER ID   IMAGE   COMMAND    CREATED      STATUS    PORTS        NAMES</div><div class="FixedLine">b51443e6a5d0   ecom/product-web       "java -jar /ecom.jar"   3 minutes ago   Up 3 minutes   0.0.0.0:8080-&gt;8080/tcp   roduct-web</div><div class="FixedLine">d762e59b315d   ecom/product-server    "java -jar /ecom.jar"    3 minutes ago   Up 3 minutes   0.0.0.0:8081-&gt;8081/tcp   t-server</div><div class="FixedLine">a9f5da94581b   mongo:3.6   "docker-entrypoint.s..."   3 minutes ago   Up 3 minutes   0.0.0.0:27017-&gt;27017/tcp   mongo</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-16</span><p class="SimplePara">Listing the <span id="ITerm40">Docker Containers</span></p></div></div></div></div>

          <div class="Para" id="Par65">You can now list the details of the <span class="EmphasisFontCategoryNonProportional ">ecom-network</span> you previously created, as shown in Listing <span class="InternalRef"><a href="#PC18">8-17</a></span>.<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ docker network inspect ecom-network</div><div class="FixedLine">[</div><div class="FixedLine">    {</div><div class="FixedLine">        "Name": "ecom-network",</div><div class="FixedLine">        "Id": "129e1b5f4de5a5c2bff188496f0148eed01204924d0c09c0be9be9d1f4e9557e",</div><div class="FixedLine">        "Created": "2022-06-02T10:06:06.119442393Z",</div><div class="FixedLine">        "Scope": "local",</div><div class="FixedLine">        "Driver": "bridge",</div><div class="FixedLine">        "EnableIPv6": false,</div><div class="FixedLine">        "IPAM": {</div><div class="FixedLine">            "Driver": "default",</div><div class="FixedLine">            "Options": {},</div><div class="FixedLine">            "Config": [</div><div class="FixedLine">                {</div><div class="FixedLine">                    "Subnet": "172.20.0.0/16",</div><div class="FixedLine">                    "Gateway": "172.20.0.1"</div><div class="FixedLine">                }</div><div class="FixedLine">            ]</div><div class="FixedLine">        },</div><div class="FixedLine">        "Internal": false,</div><div class="FixedLine">        "Attachable": false,</div><div class="FixedLine">        "Ingress": false,</div><div class="FixedLine">        "ConfigFrom": {</div><div class="FixedLine">            "Network": ""</div><div class="FixedLine">        },</div><div class="FixedLine">        "ConfigOnly": false,</div><div class="FixedLine">        "Containers": {</div><div class="FixedLine">            "a9f5da94581b4f3a492938734edca433c1fc6afbe954ad4e28ead4621ddf5d92": {</div><div class="FixedLine">                "Name": "mongo",</div><div class="FixedLine">                "EndpointID": "f2093e54a61c65800ca1a3da8f00927704fbeab12cf39df142ca36746321aba6",</div><div class="FixedLine">                "MacAddress": "02:42:ac:14:00:02",</div><div class="FixedLine">                "IPv4Address": "172.20.0.2/16",</div><div class="FixedLine">                "IPv6Address": ""</div><div class="FixedLine">            },</div><div class="FixedLine">            "b51443e6a5d0cfcc16efc54e52858353ce5aa0ada1a23012dc88dfa49f01c79d": {</div><div class="FixedLine">                "Name": "product-web",</div><div class="FixedLine">                "EndpointID": "9ca35c49812d5adc0c0d13585f0d7e7b007948e531951549625a78ae2f1fc225",</div><div class="FixedLine">                "MacAddress": "02:42:ac:14:00:04",</div><div class="FixedLine">                "IPv4Address": "172.20.0.4/16",</div><div class="FixedLine">                "IPv6Address": ""</div><div class="FixedLine">            },</div><div class="FixedLine">            "d762e59b315dfece79e7b98deb6b01796a9210b9536ede1f36a98af67afb2aa2": {</div><div class="FixedLine">                "Name": "product-server",</div><div class="FixedLine">                "EndpointID": "3990604146f3bc7c327606ab77b2de9f818c687a2f5a0bc5eaa86b64cfe5e3e0",</div><div class="FixedLine">                "MacAddress": "02:42:ac:14:00:03",</div><div class="FixedLine">                "IPv4Address": "172.20.0.3/16",</div><div class="FixedLine">                "IPv6Address": ""</div><div class="FixedLine">            }</div><div class="FixedLine">        },</div><div class="FixedLine">        "Options": {},</div><div class="FixedLine">        "Labels": {}</div><div class="FixedLine">    }</div><div class="FixedLine">]</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-17</span><p class="SimplePara">Inspecting a Particular <span id="ITerm41">Docker Network</span></p></div></div></div></div>

          <p class="Para" id="Par66">As you can see in Listing <span class="InternalRef"><a href="#PC18">8-17</a></span>, the newly created network uses the <span class="EmphasisFontCategoryNonProportional ">bridge</span> driver, as is evident in <span class="EmphasisFontCategoryNonProportional ">"Driver": "bridge"</span>. Even if you haven’t explicitly asked for it, it’s the default. The <span class="EmphasisFontCategoryNonProportional ">Containers</span> section lists the three containers to which you earlier connected this network.</p>

          <div class="Para" id="Par67">Note the container IDs from Listing <span class="InternalRef"><a href="#PC17">8-16</a></span>. You can use these IDs to view the logs.<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ docker logs --follow d762e59b315d</div><div class="FixedLine">...</div><div class="FixedLine">2022-06-02 10:06:24 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 10.378 seconds (JVM running for 11.925)</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-18</span><p class="SimplePara">Viewing Product Server <span id="ITerm42">Container Logs</span></p></div></div></div></div>

          <div class="Para" id="Par68">Listing <span class="InternalRef"><a href="#PC19">8-18</a></span> shows the Product Server container logs. Similarly, Listing <span class="InternalRef"><a href="#PC20">8-19</a></span> shows the Product Web container logs.<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ docker logs --follow b51443e6a5d0</div><div class="FixedLine">...</div><div class="FixedLine">2022-06-02 10:06:23 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 9.058 seconds (JVM running for 10.648)</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-19</span><p class="SimplePara">Viewing Product Web <span id="ITerm43">Container Logs</span></p></div></div></div></div>

          <p class="Para" id="Par69">Once the containers are up and running, you can test the application.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec15">

          <h3 class="Heading">Testing the Microservice Containers</h3>

          <div class="Para" id="Par70">Since both <span id="ITerm44">microservices</span> are up and running, you can access the Product Web microservice. However, as mentioned in Appendix E, you have to get the minikube IP first. See Listing <span class="InternalRef"><a href="#PC21">8-20</a></span>.<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$ minikube ip</div><div class="FixedLine">192.168.64.5</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-20</span><p class="SimplePara">Finding Minikube IP</p></div></div></div></div>

          <p class="Para" id="Par71">You can now access the Product Web microservice using a browser with the URL formed with the Minikube IP.</p>

          <p class="Para ParaOneEmphasisChild" id="Par72"><span class="EmphasisFontCategoryNonProportional ">http://192.168.64.5:8080/product.html</span></p>

          <p class="Para" id="Par73">Refer to the section titled “Test the Microservice Using UI” in Chapter <span class="ExternalRef"><a href="Capítulo-03.html"><span class="RefSource">1</span></a></span> to test the Product Web microservice container. While you test the microservices, keep watching the log windows.</p>

          <div class="Para" id="Par74">Once you complete the testing process, stop and remove the microservice containers and clean the environment. The environment cleanup steps are automated in a script, as shown in Listing <span class="InternalRef"><a href="#PC22">8-21</a></span>.<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean</div><div class="FixedLine">docker stop product-web</div><div class="FixedLine">docker stop product-server</div><div class="FixedLine">docker stop mongo</div><div class="FixedLine">docker rm product-web</div><div class="FixedLine">docker rm product-server</div><div class="FixedLine">docker rm mongo</div><div class="FixedLine">docker rmi -f ecom/product-web</div><div class="FixedLine">docker rmi -f ecom/product-server</div><div class="FixedLine">docker network rm ecom-network</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-21</span><p class="SimplePara">Script Automating the Environment Cleanup (ch08\ch08-02\clean.sh)</p></div></div></div></div>

          <div class="Para" id="Par75">You can now execute this script to stop and remove the microservice containers and clean the environment. See Listing <span class="InternalRef"><a href="#PC23">8-22</a></span>.<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$ sh clean.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO] --------------------------------------------------</div><div class="FixedLine">[INFO] Reactor Build Order:</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Ecom-Product-Server-Microservice     [jar]</div><div class="FixedLine">[INFO] Ecom-Product-Web-Microservice        [jar]</div><div class="FixedLine">[INFO] Ecom                                 [pom]</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">mongo</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">mongo</div><div class="FixedLine">Untagged: ecom/product-web:latest</div><div class="FixedLine">...</div><div class="FixedLine">Untagged: ecom/product-server:latest</div><div class="FixedLine">...</div><div class="FixedLine">ecom-network</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-22</span><p class="SimplePara">Stopping <span id="ITerm45">Microservice</span> Containers and Cleaning the Environment</p></div></div></div></div>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec16">

        <h2 class="Heading">Microservice Container with PostgreSQL in Host</h2>

        <p class="Para" id="Par76">This example reuses the microservices from the section titled “<span id="ITerm46">Microservices</span> Using PostgreSQL and RestTemplate” in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>. It includes the same two microservices—a consumer and a provider microservice communicating each other using the REST protocol. The provider microservice in this case interacts with a <span id="ITerm47">PostgreSQL database</span>. Refer to Figure <span class="ExternalRef"><a href="Capítulo-04.html#Fig1"><span class="RefSource">2-1</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-04.html"><span class="RefSource">2</span></a></span> for the overall design with the exception that this example uses a PostgreSQL database.</p>

        <section class="Section2 RenderAsSection2" id="Sec17">

          <h3 class="Heading">Designing the Container Topology</h3>

          <div class="Para" id="Par77">For this new design, you need to slightly tweak the container-based deployment topology in Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span>. This is shown in Figure <span class="InternalRef"><a href="#Fig2">8-2</a></span>. The Product Web and Product Server microservices are containerized, but the plan here is to use a <span id="ITerm48">PostgreSQL database</span> running outside a <span id="ITerm49">Docker container</span>, directly on the host operating system.<figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img alt="" aria-describedby="d64e1754" src="../images/619782_1_En_8_Chapter/Imagem-094.jpg" style="width:35.15em"/><div class="TextObject" id="d64e1754"><p class="Para" id="Par181">A microservices container topology design. It includes user, browser, container engine, host O S, and hardware.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-2</span><p class="SimplePara"><span id="ITerm50">Microservices</span> container topology design</p></div></figcaption></figure></div>

          <div class="Para" id="Par78">There are a few aspects to be noted with respect to the numbered labels in Figure <span class="InternalRef"><a href="#Fig2">8-2</a></span>:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent"><p class="Para" id="Par79">The <span id="ITerm51">Product Web microservice</span> connects to the Product Server microservice using networks between containers.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent"><p class="Para" id="Par80">To connect to the <span id="ITerm52">PostgreSQL database</span>, it is not enough that the Product Server microservice uses container networking alone, instead you need to explicitly tell the Product Server microservice container about the IP details of the host machine where you are running PostgreSQL database.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent"><p class="Para" id="Par81">The <span id="ITerm53">PostgreSQL database</span> is not containerized, so it doesn’t use any kind of virtualization. Instead, PostgreSQL is running directly on the host OS.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">4.</div><div class="ItemContent"><p class="Para" id="Par82">PostgreSQL directly uses the host machine resources, especially for the data storage requirements.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">5.</div><div class="ItemContent"><p class="Para" id="Par83">The <span id="ITerm54">Product Server microservice</span> is not a physical organization; it’s a virtual grouping of the Product Server microservice container and the PostgreSQL database in the host machine together.</p></div><div class="ClearBoth"> </div></li></ol></div></div>

          <p class="Para" id="Par84">Let’s now look at why you need this kind of deployment architecture.</p>

          <p class="Para" id="Par85"><span id="ITerm55">Orchestration tools</span> like Docker are created with the assumption that they are stateless, which means that they should not save any data during the run. If containers are stateful they might end up having several containers of a certain type act differently even if they are instantiated from the same image. However, databases store state, so they are stateful. Because of this, a deployment architecture like the one shown in Figure <span class="InternalRef"><a href="#Fig2">8-2</a></span> could work. Of course, for production purposes, this single database instance (or cluster) will be instead in a public cloud, perhaps as a DBaaS (Database as a Service) instead of the local host machine (assuming that you are using a cloud-based deployment).</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec18">

          <h3 class="Heading">Understanding the Source Code</h3>

          <p class="Para" id="Par86">The <span id="ITerm56">source code</span> for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The code for this example is organized inside the <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-03</span> folder. Much of the source code in this example is similar to that in <span class="EmphasisFontCategoryNonProportional ">ch03\ch03-01</span>, which was explained in detail in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>, in the section titled “Microservices Using PostgreSQL and RestTemplate.” You saw the deployment schema of multiple interacting microservices in the previous two example, so, in this example, emphasis is on connecting to a non-containerized database.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec19">

          <h3 class="Heading">Container to PostgreSQL in Host Configuration</h3>

          <p class="Para" id="Par87">Since the <span id="ITerm57">Postgres database</span> is running on the host system, you need to allow the Docker container running the Product Server microservice to connect to a local PostgreSQL <span id="ITerm58">database</span>. Assuming you don’t want the container to share the network with the host (using <span class="EmphasisFontCategoryNonProportional ">--network</span> host parameter while running it), the database and the container need to be configured to communicate.</p>

          <div class="Para" id="Par88">Refer to these sections in Appendix C on PostgreSQL:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par89">Opening a PostgreSQL server for remote clients</p></li><li><p class="Para" id="Par90">Opening PostgreSQL on a host machine for Docker clients</p></li></ul></div></div>

          <p class="Para" id="Par91">Those configurations should be enough to create a Postgre database running on a host system work with a containerized app.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec20">

          <h3 class="Heading">Run Containers Using Dockerfiles</h3>

          <div class="Para" id="Par92">The <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-03</span> folder contains the Maven scripts required to build the examples. As a first step, you need to bring up the PostgreSQL <span id="ITerm59">server</span>. This example assumes you already have a PostgreSQL server running, and you have configured it as mentioned previously. You need to execute the following commands in Listing <span class="InternalRef"><a href="#PC24">8-23</a></span> to bring up PostgreSQL.<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">binildass-MacBook-Pro:~ binil$ pg_ctl -D /Library/PostgreSQL/12/data start</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-23</span><p class="SimplePara">Bringing Up the PostgreSQL Server</p></div></div></div></div>

          <div class="Para" id="Par93">If you have already made the configurations required for the Postgres database running on a host system work with a containerized app in the previous section, you now need to tell the container about the host’s IP address. You can pass the host’s IP using the <span class="EmphasisFontCategoryNonProportional ">--add-host</span> option, which is done in Listing <span class="InternalRef"><a href="#PC26">8-25</a></span>. In this case, the host is a name of the host machine, and it will be added to the container’s <span class="EmphasisFontCategoryNonProportional ">/etc/hosts</span> file. Inside the Docker container, you can use the name <span class="EmphasisFontCategoryNonProportional ">host</span> to connect to the host system. You need to have the IP of the host where <span id="ITerm60">PostgreSQL</span> is running, which you find in Listing <span class="InternalRef"><a href="#PC25">8-24</a></span>.<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">binildass-MacBook-Pro:~ binil$ ipconfig getifaddr en0</div><div class="FixedLine">192.168.29.96</div><div class="FixedLine">binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-24</span><p class="SimplePara">Finding the IP of PostgreSQL Host Machine</p></div></div></div></div>

          <p class="Para" id="Par94">The <span id="ITerm61"><span class="EmphasisFontCategoryNonProportional ">Dockerfile</span></span> in this example is the same <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> used in the previous example, which is shown in Listing <span class="InternalRef"><a href="#PC6">8-5</a></span>.</p>

          <div class="Para" id="Par95">Next, build the microservices <span id="ITerm62">and Docker images</span> and then run the containers. You will modify the scripts in the previous example in this chapter. Listing <span class="InternalRef"><a href="#PC26">8-25</a></span> organizes the commands into a single script.<div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean package</div><div class="FixedLine">docker build  --build-arg JAR_FILE=01-ProductServer/target/*.jar -t ecom/product-server .</div><div class="FixedLine">docker build  --build-arg JAR_FILE=02-ProductWeb/target/*.jar -t ecom/product-web .</div><div class="FixedLine">docker network create ecom-network</div><div class="FixedLine">docker run -d -p 8081:8081 --net=ecom-network --add-host=host:192.168.29.96 --name product-server -e DB_SERVER=host:5432 -e POSTGRES_DB=productdb -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgre ecom/product-server</div><div class="FixedLine">docker run -d -p 8080:8080 --net=ecom-network --name product-web -e acme.PRODUCT_SERVICE_URL=http://product-server:8081/products ecom/product-web</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-25</span><p class="SimplePara">Script to Build and Run Microservices Docker Containers (ch08\ch08-03\makeandrun.sh)</p></div></div></div></div>

          <div class="Para" id="Par96">To build the microservices and the <span id="ITerm63">Docker images</span> and then run the containers, you need to execute the script in Listing <span class="InternalRef"><a href="#PC26">8-25</a></span>, as shown in Listing <span class="InternalRef"><a href="#PC27">8-26</a></span>.<div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-03 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-03/ch08/ch08-03</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-03 binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-03 binil$ sh makeandrun.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO] --------------------------------------------------</div><div class="FixedLine">[INFO] Reactor Build Order:</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Ecom-Product-Server-Microservice    [jar]</div><div class="FixedLine">[INFO] Ecom-Product-Web-Microservice       [jar]</div><div class="FixedLine">[INFO] Ecom                                [pom]</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">Sending build context to Docker daemon  83.36MB</div><div class="FixedLine">Step 1/5 : FROM openjdk:8-jdk-alpine</div><div class="FixedLine"> ---&gt; a3562aa0b991</div><div class="FixedLine">...</div><div class="FixedLine">Successfully tagged ecom/product-server:latest</div><div class="FixedLine">...</div><div class="FixedLine">Successfully tagged ecom/product-web:latest</div><div class="FixedLine">3b852d90e2b71ac7f5c5a2a49d445c7daa3a37d9a695efd316f3c89107c</div><div class="FixedLine">c89e8b5749fe45c235280d03a666de4fce9c7a7ddb46a147bc507b92c06</div><div class="FixedLine">71e9c4b442275a4645009d046a506289271dd48a86b83d83683b13d5721</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-03 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-26</span><p class="SimplePara">Executing the Docker Container Build and Run Commands</p></div></div></div></div>

          <div class="Para" id="Par97">To list all the containers you have on your system now, execute the <span class="EmphasisFontCategoryNonProportional ">docker ps</span> command, as shown in Listing <span class="InternalRef"><a href="#PC28">8-27</a></span>.<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker ps</div><div class="FixedLine">CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS          PORTS                     NAMES</div><div class="FixedLine">71e9c4b44227   ecom/product-web      "java -jar /ecom.jar"   3 minutes ago   Up 3 minutes   0.0.0.0:8080-&gt;8080/tcp    product-web</div><div class="FixedLine">c89e8b5749fe   ecom/product-server   "java -jar /ecom.jar"   3 minutes ago   Up 3 minutes   0.0.0.0:8081-&gt;8081/tcp    product-server</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-27</span><p class="SimplePara">Listing <span id="ITerm64">Docker Containers</span></p></div></div></div></div>

          <div class="Para" id="Par98">Note the container IDs from Listing <span class="InternalRef"><a href="#PC28">8-27</a></span>. You can use these IDs to view the logs, as shown in Listing <span class="InternalRef"><a href="#PC29">8-28</a></span>.<div class="ProgramCode" id="PC29"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow c89e8b5749fe</div></div><div class="LineGroup"><div class="FixedLine">  .   ____          _            __ _ _</div><div class="FixedLine"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">  '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine"> =========|_|==============|___/=/_/_/_/</div><div class="FixedLine"> :: Spring Boot ::                (v3.2.0)</div></div><div class="LineGroup"><div class="FixedLine">...</div><div class="FixedLine">Creating 2 new products in DB during initialization</div><div class="FixedLine">Hibernate: insert into product (code, prodname, price, title) values (?, ?, ?, ?)</div><div class="FixedLine">Hibernate: insert into product (code, prodname, price, title) values (?, ?, ?, ?)</div><div class="FixedLine">2022-05-30 07:18:02 INFO  InitializationComponent.init:74 - End</div><div class="FixedLine">2022-05-30 07:18:04 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 13.101 seconds (JVM running for 15.006)</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-28</span><p class="SimplePara">Viewing <span id="ITerm65">Product Server Container Logs</span></p></div></div></div></div>

          <div class="Para" id="Par99">Listing <span class="InternalRef"><a href="#PC29">8-28</a></span> shows the Product Server container logs. Similarly, Listing <span class="InternalRef"><a href="#PC30">8-29</a></span> shows the Product Web container logs.<div class="ProgramCode" id="PC30"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow 71e9c4b44227</div><div class="FixedLine">...</div><div class="FixedLine">2022-05-30 07:18:00 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 8.835 seconds (JVM running for 10.646)</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-29</span><p class="SimplePara">Viewing <span id="ITerm66">Product Web Container Logs</span></p></div></div></div></div>

          <p class="Para" id="Par100">Once the containers are up and running, you are ready to test the application.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec21">

          <h3 class="Heading">Testing the Microservice Containers</h3>

          <div class="Para" id="Par101">Since both <span id="ITerm67">microservices</span> are up and running, you can access the Product Web microservice. However, as mentioned in Appendix E, you must get the Minikube IP first. See Listing <span class="InternalRef"><a href="#PC31">8-30</a></span>.<div class="ProgramCode" id="PC31"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$ minikube ip</div><div class="FixedLine">192.168.64.5</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-30</span><p class="SimplePara">Finding Minikube IP</p></div></div></div></div>

          <p class="Para" id="Par102">You can now access the <span id="ITerm68">Product Web microservice</span> using a browser with the URL formed with the Minikube IP (see Figure <span class="InternalRef"><a href="#Fig3">8-3</a></span>).</p>

          <div class="Para" id="Par103"><span class="EmphasisFontCategoryNonProportional ">http://192.168.64.5:8080/product.html</span><figure class="Figure" id="Fig3"><div class="MediaObject" id="MO3"><img alt="" aria-describedby="d64e2232" src="../images/619782_1_En_8_Chapter/Imagem-095.jpg" style="width:35.15em"/><div class="TextObject" id="d64e2232"><p class="Para" id="Par182">A screenshot titled manage products has the following options. Id. Name. Code. Title. Price. Actions.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-3</span><p class="SimplePara">Accessing the <span id="ITerm69">microservices</span> container using a browser</p></div></figcaption></figure></div>

          <p class="Para" id="Par104">Refer to the section titled “Test the Microservice Using UI” in Chapter <span class="ExternalRef"><a href="Capítulo-03.html"><span class="RefSource">1</span></a></span> to test the Product Web microservice container. While you test the microservices, keep watching the log windows.</p>

          <div class="Para" id="Par105">You can add a new product to the application for testing, as shown in Figure <span class="InternalRef"><a href="#Fig4">8-4</a></span>.<figure class="Figure" id="Fig4"><div class="MediaObject" id="MO4"><img alt="" aria-describedby="d64e2260" src="../images/619782_1_En_8_Chapter/Imagem-096.jpg" style="width:35.15em"/><div class="TextObject" id="d64e2260"><p class="Para" id="Par183">A screenshot titled product details has the following fields. Id. Name. Code. Title. Price.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-4</span><p class="SimplePara">Adding a new product to test the <span id="ITerm70">microservice</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par106">Refresh your browser to view the newly added product, as shown in Figure <span class="InternalRef"><a href="#Fig5">8-5</a></span>.<figure class="Figure" id="Fig5"><div class="MediaObject" id="MO5"><img alt="" aria-describedby="d64e2277" src="../images/619782_1_En_8_Chapter/Imagem-097.jpg" style="width:35.15em"/><div class="TextObject" id="d64e2277"><p class="Para" id="Par184">A screenshot titled manage products has the following fields. It includes Id, name, code, title, price, and actions.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-5</span><p class="SimplePara">Refreshing the browser to view the newly added product</p></div></figcaption></figure></div>

          <div class="Para" id="Par107">To make sure everything went as expected and your Product Server microservice has in fact persisted the data to the PostgreSQL <span id="ITerm71">database</span> in the host machine, you can now inspect the PostgreSQL database. Refer to the section titled “Create Database in PostgreSQL Using pgAdmin” in Appendix C on how to use <span class="EmphasisFontCategoryNonProportional ">pgAdmin</span> to interact with a PostgreSQL database. You can see this in Figure <span class="InternalRef"><a href="#Fig6">8-6</a></span>.<figure class="Figure" id="Fig6"><div class="MediaObject" id="MO6"><img alt="" aria-describedby="d64e2304" src="../images/619782_1_En_8_Chapter/Imagem-098.jpg" style="width:35.15em"/><div class="TextObject" id="d64e2304"><p class="Para" id="Par185">A screenshot titled admin has the following folders. Language. Schemas. Public. Product. The product folder is selected.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-6</span><p class="SimplePara">Viewing the newly added product using pgAdmin</p></div></figcaption></figure></div>

          <div class="Para" id="Par108">Once you complete the testing process, you can stop and remove the microservice containers and clean the environment. The environment cleanup is automated in a script, as shown in Listing <span class="InternalRef"><a href="#PC32">8-31</a></span>.<div class="ProgramCode" id="PC32"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean</div><div class="FixedLine">docker stop product-web</div><div class="FixedLine">docker stop product-server</div><div class="FixedLine">docker rm product-web</div><div class="FixedLine">docker rm product-server</div><div class="FixedLine">docker rmi -f ecom/product-web</div><div class="FixedLine">docker rmi -f ecom/product-server</div><div class="FixedLine">docker network rm ecom-network</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-31</span><p class="SimplePara">Script Automating the Environment Cleanup (ch08\ch08-03\clean.sh)</p></div></div></div></div>

          <div class="Para" id="Par109">You can execute this script to stop and remove the microservice <span id="ITerm72">containers</span> and clean the environment. See Listing <span class="InternalRef"><a href="#PC33">8-32</a></span>.<div class="ProgramCode" id="PC33"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-03 binil$ sh clean.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">...</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">Untagged: ecom/product-web:latest</div><div class="FixedLine">...</div><div class="FixedLine">Untagged: ecom/product-server:latest</div><div class="FixedLine">...</div><div class="FixedLine">ecom-network</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-03 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-32</span><p class="SimplePara">Stopping Microservice Containers and Cleaning the Environment</p></div></div></div></div>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec22">

        <h2 class="Heading">Microservice and PostgreSQL in Container</h2>

        <p class="Para" id="Par110">You learned why it’s better to state-handle applications, including databases, to be deployed outside a <span id="ITerm73">Docker container</span>, since containers are designed to be more efficient in stateless kind of operations. However, there are use cases where you might like to have your database in a container, such as in cases of rapid testing. In this section, you learn how to modify the example from the previous section to be fully deployed within a <span id="ITerm74">container infrastructure</span>.</p>

        <section class="Section2 RenderAsSection2" id="Sec23">

          <h3 class="Heading">Designing the Container Topology</h3>

          <div class="Para" id="Par111">For the current design, you need to slightly tweak the <span id="ITerm75">container-based deployment topology</span> shown in Figure <span class="InternalRef"><a href="#Fig1">8-1</a></span> and replace MongoDB with PostgreSQL. This is shown in Figure <span class="InternalRef"><a href="#Fig7">8-7</a></span>. The Product Web and Product Server microservices are containerized, and the <span id="ITerm76">Product Server microservice</span> will connect to a PostgreSQL database, again deployed as a container.<figure class="Figure" id="Fig7"><div class="MediaObject" id="MO7"><img alt="" aria-describedby="d64e2436" src="../images/619782_1_En_8_Chapter/Imagem-099.jpg" style="width:35.15em"/><div class="TextObject" id="d64e2436"><p class="Para" id="Par186">A diagram illustrates the container deployment topology for microservices. It includes user, browser, container engine, host O S, and hardware.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-7</span><p class="SimplePara">Container deployment topology for microservices</p></div></figcaption></figure></div>

          <p class="Para" id="Par112">Here again, the Product Web and Product Server containers provide business services, whereas the PostgreSQL container provides <span id="ITerm77">application</span> services for persisting state.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec24">

          <h3 class="Heading">Understanding the Source Code</h3>

          <p class="Para" id="Par113">The <span id="ITerm78">source code</span> for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The code for this example is organized inside the <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-04</span> folder. The source code in this example is very similar to <span class="EmphasisFontCategoryNonProportional ">ch03\ch03-01</span>, which was explained in detail in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>, in the section titled “Microservices Using PostgreSQL and RestTemplate.” You also saw the deployment schema of multiple interacting microservices using a PostgreSQL database in the previous example. This section looks specifically into connecting to a containerized PostgreSQL database alone.</p>

          <p class="Para" id="Par114">Connecting from a containerized microservice to a containerized <span id="ITerm79">PostgreSQL server</span> is rather straightforward, so there is very little change to be made while running the containers alone. You will learn about that in the next section.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec25">

          <h3 class="Heading">Run Containers Using Dockerfiles</h3>

          <p class="Para" id="Par115">The <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-04</span> folder contains the <span id="ITerm80">Maven scripts</span> required to build the examples. As a first step, you need to bring up the PostgreSQL server. The <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> for this example is the same <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> used in the previous three examples, and it is shown in Listing <span class="InternalRef"><a href="#PC6">8-5</a></span>.</p>

          <div class="Para" id="Par116">Next, build the <span id="ITerm81">microservices</span> and the Docker images and then run the containers. You will modify the scripts in the previous example in this chapter. Listing <span class="InternalRef"><a href="#PC34">8-33</a></span> organizes the commands into a single script.<div class="ProgramCode" id="PC34"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean package</div><div class="FixedLine">docker build  --build-arg JAR_FILE=01-ProductServer/target/*.jar -t ecom/product-server .</div><div class="FixedLine">docker build  --build-arg JAR_FILE=02-ProductWeb/target/*.jar -t ecom/product-web .</div><div class="FixedLine">docker network create ecom-network</div><div class="FixedLine">docker run -d --net=ecom-network --name postgres-docker -e POSTGRES_DB=productdb -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgre -p 5432:5432 -d postgres:15.3-alpine3.18</div><div class="FixedLine">docker run -d -p 8081:8081 --net=ecom-network --name product-server -e DB_SERVER=postgres-docker:5432 -e POSTGRES_DB=productdb -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgre ecom/product-server</div><div class="FixedLine">docker run -d -p 8080:8080 --net=ecom-network --name product-web -e acme.PRODUCT_SERVICE_URL=http://product-server:8081/products ecom/product-web</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-33</span><p class="SimplePara">Script to Build and Run Microservices Docker Containers (ch08\ch08-04\makeandrun.sh)</p></div></div></div></div>

          <div class="Para" id="Par117">This section explains the Docker Run command for <span id="ITerm82">PostgreSQL server</span> alone, since the rest of the commands have been explained.<div class="ProgramCode" id="PC35"><div class="LineGroup"><div class="FixedLine">docker run -d --net=ecom-network --name postgres-docker -e POSTGRES_DB=productdb -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgre -p 5432:5432 -d postgres:9.6-alpine</div></div></div></div>

          <div class="Para" id="Par118">Here is what this does:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par119">This first line pulls the Postgres Docker image from Docker Hub.</p></li><li><p class="Para" id="Par120">It then sets <span class="EmphasisFontCategoryNonProportional ">POSTGRES_DB</span>, which is an optional environment variable used to define a different name for the default database that is created when the image starts. If it is not specified, the value of <span class="EmphasisFontCategoryNonProportional ">POSTGRES_USER</span> will be used.</p></li><li><p class="Para" id="Par121">It then sets the <span class="EmphasisFontCategoryNonProportional ">POSTGRES_USER</span>, which is an optional environment variable used in conjunction with <span class="EmphasisFontCategoryNonProportional ">POSTGRES_PASSWORD</span> to set a user and its password. This variable will create the specified user with superuser power and a database with the same name (which I have overridden). If it is not specified, the default user of <span class="EmphasisFontCategoryNonProportional ">postgres</span> will be used.</p></li><li><p class="Para" id="Par122">It then sets the <span class="EmphasisFontCategoryNonProportional ">POSTGRES_PASSWORD</span>, which is an environment variable required for you to use the PostgreSQL image. It must not be empty or undefined. This environment variable sets the superuser password for PostgreSQL. The default superuser is defined by the <span class="EmphasisFontCategoryNonProportional ">POSTGRES_USER</span> environment variable.</p></li><li><p class="Para" id="Par123">It then names (<span class="EmphasisFontCategoryNonProportional ">--name</span>) the Docker container to be <span class="EmphasisFontCategoryNonProportional ">postgres-docker</span>.</p></li><li><p class="Para" id="Par124">It maps the container’s internal <span class="EmphasisFontCategoryNonProportional ">5432</span> port to external <span class="EmphasisFontCategoryNonProportional ">5432</span> port, so you’ll be able to enter it from outside.</p></li><li><p class="Para" id="Par125">It then enables to run the Docker container in the background (<span class="EmphasisFontCategoryNonProportional ">-d</span>).</p></li></ul></div></div>

          <p class="Para" id="Par126">If you want to enter into the database using a GUI application (like pgAdmin, psql, or so), you should now be able to do so.</p>

          <div class="Para" id="Par127">You can build the <span id="ITerm83">microservices</span> and the docker images and then run the containers, as shown in Listing <span class="InternalRef"><a href="#PC36">8-34</a></span>.<div class="ProgramCode" id="PC36"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-03/ch08/ch08-04</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-04 binil$ sh makeandrun.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO] -------------------------------------------------</div><div class="FixedLine">[INFO] Reactor Build Order:</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Ecom-Product-Server-Microservice                [jar]</div><div class="FixedLine">[INFO] Ecom-Product-Web-Microservice                   [jar]</div><div class="FixedLine">[INFO] Ecom                                            [pom]</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">Sending build context to Docker daemon  82.32MB</div><div class="FixedLine">Step 1/5 : FROM openjdk:8-jdk-alpine</div><div class="FixedLine">...</div><div class="FixedLine">Successfully tagged ecom/product-server:latest</div><div class="FixedLine">...</div><div class="FixedLine">Successfully tagged ecom/product-web:latest</div><div class="FixedLine">e5f38c5b37460b3889e284a7d1ccb4f7c32f6147516f81b90d26a8fbeb8</div><div class="FixedLine">Unable to find image 'postgres:9.6-alpine' locally</div><div class="FixedLine">9.6-alpine: Pulling from library/postgres</div><div class="FixedLine">59bf1c3509f3: Pull complete</div><div class="FixedLine">...</div><div class="FixedLine">Status: Downloaded newer image for postgres:9.6-alpine</div><div class="FixedLine">72d0bc450b9057b7c21bcd30ad3dffc4a1e04fd79415b9cd254057785cf</div><div class="FixedLine">e309c7db0b1f72f96bf8ba19999f0e471aaff47cce056e8d757a3d3713a</div><div class="FixedLine">f624b4b3fd732135948d61b23c07d31c54c07e7bc5e370a57485e7cfd7b</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-04 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-34</span><p class="SimplePara">The <span id="ITerm84">Dockerfile</span> Build and Run Commands</p></div></div></div></div>

          <div class="Para" id="Par128">To list all the containers you have on your system now, execute the <span class="EmphasisFontCategoryNonProportional ">docker ps</span> command, as shown in Listing <span class="InternalRef"><a href="#PC37">8-35</a></span>.<div class="ProgramCode" id="PC37"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker ps</div><div class="FixedLine">CONTAINER ID   IMAGE                 COMMAND                    CREATED         STATUS         PORTS                    NAMES</div><div class="FixedLine">f624b4b3fd73   ecom/product-web      "java -jar /ecom.jar"      2 minutes ago   Up 2 minutes   0.0.0.0:8080-&gt;8080/tcp   product-web</div><div class="FixedLine">e309c7db0b1f   ecom/product-server   "java -jar /ecom.jar"      2 minutes ago   Up 2 minutes   0.0.0.0:8081-&gt;8081/tcp   product-server</div><div class="FixedLine">72d0bc450b90   postgres:9.6-alpine   "docker-entrypoint.s..."   2 minutes ago   Up 2 minutes   0.0.0.0:5432-&gt;5432/tcp   postgres-docker</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-35</span><p class="SimplePara">Listing <span id="ITerm85">Docker Containers</span></p></div></div></div></div>

          <div class="Para" id="Par129">Note the container IDs from Listing <span class="InternalRef"><a href="#PC37">8-35</a></span>. You can use these IDs to view the logs, as shown in Listings <span class="InternalRef"><a href="#PC38">8-36</a></span> and <span class="InternalRef"><a href="#PC39">8-37</a></span>.<div class="ProgramCode" id="PC38"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow e309c7db0b1f</div></div><div class="LineGroup"><div class="FixedLine">  .   ____          _            __ _ _</div><div class="FixedLine"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">  '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine"> =========|_|==============|___/=/_/_/_/</div><div class="FixedLine"> :: Spring Boot ::                (v3.2.0)</div></div><div class="LineGroup"><div class="FixedLine">...</div><div class="FixedLine">Creating 2 new products in DB during initialization</div><div class="FixedLine">Hibernate: insert into product (code, prodname, price, title) values (?, ?, ?, ?)</div><div class="FixedLine">Hibernate: insert into product (code, prodname, price, title) values (?, ?, ?, ?)</div><div class="FixedLine">2022-05-30 10:29:35 INFO  InitializationComponent.init:74 - End</div><div class="FixedLine">2022-05-30 10:29:37 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 12.887 seconds (JVM running for 15.075)</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-36</span><p class="SimplePara">Product Server <span id="ITerm86">Container Logs</span></p></div></div></div></div>

          <div class="Para" id="Par130">Listing <span class="InternalRef"><a href="#PC38">8-36</a></span> shows the <span id="ITerm87">Product Server</span> container logs. Note two rows are inserted as initial data in the database. Similarly, Listing <span class="InternalRef"><a href="#PC39">8-37</a></span> shows the product Web container logs.<div class="ProgramCode" id="PC39"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow f624b4b3fd73</div><div class="FixedLine">...</div><div class="FixedLine">2022-05-30 10:29:34 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 8.81 seconds (JVM running for 10.568)</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-37</span><p class="SimplePara">Product Web <span id="ITerm88">Container Logs</span></p></div></div></div></div>

          <p class="Para" id="Par131">Once the containers are up and running, you can test the application.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec26">

          <h3 class="Heading">Testing the Microservice Containers</h3>

          <div class="Para" id="Par132">Since the microservices <span id="ITerm89">and database</span> containers are up and running now, you can access the Product Web microservice. However, as mentioned in Appendix E, you have to get the minikube IP first. See Listing <span class="InternalRef"><a href="#PC40">8-38</a></span>.<div class="ProgramCode" id="PC40"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$ minikube ip</div><div class="FixedLine">192.168.64.5</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-38</span><p class="SimplePara">Finding Minikube IP</p></div></div></div></div>

          <p class="Para" id="Par133">You can now access the Product Web microservice using a browser with the URL formed with the Minikube IP.</p>

          <p class="Para ParaOneEmphasisChild" id="Par134"><span class="EmphasisFontCategoryNonProportional ">http://192.168.64.5:8080/product.html</span></p>

          <p class="Para" id="Par135">Refer to the section titled “Test the Microservice Using UI” in Chapter <span class="ExternalRef"><a href="Capítulo-03.html"><span class="RefSource">1</span></a></span> to test the Product Web microservice container. While you test the microservices, keep watching the log windows.</p>

          <div class="Para" id="Par136">You can also access the <span id="ITerm90">PostgreSQL server</span> in the Docker container using the <span class="EmphasisFontCategoryNonProportional ">psql</span> terminal. Refer to the Appendix C section titled “Run Commands Against PostgreSQL Server Using psql” to get an overview of various terminal commands. See Listing <span class="InternalRef"><a href="#PC41">8-39</a></span>.<div class="ProgramCode" id="PC41"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker exec -it postgres-docker bash</div><div class="FixedLine">bash-5.1# psql -U postgres</div><div class="FixedLine">psql (9.6.24)</div><div class="FixedLine">Type "help" for help.</div></div><div class="LineGroup"><div class="FixedLine">postgres=# \list</div><div class="FixedLine">                                 List of databases</div><div class="FixedLine">   Name    |  Owner   | Encoding |  Collate   |   Ctype    |</div><div class="FixedLine">-----------+----------+----------+------------+------------+-</div><div class="FixedLine"> postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 |</div><div class="FixedLine"> productdb | postgres | UTF8     | en_US.utf8 | en_US.utf8 |</div><div class="FixedLine"> template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 |</div></div><div class="LineGroup"><div class="FixedLine">postgres=CTc/postgres</div><div class="FixedLine">(4 rows)</div></div><div class="LineGroup"><div class="FixedLine">postgres=# \conninfo</div><div class="FixedLine">You are connected to database "postgres" as user "postgres" via socket in "/var/run/postgresql" at port "5432".</div><div class="FixedLine">postgres=# \c productdb</div><div class="FixedLine">You are now connected to database "productdb" as user "postgres".</div><div class="FixedLine">productdb=# \conninfo</div><div class="FixedLine">You are connected to database "productdb" as user "postgres" via socket in "/var/run/postgresql" at port "5432".</div><div class="FixedLine">productdb=# select * from product;</div><div class="FixedLine"> productid |  prodname   | code    |    title               | price</div><div class="FixedLine">-----------+-------------+---------------+------------------</div><div class="FixedLine">         1 | Kamsung D3  | KAMSUNG | Kamsung Trios 12 in..</div><div class="FixedLine">         2 | Lokia Pomia | LOKIA   | Lokia 12 inch..</div><div class="FixedLine">(2 rows)</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-39</span><p class="SimplePara"><span id="ITerm91">psql Terminal Access</span></p></div></div></div></div>

          <div class="Para" id="Par137">After verifying the initial data created by Product Server microservice in the <span id="ITerm92">PostgreSQL container</span>, you can add a new product to the application for testing purposes, as shown in Figure <span class="InternalRef"><a href="#Fig8">8-8</a></span>.<figure class="Figure" id="Fig8"><div class="MediaObject" id="MO8"><img alt="" aria-describedby="d64e2954" src="../images/619782_1_En_8_Chapter/Imagem-100.jpg" style="width:35.15em"/><div class="TextObject" id="d64e2954"><p class="Para" id="Par187">A screenshot titled product details has the following fields. Id. Name. Code. Title. Price.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-8</span><p class="SimplePara">Adding a new product to test the microservice</p></div></figcaption></figure></div>

          <div class="Para" id="Par138">Refresh your browser to view the newly added product. You can also refresh your terminal query to access the PostgreSQL server in the Docker container using the <span class="EmphasisFontCategoryNonProportional ">psql</span> terminal, as shown in Listing <span class="InternalRef"><a href="#PC42">8-40</a></span>.<div class="ProgramCode" id="PC42"><div class="LineGroup"><div class="FixedLine">productdb=# select * from product;</div><div class="FixedLine"> productid |  prodname   | code    |    title               | price</div><div class="FixedLine">-----------+-------------+---------------+------------------</div><div class="FixedLine">         1 | Kamsung D3  | KAMSUNG | Kamsung Trios 12 in..</div><div class="FixedLine">         2 | Lokia Pomia | LOKIA   | Lokia 12 inch..</div><div class="FixedLine">         3 | Fourth Prod | FOURTH  | Fourth Product for</div><div class="FixedLine">(3 rows)</div><div class="FixedLine">productdb=# \q</div><div class="FixedLine">bash-5.1# exit</div><div class="FixedLine">exit</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-40</span><p class="SimplePara"><span id="ITerm93">psql Terminal Access</span></p></div></div></div></div>

          <div class="Para" id="Par139">As in Listing <span class="InternalRef"><a href="#PC42">8-40</a></span>, you can verify that the newly inserted product through the Product Web microservice web app is safely persisted in the PostgreSQL database inside the container. Once you complete testing the microservices, you can then stop and remove the microservice containers and clean the environment using the script shown in Listing <span class="InternalRef"><a href="#PC43">8-41</a></span>.<div class="ProgramCode" id="PC43"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean</div><div class="FixedLine">docker stop product-web</div><div class="FixedLine">docker stop product-server</div><div class="FixedLine">docker stop postgres-docker</div><div class="FixedLine">docker rm product-web</div><div class="FixedLine">docker rm product-server</div><div class="FixedLine">docker rm postgres-docker</div><div class="FixedLine">docker rmi -f ecom/product-web</div><div class="FixedLine">docker rmi -f ecom/product-server</div><div class="FixedLine">docker network rm ecom-network</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-41</span><p class="SimplePara">Script Automating the <span id="ITerm94">Environment Cleanup</span> (ch08\ch08-04\clean.sh)</p></div></div></div></div>

          <div class="Para" id="Par140">You can execute the script shown in Listing <span class="InternalRef"><a href="#PC44">8-42</a></span> to stop and remove the microservice containers and clean the environment.<div class="ProgramCode" id="PC44"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-04 binil$ sh clean.sh</div><div class="FixedLine">...</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">postgres-docker</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">postgres-docker</div><div class="FixedLine">Untagged: ecom/product-web:latest</div><div class="FixedLine">...</div><div class="FixedLine">Untagged: ecom/product-server:latest</div><div class="FixedLine">...</div><div class="FixedLine">ecom-network</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-04 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-42</span><p class="SimplePara">Stopping <span id="ITerm95">Microservice Containers</span> and Cleaning the Environment</p></div></div></div></div>

          <p class="Para" id="Par141">You have now seen many examples exploring different scenarios of using containers with SQL and No SQL databases. Next, the chapter extends this learning to one more aspect—container storage.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec27">

        <h2 class="Heading">Container Storage</h2>

        <p class="Para" id="Par142">Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span> explained that the <span id="ITerm96">Docker container filesystem</span> is predominantly read-only and is a kind of temporary by default. When you start up a Docker image by running the container, you’re placing a read-write layer on top of the lower layer file stack. You can create, modify, and delete files as you wish. Only when you commit the changes back into the image do they become persisted. This is not very convenient when it comes to storing and retrieving data, which is supposed to be non-volatile. A better option is to separate the container lifecycle from the data it manages. You can keep these separate, so that the data managed (or being used) by your application is not destroyed or tied to the container lifecycle and can thus be reused.</p>

        <p class="Para" id="Par143">Separating long-lived data from containers is done via volumes, which this section investigates. Volumes are not part of the union filesystem, and so the write operations are instant and as fast as possible and there is no need to commit any changes. Since volumes live outside of the union filesystem, they exist as normal directories and files on the host filesystem.</p>

        <section class="Section2 RenderAsSection2" id="Sec28">

          <h3 class="Heading">Volumes</h3>

          <p class="Para" id="Par144"><span id="ITerm97">Volumes</span> are the preferred mechanism for persisting data generated by and used by Docker containers. Volumes are better than a container’s writable layer in persisting long-term data. Volumes do not increase the size of the containers using them, and the volume’s contents exist outside the lifecycle of a given container.</p>

          <div class="Para" id="Par145">There are two ways to create volumes:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par146">Specify the <span class="EmphasisFontCategoryNonProportional ">-v</span> option when running an image.</p></li><li><p class="Para" id="Par147">Use the command to create a volume prior to starting a container.</p></li></ul></div></div>

          <div class="Para" id="Par148">Let’s look at the first option here, which you will also use in the next example.<div class="ProgramCode" id="PC45"><div class="LineGroup"><div class="FixedLine">docker run  -d -it -p 27017:27017 --name mongo  --net=ecom-network -v /Users/binil/dockerbook/ch08-05/mongodata:/data/db  mongo:3.6</div></div></div></div>

          <p class="Para" id="Par149">You can create a <span id="ITerm98">volume</span> using the <span class="EmphasisFontCategoryNonProportional ">-v</span> switch and instruct Docker that the host directory <span class="EmphasisFontCategoryNonProportional ">/Users/binil/dockerbook/ch08-05/mongodata</span> should be mapped into the <span class="EmphasisFontCategoryNonProportional ">/data/db</span> directory in the running <span id="ITerm99">Mongo container</span>.</p>

          <p class="Para" id="Par150">Let’s straight look into an example.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec29">

        <h2 class="Heading">Microservice and MongoDB Containers Using File Mount</h2>

        <p class="Para" id="Par151">This example reuses the same <span id="ITerm100">microservices</span> from the section titled “Microservices using MongoDB and CrudRepository” in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>. The same two microservices are used—a consumer and a provider microservice communicating each other using the REST protocol. The provider microservice also interacts with a <span id="ITerm101">MongoDB</span>. Different from the first two MongoDB examples in this chapter, this example uses volumes to persist the Mongo database data. Refer to Figure <span class="ExternalRef"><a href="Capítulo-04.html#Fig1"><span class="RefSource">2-1</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-04.html"><span class="RefSource">2</span></a></span> for the overall design.</p>

        <section class="Section2 RenderAsSection2" id="Sec30">

          <h3 class="Heading">Designing the Container Topology</h3>

          <div class="Para" id="Par152">This example reuses the deployment schema defined in the first example in this chapter. However, there is a change—you will use <span id="ITerm102">volume</span> mount here. See Figure <span class="InternalRef"><a href="#Fig9">8-9</a></span>.<figure class="Figure" id="Fig9"><div class="MediaObject" id="MO9"><img alt="" aria-describedby="d64e3211" src="../images/619782_1_En_8_Chapter/Imagem-101.jpg" style="width:35.15em"/><div class="TextObject" id="d64e3211"><p class="Para" id="Par188">A diagram illustrates the container deployment topology for microservice. It includes user, browser, container engine, host O S, and hardware.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 8-9</span><p class="SimplePara">Container deployment topology for <span id="ITerm103">microservice</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par153">This example uses the <span class="EmphasisFontCategoryNonProportional ">-v</span> options so that the directory on the host operating system will be available for the container in this modified example. The volume created in this manner is a kind of <span id="ITerm104">mapped directory</span>. This mapped directory will be available for the container and it is also available from the host operating system. Any files already in the mapped directory will also be available inside the container; they will not be deleted during the mapping step. Referring to the numbered labels in Figure <span class="InternalRef"><a href="#Fig9">8-9</a></span>, you may note these aspects:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par154">Since you have mapped the volume using the –<span class="EmphasisFontCategoryNonProportional ">v</span> option, the persistence-related commands from the Mongo container are delegated to the filesystem abstraction.</p></li><li><p class="Para" id="Par155">The filesystem abstraction of the operating system can organize the Mongo database’s data into files, directories, and other related constructs.</p></li><li><p class="Para" id="Par156">At the hardware layer, a storage device is used to retain digital data, which could be a magnetic disk, a semiconductor device, and so on.</p></li></ul></div></div>

          <p class="Para" id="Par157">Since this example uses a persistence mechanism outside the container, so you must also verify that the data persisted to the storage has the capability to overcome container lifecycle.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec31">

          <h3 class="Heading">Understanding the Source Code</h3>

          <p class="Para" id="Par158">The <span id="ITerm105">source code</span> for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The code for this example is organized inside the <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-05</span> folder. Much of the source code in this example is similar to <span class="EmphasisFontCategoryNonProportional ">ch03\ch03-02</span>, which was explained in detail in Chapter <span class="ExternalRef"><a href="Capítulo-05.html"><span class="RefSource">3</span></a></span>. Also, the source code for this example is like the first two examples in this chapter. Compared to the second example in this chapter, the change is that you will use the <span class="EmphasisFontCategoryNonProportional ">-v</span> options so that the directory on the host operating system will be available for the container.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec32">

          <h3 class="Heading">Run Containers Using Dockerfiles</h3>

          <p class="Para" id="Par159">The <span class="EmphasisFontCategoryNonProportional ">ch08\ch08-05</span> folder contains the <span id="ITerm106">Maven scripts</span> required to build the examples. As a first step, you need to bring up the PostgreSQL server. The <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> for this example is the same <span class="EmphasisFontCategoryNonProportional ">Dockerfile</span> used in the previous four examples, and it is shown in Listing <span class="InternalRef"><a href="#PC6">8-5</a></span>.</p>

          <div class="Para" id="Par160">Next, build the microservices and the docker images and then run the containers. You need to modify the scripts from the previous example. Listing <span class="InternalRef"><a href="#PC46">8-43</a></span> shows the commands organized into a single script.<div class="ProgramCode" id="PC46"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean package</div><div class="FixedLine">docker build  --build-arg JAR_FILE=02-ProductWeb/target/*.jar -t ecom/product-web .</div><div class="FixedLine">docker build  --build-arg JAR_FILE=01-ProductServer/target/*.jar -t ecom/product-server .</div><div class="FixedLine">docker network create ecom-network</div><div class="FixedLine">docker pull mongo:3.6</div><div class="FixedLine">docker run  -d -it -p 27017:27017 --name mongo  --net=ecom-network -v /Users/binil/dockerbook/ch08-05/mongodata:/data/db  mongo:3.6</div><div class="FixedLine">docker run -d -p 8081:8081  --net=ecom-network --name product-server ecom/product-server</div><div class="FixedLine">docker run -d -p 8080:8080  --net=ecom-network --name product-web ecom/product-web</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-43</span><p class="SimplePara">Script to Build and Run Microservices Docker Containers (ch08\ch08-05\makeandrun.sh)</p></div></div></div></div>

          <p class="Para" id="Par161">One extra aspect you need to note here is the additional step of creating a folder for hosting the data files and pointing that file as the volume for the Mongo container. The folder is auto-created in the Minikube VM, since this example uses Docker within Minikube. Remember, all of this will be lost when you stop the Minikube. If you are using Docker in a host machine, you can manually create this folder too.</p>

          <div class="Para" id="Par162">Listing <span class="InternalRef"><a href="#PC47">8-44</a></span> shows you how to build the microservices and <span id="ITerm107">Docker images</span> and then run the containers.<div class="ProgramCode" id="PC47"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-05 binil$ eval $(minikube docker-env)</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-05 binil$ sh makeandrun.sh</div><div class="FixedLine">...</div><div class="FixedLine">Successfully tagged ecom/product-web:latest</div><div class="FixedLine">Successfully tagged ecom/product-server:latest</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-05 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-44</span><p class="SimplePara">The Dockerfile Build and Run Commands</p></div></div></div></div>

          <div class="Para" id="Par163">To list all the containers you have on your system now, execute the <span class="EmphasisFontCategoryNonProportional ">docker ps</span> command, as shown in Listing <span class="InternalRef"><a href="#PC48">8-45</a></span>.<div class="ProgramCode" id="PC48"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker ps</div><div class="FixedLine">CONTAINER ID   IMAGE                COMMAND                    CREATED          STATUS          PORTS                      NAMES</div><div class="FixedLine">5e4c172b0e83   ecom/product-web     "java -jar /ecom.jar"      50 seconds ago   Up 50 seconds   0.0.0.0:8080-&gt;8080/tcp     product-web</div><div class="FixedLine">24f369a0359d   ecom/product-server  "java -jar /ecom.jar"      51 seconds ago   Up 50 seconds   0.0.0.0:8081-&gt;8081/tcp     product-server</div><div class="FixedLine">bf4ccedcd7b4   mongo:3.6            "docker-entrypoint.s..."   51 seconds ago   Up 51 seconds   0.0.0.0:27017-&gt;27017/tcp   mongo</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-45</span><p class="SimplePara">List the <span id="ITerm108">Docker Containers</span></p></div></div></div></div>

          <div class="Para" id="Par164">Now you can inspect if and how the data folder is created. Since the Docker environment is within Minikube, you need to investigate the Minikube VM for this data folder, as shown in Listing <span class="InternalRef"><a href="#PC49">8-46</a></span>.<div class="ProgramCode" id="PC49"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ minikube ssh</div><div class="FixedLine">                         _             _</div><div class="FixedLine">            _         _ ( )           ( )</div><div class="FixedLine">  ___ ___  (_)  ___  (_)| |/')  _   _ | |_      __</div><div class="FixedLine">/' _ ` _ `\| |/' _ `\| || , &lt;  ( ) ( )| '_`\  /'__`\</div><div class="FixedLine">| ( ) ( ) || || ( ) || || |\`\ | (_) || |_) )(  ___/</div><div class="FixedLine">(_) (_) (_)(_)(_) (_)(_)(_) (_)`\___/'(_,__/'`\____)</div></div><div class="LineGroup"><div class="FixedLine">$ ls /Users/binil/dockerbook/ch08-05/mongodata</div><div class="FixedLine">WiredTiger                                diagnostic.data</div><div class="FixedLine">WiredTiger.lock                           index-1--7375842170208132306.wt</div><div class="FixedLine">WiredTiger.turtle                         index-10--7375842170208132306.wt</div><div class="FixedLine">WiredTiger.wt                             index-3--7375842170208132306.wt</div><div class="FixedLine">WiredTigerLAS.wt                          index-5--7375842170208132306.wt</div><div class="FixedLine">_mdb_catalog.wt                           index-6--7375842170208132306.wt</div><div class="FixedLine">collection-0--7375842170208132306.wt  index-8--7375842170208132306.wt</div><div class="FixedLine">collection-2--7375842170208132306.wt  journal</div><div class="FixedLine">collection-4--7375842170208132306.wt  mongod.lock</div><div class="FixedLine">collection-7--7375842170208132306.wt  sizeStorer.wt</div><div class="FixedLine">collection-9--7375842170208132306.wt  storage.bson</div><div class="FixedLine">$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-46</span><p class="SimplePara">Inspecting the Volume Folder Created</p></div></div></div></div>

          <p class="Para" id="Par165">You can see that the Mongo container has initialized with everything required during the container startup.</p>

          <div class="Para" id="Par166">Note the container IDs from Listing <span class="InternalRef"><a href="#PC48">8-45</a></span>. You can use these IDs to view the logs, as shown in Listing <span class="InternalRef"><a href="#PC50">8-47</a></span>.<div class="ProgramCode" id="PC50"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow 24f369a0359d</div></div><div class="LineGroup"><div class="FixedLine">...</div><div class="FixedLine">2022-05-30 13:55:07 INFO  InitializationComponent.init:47 - Start...</div><div class="FixedLine">2022-05-30 13:55:07 DEBUG InitializationComponent.init:51 - Deleting all existing data on start...</div><div class="FixedLine">2022-05-30 13:55:07 DEBUG InitializationComponent.init:56 - Creating initial data on start...</div><div class="FixedLine">2022-05-30 13:55:08 INFO  InitializationComponent.init:105 - End</div><div class="FixedLine">2022-05-30 13:55:12 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 9.964 seconds (JVM running for 11.603)</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-47</span><p class="SimplePara">Product Server <span id="ITerm109">Container Logs</span></p></div></div></div></div>

          <div class="Para" id="Par167">Listing <span class="InternalRef"><a href="#PC50">8-47</a></span> shows the <span id="ITerm110">Product Server container logs</span>. Note that two rows are inserted as initial data in the database. Similarly, Listing <span class="InternalRef"><a href="#PC51">8-48</a></span> shows the Product Web container logs.<div class="ProgramCode" id="PC51"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker logs --follow 5e4c172b0e83</div><div class="FixedLine">...</div><div class="FixedLine">2022-05-30 13:55:11 INFO  StartupInfoLogger.logStarted:61 - Started EcomProductMicroserviceApplication in 8.539 seconds (JVM running for 10.306)</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-48</span><p class="SimplePara">Product Web Container Logs</p></div></div></div></div>

          <p class="Para" id="Par168">Once the containers are up and running, you can test the application.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec33">

          <h3 class="Heading">Testing the Microservice Containers</h3>

          <div class="Para" id="Par169">Since the <span id="ITerm111">microservices</span> and database containers are up and running, you can access the <span id="ITerm112">Product Web microservice</span>. However, as mentioned in Appendix E, you must get the minikube IP first. See Listing <span class="InternalRef"><a href="#PC52">8-49</a></span>.<div class="ProgramCode" id="PC52"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$ minikube ip</div><div class="FixedLine">192.168.64.5</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch07-02 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-49</span><p class="SimplePara">Finding Minikube IP</p></div></div></div></div>

          <p class="Para" id="Par170">You can now access the <span id="ITerm113">Product Web microservice</span> using a browser with the URL formed with the Minikube IP.</p>

          <p class="Para ParaOneEmphasisChild" id="Par171"><span class="EmphasisFontCategoryNonProportional ">http://192.168.64.5:8080/product.html</span></p>

          <p class="Para" id="Par172">Refer to the section titled “Test the Microservice Using UI” in Chapter <span class="ExternalRef"><a href="Capítulo-03.html"><span class="RefSource">1</span></a></span> to test the Product Web microservice container. While you test the microservices, keep watching the log windows.</p>

          <div class="Para" id="Par173">Now bring down the running Mongo container, shown in Listing <span class="InternalRef"><a href="#PC53">8-50</a></span>.<div class="ProgramCode" id="PC53"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker rm -f bf4ccedcd7b4</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-50</span><p class="SimplePara">Removing the <span id="ITerm114">Mongo Container</span></p></div></div></div></div>

          <div class="Para" id="Par174">Next, you can bring up a new Mongo container with the same volume attached, as shown in Listing <span class="InternalRef"><a href="#PC54">8-51</a></span>.<div class="ProgramCode" id="PC54"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker run -d -it -p 27017:27017 --name mongo  --net=ecom-network -v /Users/binil/dockerbook/ch08-05/mongodata:/data/db  mongo:3.6</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-51</span><p class="SimplePara">Running a New Mongo Container</p></div></div></div></div>

          <div class="Para" id="Par175">List the newly created Mongo container and assert that it’s a new container (ID). See Listing <span class="InternalRef"><a href="#PC55">8-52</a></span>.<div class="ProgramCode" id="PC55"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$ docker ps</div><div class="FixedLine">CONTAINER ID   IMAGE       COMMAND                    CREATED          STATUS          PORTS                       NAMES</div><div class="FixedLine">a3b84961b0a7   mongo:3.6   "docker-entrypoint.s..."   11 seconds ago   Up 10 seconds   0.0.0.0:27017-&gt;27017/tcp    mongo</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:~ binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-52</span><p class="SimplePara">Listing DockerContainers</p></div></div></div></div>

          <p class="Para" id="Par176">Now access the <span id="ITerm115">Product Web microservice</span> using a browser with the URL formed with the Minikube IP.</p>

          <p class="Para ParaOneEmphasisChild" id="Par177"><span class="EmphasisFontCategoryNonProportional ">http://192.168.64.5:8080/product.html</span></p>

          <div class="Para" id="Par178">You can now verify that the date that has been originally created and managed by the earlier <span id="ITerm116">Mongo container</span> is still safe. Once you complete testing the microservices, you can then stop and remove the microservice containers and clean the environment. See Listing <span class="InternalRef"><a href="#PC56">8-53</a></span>.<div class="ProgramCode" id="PC56"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-05 binil$ sh clean.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO] -------------------------------------------------</div><div class="FixedLine">[INFO] Reactor Build Order:</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Ecom-Product-Server-Microservice     [jar]</div><div class="FixedLine">[INFO] Ecom-Product-Web-Microservice        [jar]</div><div class="FixedLine">[INFO] Ecom                                 [pom]</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">mongo</div><div class="FixedLine">product-web</div><div class="FixedLine">product-server</div><div class="FixedLine">mongo</div><div class="FixedLine">Untagged: ecom/product-web:latest</div><div class="FixedLine">...</div><div class="FixedLine">Untagged: ecom/product-server:latest</div><div class="FixedLine">...</div><div class="FixedLine">ecom-network</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch08-05 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-53</span><p class="SimplePara">Stopping Microservice Container and Cleaning Environment</p></div></div></div></div>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec34">

        <h2 class="Heading">Summary</h2>

        <p class="Para" id="Par179">You started your container and <span id="ITerm117">Docker journey</span> in Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span>, and in this chapter, you extended that learning by exploring multiple combinations of microservice containers and database containers that interact with each other. There is one thing left, which is the containerization of the message broker. This is covered in the next chapter, where I demonstrate Kafka containers with the help of Docker Compose. Don’t miss the next chapter, since you will then be equipped with the basic tools you need to create serious <span id="ITerm118">microservice</span> applications on containers.</p>

      </section>

    </div>

  </div>

</body>

</html>