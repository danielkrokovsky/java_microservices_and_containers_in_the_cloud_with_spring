<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">

<head>
  <title>Microservices for the Enterprise</title>
  <link href="../css/springer_epub.css" rel="styleSheet" type="text/css"/>
</head>

<body>

  <div epub:type="chapter" role="doc-chapter">

    <div class="ChapterContextInformation">

      <div class="ContextInformation" id="b979-8-8688-0555-4_1"><div class="ChapterCopyright">© The Author(s), under exclusive license to APress Media, LLC, part of Springer Nature 2024</div><span class="ContextInformationAuthorEditorNames">B. A. Christudas</span><span class="ContextInformationBookTitles"><span class="BookTitle">Java Microservices and Containers in the Cloud</span></span><span class="ChapterDOI"><a href="https://doi.org/10.1007/979-8-8688-0555-4_1">https://doi.org/10.1007/979-8-8688-0555-4_1</a></span></div>

    </div>

    <!--Begin Abstract-->

    <div class="MainTitleSection">

      <h1 class="ChapterTitle" lang="en">1. Microservices for the Enterprise</h1>

    </div>

    <div class="AuthorGroup">

      <div class="AuthorNames"><span class="Author"><span class="AuthorName">Binildas A. Christudas</span><sup><a href="#Aff2">1</a> <span class="ContactIcon"> </span></sup></span></div>

      <div class="Affiliations">

        <div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">NBCRA 45, Christbin, Thiruvananthapuram, Kerala, India</div></div>

        <div class="ClearBoth"> </div>

      </div>

    </div>

    <!--End Abstract-->

    <div class="Fulltext">

      <p class="Para" id="Par2">It has been more than a decade since the original ideas and variants of microservices were discussed and considered. Today, this architectural style is the norm, not the exception. Its tools and frameworks have matured enough and the architecture principles have been tested and proven, both on-premises and on the cloud. There is sufficient clarity on how this software architecture distinguishes itself from its predecessors, so this chapter discusses only a few key points that have not been discussed elsewhere.</p>

      <p class="Para" id="Par3">This chapter starts by looking at an overview of the computing paradigm and explaining where the current trends of <span id="ITerm1">microservices</span> fit in. You will learn that microservices is yet another form of distributed computing, but the true benefits of microservices are reaped when you provide a decentralized capability in business transaction processing for the microservices components. Decentralization brings autonomy to peer microservices, which brings a distinguishable feature to the business transactions, called <em class="EmphasisTypeItalic ">eventual consistency.</em> <span id="ITerm2">Eventually consistent</span> <span id="ITerm3">systems</span> are more fault tolerant and provide reliability to end-to-end business transactions, which happen over the otherwise relatively less stable HTTP-based transport protocol. The chapter next looks at the boundaries between microservices and “not so micro” services, covered in the service granularity discussion. Before I close this chapter, I also introduce the notion of the <em class="EmphasisTypeItalic ">hexagonal architecture</em> with an example. There are more examples of the <span id="ITerm4">hexagonal architecture</span><span id="ITerm5"></span> in Chapter <span class="ExternalRef"><a href="Capítulo-04.html"><span class="RefSource">2</span></a></span> as well.</p>

      <div class="Para" id="Par4">This chapter covers the following topics:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par5">Different computing architecture paradigms</p></li><li><p class="Para" id="Par6">Eventually consistent software systems</p></li><li><p class="Para" id="Par7">Service granularity</p></li><li><p class="Para" id="Par8">The hexagonal architecture metaphor</p></li><li><p class="Para" id="Par9">Your first Java microservice in code</p></li></ul></div></div>

      <section class="Section1 RenderAsSection1" id="Sec1">

        <h2 class="Heading">Computing Architecture Paradigms</h2>

        <p class="Para" id="Par10">It’s important to understand the distributed nature of services in a <span id="ITerm6">microservices</span> style of architecture, so this section explains what this architecture is and how it differentiates itself from other more familiar counterparts.</p>

        <section class="Section2 RenderAsSection2" id="Sec2">

          <h3 class="Heading">Centralized Computing</h3>

          <div class="Para" id="Par11">Compared to minicomputers or personal computers, which are common and commoditized today, mainframes have more processing power. Early versions of mainframe computers had a large cabinet, called a <em class="EmphasisTypeItalic ">main frame,</em> which housed the central processing unit and main memory. Mainframe computers are characterized by interactive user terminals operating as timesharing computers, supporting hundreds of users simultaneously along with batch processing. Mainframes are used for business transaction processing, like airline reservation, banking, and so on. A transaction encompasses a set of operations including disk I/O, operating system calls, and other forms of data transfer from one subsystem to another, as shown in Figure <span class="InternalRef"><a href="#Fig1">1-1</a></span>.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="" aria-describedby="d64e239" src="../images/619782_1_En_1_Chapter/Imagem-002.jpg" style="width:31.72em"/><div class="TextObject" id="d64e239"><p class="Para" id="Par131">An architecture of a mainframe. The system is connected to terminals for user interaction. An airline mainframe has availability, booking, and inventory control. Data is stored in separate databases with service granularity and compute nodes. It defines the connectivity by a star network of nodes.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-1</span><p class="SimplePara">Centralized computing</p></div></figcaption></figure></div>

          <p class="Para" id="Par12">As depicted, mainframes are centralized computers operating in timesharing mode, supporting hundreds of users simultaneously along with batch processing. Users access mainframes through keyboard/typewriter terminals and specialized text terminal CRT displays with integral keyboards. <em class="EmphasisTypeItalic ">Green screen</em> is the common name for those monochrome monitors used for user access, since they traditionally used a green “P1” phosphor screen.<sup><a epub:type="noteref" href="#Fn1" id="Fn1_source" role="doc-noteref">1</a></sup></p>

          <p class="Para" id="Par14">Transaction processing or <em class="EmphasisTypeItalic ">batch processing</em> was offered as a service by the central mainframe system, so this architecture is best categorized under the <span id="ITerm7"><em class="EmphasisTypeItalic ">centralized computing paradigm</em></span>, where a central computer makes all the decisions regarding the successful completion of the business transaction, end to end.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec3">

          <h3 class="Heading">Distributed Computing</h3>

          <p class="Para" id="Par15">Next came the <em class="EmphasisTypeItalic ">distributed computing</em> paradigm, where the different <span id="ITerm8">components</span> of the compute system were located on different networked computers, and they communicated and coordinated their actions by passing messages to one another. While doing so, typically, one of the nodes or computers acted as a coordinator for the business transaction—it coordinated (or orchestrates) elementary computing components of the overall business transaction on different networked computers and decided on the success or failure of the transaction.</p>

          <div class="Para" id="Par16">Distributed computing comes in different <span id="ITerm9">variants</span>. The major ones are listed here:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par17"><em class="EmphasisTypeItalic ">Client–server</em>: In a <span id="ITerm10">client-server architecture</span>, clients request and receives data from the servers and display it to the users. The client machine hosts most of the rules and validations required for the business logic to complete. Thick clients are characteristic of this architecture, and client-binary distribution is a hassle here</p></li><li><p class="Para" id="Par18"><em class="EmphasisTypeItalic ">Three-tier</em>: A <span id="ITerm11">three-tier architectures</span> move the client intelligence to a middle tier so that stateless and thin clients can be used. This simplifies application deployment to a single middleware server, and client binary distribution is zero or minimal. Most web applications are three-tier.</p></li><li><p class="Para" id="Par19"><em class="EmphasisTypeItalic ">n-tier</em>: An <span id="ITerm12">N-tier architecture</span>, also known as a multi-tier architecture, is a software engineering design pattern that separates an application into logical layers and physical tiers. Each layer has a specific responsibility and functionality, and the tiers are usually separated by physical or logical boundaries, such as different servers, processes, or networks.</p></li><li><p class="Para" id="Par20"><em class="EmphasisTypeItalic ">Peer-to-peer</em>: In this architecture, there are no particular machines that provide a service or manage the network resources. Instead all responsibilities are uniformly divided among all the machines, known as peers. Each peer can serve as a client and as a server. Examples of this architecture include BitTorrent. The bitcoin network is also a kind of <span id="ITerm13">peer to peer</span>, but bitcoin network fits more into another computing paradigm called <em class="EmphasisTypeItalic ">decentralized architecture,</em> which is explained shortly.</p></li><li><p class="Para" id="Par21"><em class="EmphasisTypeItalic ">Microservices</em>: <span id="ITerm14">Microservices</span> are a kind of distributed architecture where functional units are identified as the basis for distribution. Because of that, more than one microservice is needed in many cases to complete a single business transaction. Microservices with additional design capabilities can be classified into another class of computing paradigm, called <em class="EmphasisTypeItalic ">decentralized</em>, which is discussed later in this chapter.</p></li></ul></div></div>

          <div class="Para" id="Par22">Figure <span class="InternalRef"><a href="#Fig2">1-2</a></span> represents a distributed <span id="ITerm15">architecture</span>. Here, the client, business, and database processes are separated by the network.<figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img alt="" aria-describedby="d64e379" src="../images/619782_1_En_1_Chapter/Imagem-003.jpg" style="width:32.88em"/><div class="TextObject" id="d64e379"><p class="Para" id="Par132">An illustration of a distinct pattern of network with nodes of service granularity and artifact packaging along with its distributed architecture. It has a browser with compute nodes responsible for availability, booking, or inventory control. Data is stored in separate databases for each process.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-2</span><p class="SimplePara">Distributed <span id="ITerm16">computing</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par23">In Figure <span class="InternalRef"><a href="#Fig2">1-2</a></span>, a single middle tier server is shown. This server is composed of a set of <span id="ITerm17">business modules</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par24"><em class="EmphasisTypeItalic ">Availability</em>: A module that helps to plan a flight, during which a traveler can enter the travel dates and destinations and get a list of all available flights from different airlines, through what is called an <span id="ITerm18">Internet Booking Engine (IBE)</span>. The traveler can browse through this list, compare the prices, and then decide which one to book.</p></li><li><p class="Para" id="Par25"><em class="EmphasisTypeItalic ">Booking</em>: The booking module helps the traveler book a flight and create a Passenger Name Record (PNR) for travel in the shortlisted flight.</p></li><li><p class="Para" id="Par26"><em class="EmphasisTypeItalic ">Inventory</em>: When a booking is completed for seats in a flight, the seat inventory should be reduced in the Inventory module.</p></li></ul></div></div>

          <p class="Para" id="Par27">In some cases, the middle tier server will also connect to other third-party systems like a <span id="ITerm19">Global Distribution System (GDS)</span> such as Amadeus or Sabre, thus exhibiting the distributed computing paradigm in the truest sense. This is depicted in the distributed mesh notation in Figure <span class="InternalRef"><a href="#Fig2">1-2</a></span>.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec4">

          <h3 class="Heading">Decentralized Computing</h3>

          <p class="Para" id="Par28">In <span id="ITerm20">decentralized computing</span>, application services are carried out by individual computing devices or nodes on a distributed network, with no central location. This approach to software development (and distribution) affords developers great flexibility and savings, since they don’t have to create a central control point. Bitcoin, Ethereum, and Uniswap are a few protocols that use decentralized computing.</p>

          <div class="Para" id="Par29">Figure <span class="InternalRef"><a href="#Fig3">1-3</a></span> depicts a microservices architecture, which is obviously distributed. Different components of the end-to-end business transactions could also be spread across different components, so in a way this is decentralized.<figure class="Figure" id="Fig3"><div class="MediaObject" id="MO3"><img alt="" aria-describedby="d64e449" src="../images/619782_1_En_1_Chapter/Imagem-004.jpg" style="width:31.78em"/><div class="TextObject" id="d64e449"><p class="Para" id="Par133">An illustration of a network with nodes connected in star-like branches with service granularity and artifact packaging along with its distributed and decentralized architecture. It has compute nodes responsible for availability, booking, or inventory control. The system is connected to mobile apps.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-3</span><p class="SimplePara">Decentralized computing</p></div></figcaption></figure></div>

          <div class="Para" id="Par30">I do not discuss the intricacies of why Figure <span class="InternalRef"><a href="#Fig3">1-3</a></span> depicts a microservices architecture, since I assume readers are familiar with those basics. Here are a few of the characteristics of this architecture:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par31"><em class="EmphasisTypeItalic ">Distributed</em>: The business application is divided and distributed based on functionality (airline shopping, booking, and inventory management are the functionalities).</p></li><li><p class="Para" id="Par32"><em class="EmphasisTypeItalic ">Independent</em>: Each of the microservices can be developed and deployed independent of the others (provided you maintain API compatibility for inter-microservices communication).</p></li><li><p class="Para" id="Par33"><em class="EmphasisTypeItalic ">Availability</em>: If one of the microservices is not running, users can still get functionality from the application through other microservices that are running (if Booking is down, a user can still do some shopping).</p></li></ul></div></div>

          <p class="Para" id="Par34">Thus, in a way, a microservices architecture with the appropriate design primitives can also function as a decentralized application (even though the nomenclature of decentralized is more applicable to applications involving blockchains).</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec5">

        <h2 class="Heading">Eventually Consistent Software Systems</h2>

        <p class="Para" id="Par35">It’s important to understand the distributed nature of services in a <span id="ITerm21">microservices</span> style of architecture. This section explains what this is and how it’s different from other more familiar counterpart architectures.</p>

        <section class="Section2 RenderAsSection2" id="Sec6">

          <h3 class="Heading">Atomic Consistency</h3>

          <div class="Para" id="Par36">Figure <span class="InternalRef"><a href="#Fig4">1-4</a></span> is the <span id="ITerm22">distributed</span> architecture shown in Figure <span class="InternalRef"><a href="#Fig2">1-2</a></span>, but here a user is booking a flight.<figure class="Figure" id="Fig4"><div class="MediaObject" id="MO4"><img alt="" aria-describedby="d64e520" src="../images/619782_1_En_1_Chapter/Imagem-005.jpg" style="width:35.15em"/><div class="TextObject" id="d64e520"><p class="Para" id="Par134">An architecture of ACID transactions. The user accesses the browser which comprises compute nodes for availability, booking, inventory control, services, and O R M. Data is stored in separate databases for each process with service granularity and artifact packaging.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-4</span><p class="SimplePara">ACID <span id="ITerm23">transactions</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par37">Referring to Figure <span class="InternalRef"><a href="#Fig4">1-4</a></span>, a typical flight booking business transaction happens like this:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent"><p class="Para" id="Par38">The browser sends the user transaction to the business tier server.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent"><p class="Para" id="Par39">Since the transaction is a flight booking, it is intercepted by the Booking module. Before you perform the booking, the booking module sends an update inventory request to the Inventory module to reduce the seat inventory, after starting an ACID<sup><a epub:type="noteref" href="#Fn2" id="Fn2_source" role="doc-noteref">2</a></sup> transaction.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent"><p class="Para" id="Par41">Within the previously started ACID transaction, the Inventory module updates the inventory database table.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">4.</div><div class="ItemContent"><p class="Para" id="Par42">If the inventory update is successful, the booking module will create a booking in its database table, within the same transaction context.</p></div><div class="ClearBoth"> </div></li></ol></div></div>

          <p class="Para" id="Par43">If the booking and the inventory tables are in the same database, and if the booking and the inventory components are two modules in the same middle tier server, the transaction is a local transaction. That means the two table updates will either be successful or rolled back in an atomic (ACID) manner.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec7">

          <h3 class="Heading">Eventual Consistency</h3>

          <div class="Para" id="Par44">This section considers the same flight booking scenario in a microservices architecture, where the processing is distributed. See Figure <span class="InternalRef"><a href="#Fig5">1-5</a></span>.<figure class="Figure" id="Fig5"><div class="MediaObject" id="MO5"><img alt="" aria-describedby="d64e581" src="../images/619782_1_En_1_Chapter/Imagem-006.jpg" style="width:35.3em"/><div class="TextObject" id="d64e581"><p class="Para" id="Par135">A distributed and decentralized architecture with service granularity and artifact packaging. It includes multiple compute nodes for availability, booking, or inventory control. Data is stored in separate databases for each process. It is connected to a mobile app for user interaction.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-5</span><p class="SimplePara"><span id="ITerm24">Inter-microservice transactions</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par45">The same flight booking business transaction scenario now happens like this:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent"><p class="Para" id="Par46">The Booking app will send the user transaction to the business tier server.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent"><p class="Para" id="Par47">Since the transaction is booking a flight, it is intercepted by the booking microservice. Before you perform the booking, the booking microservice sends an update inventory request to the inventory microservice to reduce the seat inventory. However, you can’t start a global transaction and send the update inventory request in the same global transaction. This is because the update inventory request is typically a synchronous REST invocation, and distributed transactions across microservices are not encouraged. Without a distributed transaction context, a success or a failure for the update inventory request is received by the booking microservice.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent"><p class="Para" id="Par48">The <span id="ITerm25">Inventory module</span> updates the inventory database table and sends a success or a failure.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">4.</div><div class="ItemContent"><p class="Para" id="Par49">If the inventory update is successful, the booking microservices will create a booking in its database table and send back a success message to the end user.</p></div><div class="ClearBoth"> </div></li></ol></div></div>

          <p class="Para" id="Par50">Here, there is a catch. If by chance the attempt to update the inventory database table is successful, but the booking microservices fails to create a booking in the booking database table, there is an issue in the consistency in data across these two tables. You need manual intervention to correct this and bring these two microservices back to eventually consistent.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec8">

          <h3 class="Heading">Eventually Consistent, Decentralized Systems</h3>

          <p class="Para" id="Par51">I have initiated a discussion on how to make microservices eventually consistent. I have also discussed how to deal with the scenario when the update inventory database table is successful, but the booking microservices fails to create a booking in the booking database table. Now consider the converse scenario—what if the inventory microservice is not running and the booking microservices cannot complete the booking? This scenario occurs when the synchronous style REST invocation from the booking microservices to the inventory microservice cannot complete, so the booking creation will also fail.</p>

          <div class="Para" id="Par52">Figure <span class="InternalRef"><a href="#Fig6">1-6</a></span> shows an improvisation over the architecture shown in Figure <span class="InternalRef"><a href="#Fig5">1-5</a></span>, by plugging in an event based channel.<figure class="Figure" id="Fig6"><div class="MediaObject" id="MO6"><img alt="" aria-describedby="d64e648" src="../images/619782_1_En_1_Chapter/Imagem-007.jpg" style="width:35.25em"/><div class="TextObject" id="d64e648"><p class="Para" id="Par136">An illustration of a decentralized architecture with service granularity, artifact packaging, and an event channel. It has multiple compute nodes for availability, booking, or inventory control. Data is stored in separate databases. The system is connected to a mobile app for user interaction.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-6</span><p class="SimplePara">Decentralized <span id="ITerm26">microservices</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par53">Here, the microservices are not tightly coupled. Instead, you can use a loosely coupled JMS or AMQP style messaging protocol. The sequence of the flight booking business transaction could then be as follows:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent"><p class="Para" id="Par54">The browser sends the user transaction to the business tier server.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent"><p class="Para" id="Par55">Since the transaction is a flight booking, it is intercepted by the booking microservice. Before you perform the booking, the Booking module sends a “flight booked” message to the messaging channel.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent"><p class="Para" id="Par56">The booking microservice will create a booking in its database table and provide the response to the end user.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">4.</div><div class="ItemContent"><p class="Para" id="Par57">The “flight booked” message will be picked up by any other interested microservices—the inventory microservice in this case.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">5.</div><div class="ItemContent"><p class="Para" id="Par58">The inventory microservices update the inventory database table and optionally sends a success or failure message to the messaging channel.</p></div><div class="ClearBoth"> </div></li></ol></div></div>

          <p class="Para" id="Par59">It is possible to improve the reliability of this business transaction by keeping Steps 2 and 3 in the scope of a transaction. Regardless of that, one notable change in the design is that the business transaction is spanned across multiple microservices, and the successful completion of the transaction is determined by the overall completion of transactions by these different microservices, eventually. No single microservice is solely responsible for controlling the complete end-to-end flow. Instead, each microservice performs its own part, thus making the architecture truly decentralized.</p>

          <p class="Para" id="Par60">Note that this discussion assumed that enough inventory exists. There can be more complex scenarios in which inventory is limited, but this is beyond the scope here.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec9">

        <h2 class="Heading">Service Granularity</h2>

        <p class="Para" id="Par61">A proper appreciation of the different levels of granularity for a services architecture will help you understand their possibilities and limitations, so this section looks at these <span id="ITerm27">service granularities</span>.</p>

        <section class="Section2 RenderAsSection2" id="Sec10">

          <h3 class="Heading">Monolith</h3>

          <div class="Para" id="Par62">Figure <span class="InternalRef"><a href="#Fig7">1-7</a></span> illustrates a typical <span id="ITerm28">monolith architecture</span>. In this architecture, the functional modules are only logically separated, but they are all physically packaged into a single .<span class="EmphasisFontCategoryNonProportional ">ear</span> (enterprise archive) archive.<figure class="Figure" id="Fig7"><div class="MediaObject" id="MO7"><img alt="" aria-describedby="d64e727" src="../images/619782_1_En_1_Chapter/Imagem-008.jpg" style="width:35.15em"/><div class="TextObject" id="d64e727"><p class="Para" id="Par137">An architecture consists of four processes. Availability, checkout, booking, and inventory control with data stored in separate databases with the concept of service granularity and artifact packaging. The system is connected to a component named the central airline dot ear.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-7</span><p class="SimplePara">A monolith architecture</p></div></figcaption></figure></div>

          <p class="Para" id="Par63">Many times, a monolith architecture communicates with a database in a different node, and all the functional modules are coupled tightly to this single database.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec11">

          <h3 class="Heading">Macroservice</h3>

          <div class="Para" id="Par64">The <span id="ITerm29">macroservice architecture</span> shown in Figure <span class="InternalRef"><a href="#Fig8">1-8</a></span> is a packaging improvement over the monolith architecture.<figure class="Figure" id="Fig8"><div class="MediaObject" id="MO8"><img alt="" aria-describedby="d64e756" src="../images/619782_1_En_1_Chapter/Imagem-009.jpg" style="width:35.15em"/><div class="TextObject" id="d64e756"><p class="Para" id="Par138">An architecture consists of 4 processes. Availability, checkout, booking, and inventory control with data stored in separate databases with the concept of service granularity and artifact packaging in airline macro services. The system is connected to a component named the central airline dot ear.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-8</span><p class="SimplePara">A macroservice architecture</p></div></figcaption></figure></div>

          <p class="Para" id="Par65">In the macroservice architecture, different functional modules are packaged separately, into separate <span class="EmphasisFontCategoryNonProportional ">.jar</span>s (Java archives). The deployment schema of a macroservice architecture is similar to that of a monolith. All of the Java archives are placed in a single .<span class="EmphasisFontCategoryNonProportional ">ear</span> or .<span class="EmphasisFontCategoryNonProportional ">war</span> (web archive) and then deployed in a single node.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec12">

          <h3 class="Heading">Mini Service</h3>

          <div class="Para" id="Par66">A <span id="ITerm30">mini service</span> architecture is a genuine attempt to improvise over a monolith or macroservice. Figure <span class="InternalRef"><a href="#Fig9">1-9</a></span> depicts a mini service architecture.<figure class="Figure" id="Fig9"><div class="MediaObject" id="MO9"><img alt="" aria-describedby="d64e794" src="../images/619782_1_En_1_Chapter/Imagem-010.jpg" style="width:35.15em"/><div class="TextObject" id="d64e794"><p class="Para" id="Par139">An illustration of an airline reservation system. It has different components with compute nodes, service granularity, and artifact packaging. Availability jar and checkout jar in shopping dot war, and booking jar and inventory jar in booking dot war. Data are stored in separate databases.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-9</span><p class="SimplePara">A mini service architecture</p></div></figcaption></figure></div>

          <p class="Para" id="Par67">As shown in Figure <span class="InternalRef"><a href="#Fig9">1-9</a></span>, a mini service architecture will also package modules into separate archives, similar to a macroservice architecture. Further, some of these archives can also be packaged into separate deployable archives. However, in many cases, these deployment archives are deployed in the same node due to architectural constraints like dependent libraries, communication modes, and so on.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec13">

          <h3 class="Heading">Microservices</h3>

          <div class="Para" id="Par68">The microservice architecture attempts to provide complete flexibility in terms of development, deployment, and release, as shown in Figure <span class="InternalRef"><a href="#Fig10">1-10</a></span>.<figure class="Figure" id="Fig10"><div class="MediaObject" id="MO10"><img alt="" aria-describedby="d64e819" src="../images/619782_1_En_1_Chapter/Imagem-011.jpg" style="width:35.15em"/><div class="TextObject" id="d64e819"><p class="Para" id="Par140">An illustration of an airline reservation system. It has different components with compute nodes, service granularity, and artifact packaging. Individual databases for availability, checkout, booking, and inventory. Each database performs processes, services, and inventory.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-10</span><p class="SimplePara">A microservice architecture</p></div></figcaption></figure></div>

          <p class="Para" id="Par69">One notable advantage of the <span id="ITerm31">microservices architecture</span> is that it promotes polyglot technologies. This gives each microservice the flexibility to adopt its own implementation technology and architecture, yet still exposing and interacting with peer microservices using standard protocols.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec14">

        <h2 class="Heading">The Hexagonal Architecture Metaphor</h2>

        <p class="Para" id="Par70">When learning about loosely coupled systems, especially in the context of microservices, it’s helpful to discuss the <span id="ITerm32"><em class="EmphasisTypeItalic ">hexagonal architecture</em></span>. I do that in this section.</p>

        <p class="Para" id="Par71">To understand this metaphor, I start the discussion with the typical layered architecture.</p>

        <section class="Section2 RenderAsSection2" id="Sec15">

          <h3 class="Heading">Layered Architecture</h3>

          <div class="Para" id="Par72">A <span id="ITerm33">layered architecture</span> refers to the typical software architecture organization that’s followed to separate concerns, mainly those of communication, as shown in Figure <span class="InternalRef"><a href="#Fig11">1-11</a></span>.<figure class="Figure" id="Fig11"><div class="MediaObject" id="MO11"><img alt="" aria-describedby="d64e870" src="../images/619782_1_En_1_Chapter/Imagem-012.jpg" style="width:13.67em"/><div class="TextObject" id="d64e870"><p class="Para" id="Par141">An illustration represents a layered architecture with three layers. End-user, presentation, business, and data. The end user is depicted as a stick figure that interacts with the presentation layer. The presentation layer sits above the business layer, which in turn sits above the data layer.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-11</span><p class="SimplePara">Layered architecture</p></div></figcaption></figure></div>

          <p class="Para" id="Par73">In the layered architecture in Figure <span class="InternalRef"><a href="#Fig11">1-11</a></span>, the top and bottom layers are simply entry/exit points to/from the application.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec16">

          <h3 class="Heading">The Ports and Adapter Architecture</h3>

          <p class="Para" id="Par74">The ports and <span id="ITerm34">adapter</span> architecture was mentioned by Alistair Cockburn on his blog in 2005. It reads as follows:</p>

          <p class="Para ParaTypeImportant" id="Par75">“Allow an application to equally be driven by users, programs, automated test or batch scripts, and to be developed and tested in isolation from its eventual runtime devices and databases.”</p>

          <p class="Para" id="Par76">To explain further, think about an application as the central artefact of a system, where all input reaches and all output leaves the application through a port(s) that isolates the application from all kinds of external tools, technologies, and delivery mechanisms. The application should have no knowledge of who/what is sending input or receiving output. This is intended to protect the applications against the evolution of technology and business requirements, since such an evolution can make applications obsolete shortly after they are developed.</p>

          <div class="Para" id="Par77">To understand the ports and adapters architecture, first turn the layered architecture from the typical North-South orientation to an East-West orientation, as shown in Figure <span class="InternalRef"><a href="#Fig12">1-12</a></span>.<figure class="Figure" id="Fig12"><div class="MediaObject" id="MO12"><img alt="" aria-describedby="d64e908" src="../images/619782_1_En_1_Chapter/Imagem-013.jpg" style="width:34.12em"/><div class="TextObject" id="d64e908"><p class="Para" id="Par142">A process flow defines how the end user interacts with the booking app on their mobile device. The app communicates with the presentation, business, and data layers. The presentation layer handles the user interface, the business layer processes the data, and the data is stored in a database.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-12</span><p class="SimplePara">The layered architecture, orientation changed</p></div></figcaption></figure></div>

          <p class="Para" id="Par78">Figure <span class="InternalRef"><a href="#Fig12">1-12</a></span> shows the typical application flow, which starts from the code in the user interface, through the application core to the infrastructure code, back to the application core, finally delivering a response to the user interface.</p>

          <div class="Para" id="Par79">The ports and adapters architecture solves the problem of safeguarding and reusing the inner layers (business layer) by using an <span id="ITerm35">abstraction layer</span>, implemented as a port and an adapter.<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par80"><em class="EmphasisTypeItalic ">Ports</em>: A port is a consumer-agnostic entry and exit point to/from the application. In Java, it is a Java interface. Or in more abstract terms, it could be an HTTP REST interface or a JMS or AMQP messaging interface.</p></li><li><p class="Para" id="Par81"><em class="EmphasisTypeItalic ">Adapter</em>: An adapter class implements an interface known to its clients and provides access to an instance of a class not known to its clients. An adapter object provides the functionality promised by an interface without having to assume what class is used to implement that interface.</p></li></ul></div></div>

          <div class="Para" id="Par82">The ports and adapters architecture explicitly identifies three fundamental blocks of code in a system:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent"><p class="Para" id="Par83"><em class="EmphasisTypeItalic ">Interface</em>: Code that makes it possible to run a user interface, regardless of the type of user interface it might be.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent"><p class="Para" id="Par84"><em class="EmphasisTypeItalic ">Business</em>: The business logic code, or application core, which is used by the user interface to make things happen.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent"><p class="Para" id="Par85"><em class="EmphasisTypeItalic ">Infrastructure</em>: The infrastructure code that connects the application core to tools like a database, a message queue, or a third-party API.</p></div><div class="ClearBoth"> </div></li></ol></div></div>

          <p class="Para" id="Par86">In the current orientation in Figure <span class="InternalRef"><a href="#Fig12">1-12</a></span>, the adapters on the left side, representing the UI, are called the <em class="EmphasisTypeItalic ">primary</em> or <em class="EmphasisTypeItalic ">driving</em> adapters because they initiate an action on the application. The adapters on the right side, representing the connections to the backend resources, are called the <em class="EmphasisTypeItalic ">secondary</em> or <em class="EmphasisTypeItalic ">driven</em> adapters because they always react to an action of a primary adapter.</p>

          <p class="Para" id="Par87">The primary or driving <span id="ITerm36">adapters</span> provide services (to the user interface), whereas the secondary or driven adapters consume services (from the infrastructure). Hence on the left side, both the port and its concrete implementation (the use case) belong inside the application. On the right side, the port belongs inside the application, but its concrete implementation belongs outside. It wraps around some external infrastructure from some provider.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec17">

          <h3 class="Heading">Hexagonal Architecture</h3>

          <p class="Para" id="Par88">Figure <span class="InternalRef"><a href="#Fig12">1-12</a></span> shows two sides—one side an entry to the application using the user interface and the other side an exit from the <span id="ITerm37">application</span> into an infrastructure. Thus, although there are two symmetrical sides (left and right) of the application, each side can have several entry/exit points. For example, an API (say REST API) and a <span id="ITerm38">Graphical User Interface (GUI)</span> can be two different entry/exit points on the left side of the application, while a database and a message queue can be two different entry/exit points on the right side of the application. To represent that this application can have multiple entry/exit points, you draw the application diagram with several sides. The diagram could have been any polygon with several sides, but the choice turned out to be a hexagon, hence the name hexagonal architecture.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec18">

          <h3 class="Heading">Microservice Metamodel</h3>

          <div class="Para" id="Par89">I can now extend the notion of the hexagonal architecture to a microservice, since many of the aspects discussed in the ports and adapters section make sense in the context of a microservice. This is shown in Figure <span class="InternalRef"><a href="#Fig13">1-13</a></span>.<figure class="Figure" id="Fig13"><div class="MediaObject" id="MO13"><img alt="" aria-describedby="d64e1032" src="../images/619782_1_En_1_Chapter/Imagem-014.jpg" style="width:35.15em"/><div class="TextObject" id="d64e1032"><p class="Para" id="Par143">A process flow defines how the commands, queries, and events are processed through REST A P I, controller, message listener, service, process, aggregate, client, and store. The system handles both incoming and outgoing commands and interacts with a user interface and infrastructure components.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-13</span><p class="SimplePara">The <span id="ITerm39">microservices metamodel</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par90">You can now compare the microservice metamodel shown in Figure <span class="InternalRef"><a href="#Fig13">1-13</a></span> to that of a Java Spring-based microservice with the following components:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par91"><em class="EmphasisTypeItalic ">REST controller</em>: An HTTP-based REST based controller class, annotated with <span class="EmphasisFontCategoryNonProportional ">@RestController</span>.</p></li><li><p class="Para" id="Par92"><em class="EmphasisTypeItalic ">POJO service</em>: The core business logic. This class should be shielded from any entry/exit changes to facilitate reuse.</p></li><li><p class="Para" id="Par93"><em class="EmphasisTypeItalic ">ORM repository</em>: An ORM repository class handling persistence logic to a database.</p></li><li><p class="Para" id="Par94"><em class="EmphasisTypeItalic ">Aggregate entity</em>: Domain entity based on the domain model, which is reusable.</p></li><li><p class="Para" id="Par95"><em class="EmphasisTypeItalic ">Data store</em>: The infrastructure’s persistent storage.</p></li><li><p class="Para" id="Par96"><em class="EmphasisTypeItalic ">Message listener</em>: A JMS or an AMQP-based controller class.</p></li><li><p class="Para" id="Par97"><em class="EmphasisTypeItalic ">Client program</em>: Program that will use ports to exit to other kinds of infrastructure.</p></li><li><p class="Para" id="Par98"><em class="EmphasisTypeItalic ">Process</em>: A complex business modeling would call for a process modeling, which is optional. If a process modelling is involved, the abstract metamodel relationship between a process and service is as shown in Figure <span class="InternalRef"><a href="#Fig14">1-14</a></span>.</p></li></ul></div><figure class="Figure" id="Fig14"><div class="MediaObject" id="MO14"><img alt="" aria-describedby="d64e1101" src="../images/619782_1_En_1_Chapter/Imagem-015.jpg" style="width:13.62em"/><div class="TextObject" id="d64e1101"><p class="Para" id="Par144">A diagram illustrates microservices composed of an aggregate that implements a process. The process is further divided into smaller aggregates. Each represents a specific unit of work. The service interacts with an interface.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-14</span><p class="SimplePara"><span id="ITerm40">Process vs. service relationship</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par99">

            <div class="UnorderedList">

              <ul class="UnorderedListMarkBullet">

                <li>

                  <p class="Para" id="Par100">A service exposes a service interface.</p>

                </li>

                <li>

                  <p class="Para" id="Par101">A service can be an aggregate of other services.</p>

                </li>

                <li>

                  <p class="Para" id="Par102">A process aggregates and orchestrates many services, or even other processes.</p>

                </li>

                <li>

                  <p class="Para" id="Par103">A process also exposes a service interface.</p>

                </li>

              </ul>

            </div>

          </div>

          <p class="Para" id="Par104">Subsequent discussions follow the microservices metamodel shown in Figure <span class="InternalRef"><a href="#Fig13">1-13</a></span> to represent many of the upcoming scenarios.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec19">

        <h2 class="Heading">Your First Java Microservice</h2>

        <p class="Para" id="Par105">I am sure you have had enough theory, so it’s time to build your first <span id="ITerm41">microservice</span> in Java.</p>

        <p class="Para" id="Par106">This example uses Spring Boot to build the Java microservices. The project codebase can be imported into any of your favorite IDEs, but they could also be built and run without an IDE and with the help of commands in a Windows or Mac terminal. Subsequent chapters use a similar approach, since discussion on which IDE to use and how to use a specific IDE is beyond the scope of this book. I assume you are either already familiar with those steps or can refer to an introductory Java or JEE book.</p>

        <section class="Section2 RenderAsSection2" id="Sec20">

          <h3 class="Heading">Spring Boot</h3>

          <p class="Para" id="Par107"><span id="ITerm42">Spring Boot</span> uses an opinionated view of the Spring platform and many third-party Java libraries so that it is straightforward to create standalone, production-grade, Spring-based applications that you can “just run.” Spring Boot follows many conventions and usage patterns followed by developers, which they have been leveraging while using Spring and other third-party libraries. Therefore, most Spring Boot applications need very little Spring configuration. Again, the intention is not to cover Spring Boot in detail; that is outside the scope of this chapter. Readers already familiar with Java or Spring should have no problem getting started by visiting the Spring Boot home page.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec21">

          <h3 class="Heading">Design Your First Hexagonal Microservice</h3>

          <div class="Para" id="Par108">This section starts with a trimmed-down version of the <span id="ITerm43">hexagonal microservice</span> view shown in Figure <span class="InternalRef"><a href="#Fig13">1-13</a></span>. The same is shown in Figure <span class="InternalRef"><a href="#Fig15">1-15</a></span>.<figure class="Figure" id="Fig15"><div class="MediaObject" id="MO15"><img alt="" aria-describedby="d64e1180" src="../images/619782_1_En_1_Chapter/Imagem-016.jpg" style="width:29.52em"/><div class="TextObject" id="d64e1180"><p class="Para" id="Par145">A diagram illustrates how an end user interacts with a browser, which sends requests to a REST A P I. The REST A P I then interacts with a product rest controller and a product component. The product component accesses data from an in-memory D B, which is part of the ecom-product-web-microservice.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-15</span><p class="SimplePara"><span id="ITerm44">Product web microservice</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par109">Consider Figure <span class="InternalRef"><a href="#Fig15">1-15</a></span> using the language of ports and adapters. An HTTP port is used, which is nothing more than a specification of how the user’s browser can use the application core. This port (interface) belongs inside the business logic as a REST controller. The Product entity fulfills the application core. See Figure <span class="InternalRef"><a href="#Fig16">1-16</a></span>.<figure class="Figure" id="Fig16"><div class="MediaObject" id="MO16"><img alt="" aria-describedby="d64e1200" src="../images/619782_1_En_1_Chapter/Imagem-017.jpg" style="width:25.35em"/><div class="TextObject" id="d64e1200"><p class="Para" id="Par146">A diagram illustrates the relationship between two entities. Product category and product. Product category has an i d, name, title, description, and image U R L. Product has a product i d, name, code, title, and price. A dashed arrow connects the products to the product category.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-16</span><p class="SimplePara">Product web microservice core entities</p></div></figcaption></figure></div>

          <p class="Para" id="Par110">In Figure <span class="InternalRef"><a href="#Fig15">1-15</a></span>, I have intentionally stripped off the service and the process components from Figure <span class="InternalRef"><a href="#Fig13">1-13</a></span> to make the first sample rather simple. Next, you’ll use a database adapter to connect to an in-memory DB. Again, to keep the first example simple, I haven’t designed an adapter. Instead, I used a direct dependency to an in-memory database class. In the next chapter, you will look at how to use an adapter in the right manner.</p>

          <p class="Para" id="Par111"><span class="EmphasisFontCategoryNonProportional ">ProductRestController</span> is the primary or driver adapter, which wraps around an HTTP port. You use it to tell the application core what to do. It translates whatever comes from delivery mechanism (a browser request in this case) into a method call in the application core.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec22">

          <h3 class="Heading">Code Organization</h3>

          <div class="Para" id="Par112">The source code for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The code for the sample is organized as shown in Listing <span class="InternalRef"><a href="#PC1">1-1</a></span>, inside the <span class="EmphasisFontCategoryNonProportional ">ch01\ch01-01</span> folder. This follows the standard Maven structure, so <span class="EmphasisFontCategoryNonProportional ">pom.xml</span> is in the root of the directory.<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">├── 02-ProductWeb</div><div class="FixedLine">│   ├── make.bat</div><div class="FixedLine">│   ├── make.sh</div><div class="FixedLine">│   ├── pom.xml</div><div class="FixedLine">│   ├── run.bat</div><div class="FixedLine">│   ├── run.sh</div><div class="FixedLine">│   └── src</div><div class="FixedLine">│       └── main</div><div class="FixedLine">│           ├── java</div><div class="FixedLine">│           │   └── com</div><div class="FixedLine">│           │       └── acme</div><div class="FixedLine">│           │           └── ecom</div><div class="FixedLine">│           │               └── product</div><div class="FixedLine">│           │                   ├── EcomProdMicroAppl.java</div><div class="FixedLine">│           │                   ├── InitComponent.java</div><div class="FixedLine">│           │                   ├── controller</div><div class="FixedLine">│           │                   │   ├── ProdRestContr.java</div><div class="FixedLine">│           │                   │   └── ProdRestConConfig.java</div><div class="FixedLine">│           │                   ├── db</div><div class="FixedLine">│           │                   │   └── InMemoryDB.java</div><div class="FixedLine">│           │                   └── model</div><div class="FixedLine">│           │                       ├── Product.java</div><div class="FixedLine">│           │                       └── ProductCategory.java</div><div class="FixedLine">│           └── resources</div><div class="FixedLine">│               ├── application.properties</div><div class="FixedLine">│               ├── log4j2-spring.xml</div><div class="FixedLine">│               └── static</div><div class="FixedLine">│                   ├── css</div><div class="FixedLine">│                   │   ├── app.css</div><div class="FixedLine">│                   │   └── bootstrap.css</div><div class="FixedLine">│                   ├── js</div><div class="FixedLine">│                   │   ├── app.js</div><div class="FixedLine">│                   │   ├── controller</div><div class="FixedLine">│                   │   │   └── product_controller.js</div><div class="FixedLine">│                   │   └── service</div><div class="FixedLine">│                   │       └── product_service.js</div><div class="FixedLine">│                   └── product.html</div><div class="FixedLine">├── README.txt</div><div class="FixedLine">├── make.sh</div><div class="FixedLine">├── makeandrun.bat</div><div class="FixedLine">├── makeandrun.sh</div><div class="FixedLine">└── pom.xml</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-1</span><p class="SimplePara">Spring Boot Source <span id="ITerm45">Code Organization</span></p></div></div></div></div>

          <p class="Para" id="Par113">The <span class="EmphasisFontCategoryNonProportional ">ch01\ch01-01\02-ProductWeb\src\main\java</span> folder contains the source code for the microservice. The <span class="EmphasisFontCategoryNonProportional ">ch01-01\02-ProductWeb\src\main\resources</span> folder contains the configurations for the microservice as well as the source code for the web app, which will help the end users interact with the microservice using a browser interface. The topmost folder also contains scripts that will help you build and run the microservice.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec23">

          <h3 class="Heading">Understanding the Code</h3>

          <div class="Para" id="Par114">I keep the domain <span id="ITerm46">entity</span> very simple for this first example. The entity is a typical product that can be listed on an e-commerce site. Multiple products fall into a product category, so on the site you can first show product categories and users can explore or browse through the product categories to see all products available under the selected category. Let’s look at these entities first, as shown in Listing <span class="InternalRef"><a href="#PC2">1-2</a></span>.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">public class Product {</div></div><div class="LineGroup"><div class="FixedLine">    @Id</div><div class="FixedLine">    private String productId;</div><div class="FixedLine">    private String name;</div><div class="FixedLine">    private String code;;</div><div class="FixedLine">    private String title;</div><div class="FixedLine">    private Double price;</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">public class ProductCategory {</div></div><div class="LineGroup"><div class="FixedLine">    @Id</div><div class="FixedLine">    private String id;</div><div class="FixedLine">    private String name;</div><div class="FixedLine">    private String title;</div><div class="FixedLine">    private String description;</div><div class="FixedLine">    private String imgUrl;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-2</span><p class="SimplePara">Product/Product Category Domain Model (ch01\ch01-01\02-ProductWeb\src\main\java\com\acme\ecom\product\model\Product.java)</p></div></div></div></div>

          <div class="Para" id="Par115">These entities are straightforward, hence they are not explained further. Next, consider the REST-capable HTTP <span id="ITerm47">port</span>, using a Spring <span class="EmphasisFontCategoryNonProportional ">RestController</span>, as shown in Listing <span class="InternalRef"><a href="#PC3">1-3</a></span>.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">@RestController</div><div class="FixedLine">public class ProductRestController{</div></div><div class="LineGroup"><div class="FixedLine">    @Autowired</div><div class="FixedLine">    private InMemoryDB inMemoryDB;</div></div><div class="LineGroup"><div class="FixedLine">    @RequestMapping(value = "/productsweb",</div><div class="FixedLine">        method = RequestMethod.GET,</div><div class="FixedLine">        produces = {MediaType.APPLICATION_JSON_VALUE})</div><div class="FixedLine">    public ResponseEntity&lt;List&lt;Product&gt;&gt; getAllProducts() {</div></div><div class="LineGroup"><div class="FixedLine">        List&lt;Product&gt; products = inMemoryDB.getAllProducts();</div><div class="FixedLine">        if(products.isEmpty()){</div><div class="FixedLine">            return new ResponseEntity&lt;List&lt;Product&gt;&gt;(</div><div class="FixedLine">            HttpStatus.NOT_FOUND);</div><div class="FixedLine">        }</div><div class="FixedLine">        List&lt;Product&gt; list = new ArrayList&lt;Product&gt; ();</div><div class="FixedLine">        for(Product product:products){</div><div class="FixedLine">            list.add(product);</div><div class="FixedLine">        }</div><div class="FixedLine">        return new ResponseEntity&lt;List&lt;Product&gt;&gt;(list,</div><div class="FixedLine">            HttpStatus.OK);</div><div class="FixedLine">    }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-3</span><p class="SimplePara">REST Based HTTP Port for getAllProducts (ch01\ch01-01\02-ProductWeb\src\main\java\com\acme\ecom\product\controller\ProductRestController.java)</p></div></div></div></div>

          <p class="Para" id="Par116"><span class="EmphasisFontCategoryNonProportional ">getAllProducts</span> is a Java method that will return a list of all products in the database, defined through an abstract protocol and format of delivery declared in the HTTP-based REST port. A concrete implementation of this port is then injected (or used to intercept) by Spring and used in the Controller in the runtime. They translate the JSON-formatted data payload from the HTTP delivery channel into a <span class="EmphasisFontCategoryNonProportional ">getAllProducts</span> <span id="ITerm48">method</span> call in the application core. To retrieve the products, the <span class="EmphasisFontCategoryNonProportional ">getAllProducts</span> delegates a call to an <span class="EmphasisFontCategoryNonProportional ">InMemoryDB</span> class.</p>

          <div class="Para" id="Par117">The remainder of the REST controller’s implementation is shown in Listing <span class="InternalRef"><a href="#PC4">1-4</a></span>.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">public class ProductRestController{</div></div><div class="LineGroup"><div class="FixedLine">    @RequestMapping(value = "/productsweb/{productId}",</div><div class="FixedLine">        method = RequestMethod.GET,</div><div class="FixedLine">        produces = MediaType.APPLICATION_JSON_VALUE)</div><div class="FixedLine">    public ResponseEntity&lt;Product&gt; getProduct(@PathVariable(</div><div class="FixedLine">        "productId") String productId) {</div></div><div class="LineGroup"><div class="FixedLine">        Product product = inMemoryDB.getProduct(productId);</div><div class="FixedLine">        if (product == null) {</div><div class="FixedLine">            return new ResponseEntity&lt;Product&gt;(</div><div class="FixedLine">                HttpStatus.NOT_FOUND);</div><div class="FixedLine">        }</div><div class="FixedLine">        return new ResponseEntity&lt;Product&gt;(product,</div><div class="FixedLine">            HttpStatus.OK);</div><div class="FixedLine">    }</div></div><div class="LineGroup"><div class="FixedLine">    @RequestMapping(value = "/productsweb",</div><div class="FixedLine">        method = RequestMethod.POST,</div><div class="FixedLine">        produces = MediaType.APPLICATION_JSON_VALUE)</div><div class="FixedLine">    public ResponseEntity&lt;Product&gt; addProduct(</div><div class="FixedLine">        @RequestBody Product product) {</div></div><div class="LineGroup"><div class="FixedLine">        Product productFound = inMemoryDB.getProduct(</div><div class="FixedLine">            product.getProductId());</div><div class="FixedLine">        if (null != productFound) {</div><div class="FixedLine">            return new ResponseEntity&lt;Product&gt;(</div><div class="FixedLine">                HttpStatus.CONFLICT);</div><div class="FixedLine">        }</div><div class="FixedLine">        inMemoryDB.addProduct(product);</div><div class="FixedLine">        return new ResponseEntity&lt;Product&gt;(product,</div><div class="FixedLine">            HttpStatus.OK);</div><div class="FixedLine">    }</div></div><div class="LineGroup"><div class="FixedLine">    @RequestMapping(value = "/productsweb/{productId}",</div><div class="FixedLine">        method = RequestMethod.DELETE,</div><div class="FixedLine">        produces = MediaType.APPLICATION_JSON_VALUE)</div><div class="FixedLine">    public ResponseEntity&lt;Product&gt; deleteProduct(</div><div class="FixedLine">        @PathVariable("productId")String productId) {</div></div><div class="LineGroup"><div class="FixedLine">        Product productFound = inMemoryDB.getProduct(</div><div class="FixedLine">            productId);</div><div class="FixedLine">        if (productFound == null) {</div><div class="FixedLine">            return new ResponseEntity&lt;Product&gt;(</div><div class="FixedLine">                HttpStatus.NOT_FOUND);</div><div class="FixedLine">        }</div><div class="FixedLine">        inMemoryDB.deleteProduct(productId);</div><div class="FixedLine">        return new ResponseEntity&lt;Product&gt;(</div><div class="FixedLine">            HttpStatus.NO_CONTENT);</div><div class="FixedLine">    }</div></div><div class="LineGroup"><div class="FixedLine">    @RequestMapping(value = "/productsweb/{productId}",</div><div class="FixedLine">        method = RequestMethod.PUT,</div><div class="FixedLine">        produces = MediaType.APPLICATION_JSON_VALUE)</div><div class="FixedLine">    public ResponseEntity&lt;Product&gt; updateProduct(</div><div class="FixedLine">        @PathVariable("productId")String productId,</div><div class="FixedLine">        @RequestBody Product product) {</div></div><div class="LineGroup"><div class="FixedLine">        Product currentProduct = inMemoryDB.getProduct(</div><div class="FixedLine">            productId);</div><div class="FixedLine">        if (currentProduct == null) {</div><div class="FixedLine">            return new ResponseEntity&lt;Product&gt;(</div><div class="FixedLine">                HttpStatus.NOT_FOUND);</div><div class="FixedLine">        }</div><div class="FixedLine">        currentProduct.setName(product.getName());</div><div class="FixedLine">        currentProduct.setCode(product.getCode());</div><div class="FixedLine">        currentProduct.setTitle(product.getTitle());</div><div class="FixedLine">        currentProduct.setPrice(product.getPrice());</div><div class="FixedLine">        Product newProduct = inMemoryDB.updateProduct(</div><div class="FixedLine">            currentProduct);</div><div class="FixedLine">        return new ResponseEntity&lt;Product&gt;(newProduct,</div><div class="FixedLine">            HttpStatus.OK);</div><div class="FixedLine">    }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-4</span><p class="SimplePara">REST Based HTTP Port for getAllProducts (ch01\ch01-01\02-ProductWeb\src\main\java\com\acme\ecom\product\controller\ProductRestController.java)</p></div></div></div></div>

          <p class="Para" id="Par118">Here, given a <span class="EmphasisFontCategoryNonProportional ">productId</span>, the <span class="EmphasisFontCategoryNonProportional ">getProduct</span> method will retrieve the details of a specific product. <span class="EmphasisFontCategoryNonProportional ">addProduct</span> will create a new product and <span class="EmphasisFontCategoryNonProportional ">deleteProduct</span> will remove a product from the in-memory DB. <span class="EmphasisFontCategoryNonProportional ">updateProduct</span> will update a product with a new set of values.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec24">

          <h3 class="Heading">Build and Run the Code</h3>

          <div class="Para" id="Par119">The <span class="EmphasisFontCategoryNonProportional ">ch01\ch01-01</span> folder contains the Maven scripts required to build and <span id="ITerm49">run</span> the examples. This example is the simplest microservice anyone could think of, since there are no dependencies to external resources like databases or message queues. It’s still a fully functional microservice demonstrating the complete CRUD (Create, Read, Update, and Delete) functionality, so building the sample and bringing up the microservices is a breeze. Assuming you have Java and Maven installed in your machine, you can open a command terminal, go to the <span class="EmphasisFontCategoryNonProportional ">ch01\ch01-01</span> folder, and execute the commands in Listing <span class="InternalRef"><a href="#PC5">1-5</a></span>.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">mvn -Dmaven.test.skip=true clean package</div><div class="FixedLine">java -jar -Dserver.port=8080 ./02-ProductWeb/target/Ecom-Product-Web-Microservice-0.0.1-SNAPSHOT.jar</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-5</span><p class="SimplePara">Commands to Build and Run the Microservice</p></div></div></div></div>

          <div class="Para" id="Par120">Alternatively, there is a shell script for a Mac terminal and a Windows batch script that will help you build and run the application in a single go, as shown in Listing <span class="InternalRef"><a href="#PC6">1-6</a></span>.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch01-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-04/Code/ch01/ch01-01</div><div class="FixedLine">binildass-MacBook-Pro:ch01-01 binil$ sh makeandrun.sh</div><div class="FixedLine">[INFO] Scanning for projects...</div><div class="FixedLine">[INFO] ------------------------------------------------------</div><div class="FixedLine">[INFO] Reactor Build Order:</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Ecom-Product-Web-Microservice                  [jar]</div><div class="FixedLine">[INFO] Ecom                                           [pom]</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] --------&lt;com.acme.ecom.product:Ecom-Product-Web-Micro</div><div class="FixedLine">[INFO] Building Ecom-Product-Web-Mi 0.0.1-SNAPSHOT    [1/2]</div><div class="FixedLine">[INFO] --------------------------------[ jar ]--------------</div><div class="FixedLine">[INFO]</div><div class="FixedLine">...</div><div class="FixedLine">[INFO]</div><div class="FixedLine">[INFO] Ecom-Product-Web-Microservice .... SUCCESS [  1.705 s]</div><div class="FixedLine">[INFO] Ecom ............................. SUCCESS [  0.019 s]</div><div class="FixedLine">[INFO] -----------------------------------------------------</div><div class="FixedLine">[INFO] BUILD SUCCESS</div><div class="FixedLine">[INFO] -----------------------------------------------------</div><div class="FixedLine">[INFO] Total time:  1.902 s</div><div class="FixedLine">[INFO] Finished at: 2023-12-13T11:32:38+05:30</div><div class="FixedLine">[INFO] -----------------------------------------------------</div></div><div class="LineGroup"><div class="FixedLine">  .   ____          _            __ _ _</div><div class="FixedLine"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="FixedLine">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</div><div class="FixedLine"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="FixedLine">  '  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="FixedLine"> =========|_|==============|___/=/_/_/_/</div><div class="FixedLine"> :: Spring Boot ::                (v3.2.0)</div></div><div class="LineGroup"><div class="FixedLine">2023-12-13 11:32:39 INFO  Startup…:50 - Starting EcomProd...</div><div class="FixedLine">2023-12-13 11:32:39 DEBUG StartupInfoLogger.logStarting:51 - Running with Spring Boot v3.2.0, Spring v6.1.1</div><div class="FixedLine">2023-12-13 11:32:39 INFO  SpringApp…:653 - No active ...</div><div class="FixedLine">2023-12-13 11:32:40 INFO  InMemoryDB.initDB:71 - Start</div><div class="FixedLine">2023-12-13 11:32:40 INFO  InMemoryDB.initDB:92 - Ending.</div><div class="FixedLine">2023-12-13 11:32:40 INFO  Initial...init:35 - Start</div><div class="FixedLine">2023-12-13 11:32:40 DEBUG Initial...init:37 - Doing Nothing...</div><div class="FixedLine">2023-12-13 11:32:40 INFO  Initial….init:39 - End</div><div class="FixedLine">2023-12-13 11:32:40 INFO  Start…:56 - Started EcomProd...</div><div class="FixedLine">2023-12-13 11:32:46 INFO  ProdRest...getAllProducts:64 - Start</div><div class="FixedLine">2023-12-13 11:32:46 DEBUG ProductRest...lambda$getAll$0:74 - Product [productId=1, ...</div><div class="FixedLine">2023-12-13 11:32:46 DEBUG ProductRestController.lambda$getAllProducts$0:74 - Product [productId=2, ...</div><div class="FixedLine">2023-12-13 11:32:46 INFO  ProdRest.getAllProducts:75 – Ending</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-6</span><p class="SimplePara">Build and Run the Microservice Using Scripts</p></div></div></div></div>

          <p class="Para" id="Par121">You can see from the log that the application is built and deployed, and it is in the running state. Now it’s time to test the application.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec25">

          <h3 class="Heading">Test the Microservice Using UI</h3>

          <div class="Para" id="Par122">Once the microservice is up, you can access the <span id="ITerm50">web application</span> using your <span id="ITerm51">browser</span> and pointing to <span class="EmphasisFontCategoryNonProportional ">http://localhost:8080/product.html</span> (see Figure <span class="InternalRef"><a href="#Fig17">1-17</a></span>).<figure class="Figure" id="Fig17"><div class="MediaObject" id="MO17"><img alt="" aria-describedby="d64e1853" src="../images/619782_1_En_1_Chapter/Imagem-018.jpg" style="width:35.15em"/><div class="TextObject" id="d64e1853"><p class="Para" id="Par147">A screenshot of a web page displays a bootstrap C R U D data table for product management. The table includes columns for I D, name, code, title, price, and actions. Users can add new products, edit existing ones, or delete them.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-17</span><p class="SimplePara">Accessing the microservice using a <span id="ITerm52">browser</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par123">Typing this URL using the browser will render the UI app that’s packaged inside the <span class="EmphasisFontCategoryNonProportional ">resources</span> folder inside the project. From the browser UI, you can add a new product by clicking the Add New <span id="ITerm53">Product button</span> and entering the details (see Figure <span class="InternalRef"><a href="#Fig18">1-18</a></span>).<figure class="Figure" id="Fig18"><div class="MediaObject" id="MO18"><img alt="" aria-describedby="d64e1890" src="../images/619782_1_En_1_Chapter/Imagem-019.jpg" style="width:30.42em"/><div class="TextObject" id="d64e1890"><p class="Para" id="Par148">A screenshot of a pane titled product details. The form fields include I D, name, code, title, and price. The current values for the product with I D 3 are displayed in the fields. There are buttons for cancel and submit at the bottom right.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-18</span><p class="SimplePara">Adding a new <span id="ITerm54">product</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par124">Input some meaningful values for all the fields in the UI and click the <span id="ITerm55">Submit button</span>, which will ask the microservice to create a new product in the in-memory DB. The newly added product will also be listed in the refreshed screen, as shown in Figure <span class="InternalRef"><a href="#Fig19">1-19</a></span>.<figure class="Figure" id="Fig19"><div class="MediaObject" id="MO19"><img alt="" aria-describedby="d64e1916" src="../images/619782_1_En_1_Chapter/Imagem-020.jpg" style="width:35.15em"/><div class="TextObject" id="d64e1916"><p class="Para" id="Par149">A screenshot of a web page displays a bootstrap C R U D data table for product management. The table includes columns for I D, name, code, title, price, and actions. Users can add new products, edit existing ones, or delete them. It lists kamsung D 3, lokia pomia, and mapple k phone under the name.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-19</span><p class="SimplePara">Listing the newly added product</p></div></figcaption></figure></div>

          <div class="Para" id="Par125"><span id="ITerm56"></span>You can now attempt to edit (update) the newly added product by clicking the Edit icon on the right side of each listed product entry. See Figure <span class="InternalRef"><a href="#Fig20">1-20</a></span>.<span id="ITerm57"></span><figure class="Figure" id="Fig20"><div class="MediaObject" id="MO20"><img alt="" aria-describedby="d64e1958" src="../images/619782_1_En_1_Chapter/Imagem-021.jpg" style="width:34em"/><div class="TextObject" id="d64e1958"><p class="Para" id="Par150">A screenshot of a pane titled product details. The form fields include I D, name, code, title, and price. The current values for the product with I D 3 are displayed in the fields. There are buttons for cancel and submit at the bottom right.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-20</span><p class="SimplePara">Update the <span id="ITerm58">product</span></p></div></figcaption></figure></div>

          <div class="Para" id="Par126">As shown in Figure <span class="InternalRef"><a href="#Fig20">1-20</a></span>, without changing the product ID, make some valid changes to some of the fields—price in this example. Clicking the Submit button to have the changes take effect. See Figure <span class="InternalRef"><a href="#Fig21">1-21</a></span>.<figure class="Figure" id="Fig21"><div class="MediaObject" id="MO21"><img alt="" aria-describedby="d64e1978" src="../images/619782_1_En_1_Chapter/Imagem-022.jpg" style="width:35.15em"/><div class="TextObject" id="d64e1978"><p class="Para" id="Par151">A screenshot of a web page displays a bootstrap C R U D data table for managing products. The table includes columns for I D, name, code, title, price, and actions. Users can add new products, edit existing ones, or delete them. It lists kamsung D 3, lokia pomia, and mapple k phone under the name.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-21</span><p class="SimplePara">Listing the updated product</p></div></figcaption></figure></div>

          <p class="Para" id="Par127"><span id="ITerm59"></span>The changes made to the product are listed in the refreshed screen, as shown in Figure <span class="InternalRef"><a href="#Fig21">1-21</a></span>.</p>

          <div class="Para" id="Par128">Last but not the least, you might also want to test the Delete functionality, which you can do by clicking the <span id="ITerm60">Delete icon</span> on the far right side of each product and then confirming your action. See Figure <span class="InternalRef"><a href="#Fig22">1-22</a></span>.<figure class="Figure" id="Fig22"><div class="MediaObject" id="MO22"><img alt="" aria-describedby="d64e2024" src="../images/619782_1_En_1_Chapter/Imagem-023.jpg" style="width:30.85em"/><div class="TextObject" id="d64e2024"><p class="Para" id="Par152">A screenshot of a confirmation dialog box that asks the user if they are sure they want to delete a product. The cancel and delete buttons are at the bottom right.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-22</span><p class="SimplePara">Confirming <span id="ITerm61">Delete</span></p></div></figcaption></figure></div>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec26">

          <h3 class="Heading">Test the Microservice Using cURL</h3>

          <p class="Para" id="Par129">You may also want to use cURL or <span id="ITerm62">Postman</span> to test all the methods implemented in the microservice. Refer to Appendix A for detailed instructions.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec27">

        <h2 class="Heading">Summary</h2>

        <p class="Para" id="Par130">In this chapter, I purposefully tried to avoid defining microservices, since many definitions and viewpoints exist in the industry. Instead, I attempted to look at microservices from some less common perspectives with a view to understand how they fit into the bigger computing paradigm. This chapter also considered how the distinguishing features help provide superior capabilities in executing business transactions. I also attempted to show, with examples, what a hexagonal architecture is. I continue this discussion in the next two chapters, with more examples, so that you can clearly appreciate the design structure and qualities your microservices will have if you adopt the principles of a hexagonal architecture.</p>

      </section>

      <aside aria-label="Footnotes" class="FootnoteSection" epub:type="footnotes">

        <div class="Heading">Footnotes</div>

        <div class="Footnote"><span class="FootnoteNumber"><a href="#Fn1_source">1</a></span><div class="FootnoteContent" epub:type="footnote" id="Fn1" role="doc-footnote"><p class="Para" id="Par13">Monochrome monitors are commonly available in three colors: If the P1 phosphor is used, the screen is green monochrome. If the P3 phosphor is used, the screen is amber monochrome. If the P4 phosphor is used, the screen is white monochrome (known as “page white”).</p></div><div class="ClearBoth"> </div></div>

        <div class="Footnote"><span class="FootnoteNumber"><a href="#Fn2_source">2</a></span><div class="FootnoteContent" epub:type="footnote" id="Fn2" role="doc-footnote"><p class="Para" id="Par40">ACID stands for Atomicity, Consistency, Isolation, and Durability. If a database operation has these ACID properties, it can be called an ACID transaction, and data storage systems that apply these operations are called transactional systems.</p></div><div class="ClearBoth"> </div></div>

      </aside>

    </div>

  </div>

</body>

</html>