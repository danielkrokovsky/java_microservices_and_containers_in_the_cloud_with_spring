<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en">

<head>
  <title>Microservices in AWS Elastic Kubernetes Service</title>
  <link href="../css/springer_epub.css" rel="styleSheet" type="text/css"/>
</head>

<body>

  <div epub:type="chapter" role="doc-chapter">

    <div class="ChapterContextInformation">

      <div class="ContextInformation" id="b979-8-8688-0555-4_15"><div class="ChapterCopyright">© The Author(s), under exclusive license to APress Media, LLC, part of Springer Nature 2024</div><span class="ContextInformationAuthorEditorNames">B. A. Christudas</span><span class="ContextInformationBookTitles"><span class="BookTitle">Java Microservices and Containers in the Cloud</span></span><span class="ChapterDOI"><a href="https://doi.org/10.1007/979-8-8688-0555-4_15">https://doi.org/10.1007/979-8-8688-0555-4_15</a></span></div>

    </div>

    <!--Begin Abstract-->

    <div class="MainTitleSection">

      <h1 class="ChapterTitle" lang="en">15. Microservices in AWS Elastic Kubernetes Service</h1>

    </div>

    <div class="AuthorGroup">

      <div class="AuthorNames"><span class="Author"><span class="AuthorName">Binildas A. Christudas</span><sup><a href="#Aff2">1</a> <span class="ContactIcon"> </span></sup></span></div>

      <div class="Affiliations">

        <div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">NBCRA 45, Christbin, Thiruvananthapuram, Kerala, India</div></div>

        <div class="ClearBoth"> </div>

      </div>

    </div>

    <!--End Abstract-->

    <div class="Fulltext">

      <p class="Para" id="Par2">You learned in the previous chapter how to create a minimal compute infrastructure in AWS using the IaC tool Terraform. In this chapter, you extend that knowledge by setting up a <span id="ITerm1">Kubernetes-based infrastructure</span> using the same toolset. You have already seen how a single-node Kubernetes based on Minikube enables you to run all the examples in this book up to the previous chapter. Now you will attempt to deploy those microservices in a multi-node Kubernetes-based infrastructure on the AWS cloud.</p>

      <div class="Para" id="Par3">This chapter covers the following concepts:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par4">Elastic Kubernetes Service (EKS)</p></li><li><p class="Para" id="Par5">Setting up an AWS EKS using Terraform</p></li><li><p class="Para" id="Par6">Running microservice containers in AWS EKS</p></li></ul></div></div>

      <section class="Section1 RenderAsSection1" id="Sec1">

        <h2 class="Heading">The Amazon Elastic Kubernetes Service</h2>

        <p class="Para" id="Par7">Amazon Elastic Kubernetes Service (Amazon EKS) runs the <span id="ITerm2">Kubernetes management infrastructure</span> across Availability Zones. Applications running on any standard Kubernetes environment are fully compatible and can be migrated to Amazon EKS, so this chapter demonstrates how the microservices you deployed in Minikube can be deployed in EKS in AWS.</p>

        <p class="Para" id="Par8">Amazon EKS cluster consists of two primary components—the EKS control plane and the EKS worker nodes.</p>

        <section class="Section2 RenderAsSection2" id="Sec2">

          <h3 class="Heading">EKS Control Plane</h3>

          <p class="Para" id="Par9">The <span id="ITerm3">EKS control plane</span><span id="ITerm4"></span> consists of nodes that run the Kubernetes software, such as etcd and the Kubernetes API server. (Refer to Chapter <span class="ExternalRef"><a href="Capítulo-12.html"><span class="RefSource">10</span></a></span> for an overview of these components.) The control plane runs in an account managed by AWS, and the Kubernetes API is exposed via the Amazon EKS endpoint associated with your cluster. Each Amazon EKS cluster control plane runs on its own set of Amazon EC2 instances. These control plane nodes are also provisioned across multiple Availability Zones and fronted by an Elastic Load Balancing Network Load Balancer. Amazon EKS also provisions elastic network interfaces in your VPC subnets to provide connectivity from the control plane instances to the nodes.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec3">

          <h3 class="Heading">EKS Worker Nodes</h3>

          <p class="Para" id="Par10"><span id="ITerm5">EKS worker nodes</span><span id="ITerm6"></span> are part of the Kubernetes cluster, where the user’s workload is processed. Amazon EKS worker nodes are created in your AWS account, and they establish a connection to your cluster’s control plane instance running in an AWS managed account. Amazon EKS worker nodes are registered with the control plane.</p>

          <p class="Para" id="Par11">As of this writing, a related solution called Amazon EKS Blueprints was introduced. However, <span id="ITerm7">Amazon</span><span id="ITerm8"></span> EKS still works.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec4">

        <h2 class="Heading">Setting Up AWS EKS Using Terraform</h2>

        <p class="Para" id="Par12">This section illustrates a working demonstration of an AWS EKS based microservices deployment. This chapter is built over the fundamentals of AWS Cloud, which you learned about in Chapter <span class="ExternalRef"><a href="Capítulo-16.html"><span class="RefSource">14</span></a></span>, so you are advised to refer to Chapter <span class="ExternalRef"><a href="Capítulo-16.html"><span class="RefSource">14</span></a></span> prior to reading this chapter. This chapter will also leverage Terraform, so that it is relatively easy for you to set up the infrastructure and run the examples. If you are already familiar with AWS Cloud and Terraform, you can read this chapter without referring back to Chapter <span class="ExternalRef"><a href="Capítulo-16.html"><span class="RefSource">14</span></a></span>.</p>

        <div class="Para" id="Par13">Since this example uses Terraform to create an EKS compute infrastructure in AWS, I assume that you have the following <span id="ITerm9">prerequisites</span> on your development machine:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par14">An <span id="ITerm10">AWS account</span> that you know how to manage using the AWS web console</p></li><li><p class="Para" id="Par15"><span id="ITerm11">AWS CLI</span> (Command Line Interface) installed and the terminal configured with secret keys to access the AWS account</p></li><li><p class="Para" id="Par16">A key pair to access your EC2 instances</p></li><li><p class="Para" id="Par17">Terraform installed</p></li></ul></div></div>

        <p class="Para" id="Par18">I don’t cover those aspects in this book. If you aren’t familiar with these steps, you are advised to refer to an appropriate book.<sup><a epub:type="noteref" href="#Fn1" id="Fn1_source" role="doc-noteref">1</a></sup> Appendix F also provides some guidance for using a few of these tools.</p>

        <section class="Section2 RenderAsSection2" id="Sec5">

          <h3 class="Heading">Designing an EKS Topology in an AWS Cloud</h3>

          <div class="Para" id="Par20">You will have a very <span id="ITerm12">minimal</span> EKS cluster in an AWS cloud (see Figure <span class="InternalRef"><a href="#Fig1">15-1</a></span>). Even though the intention is to set up a minimal EKS infrastructure, note that you also need a full set of compute and network infrastructures for this, which is nontrivial. Thanks to Terraform, which makes even such nontrivial tasks accessible to developers like you and me, as you learned in the previous chapter.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="" aria-describedby="d64e310" src="../images/619782_1_En_15_Chapter/Imagem-144.jpg" style="width:35.15em"/><div class="TextObject" id="d64e310"><p class="Para" id="Par78">A layered block diagram has the following flow, internet, internet gateway under A W S cloud and region, router and route table under V P C, security group of E C 2 and T 2 under Kubernetes server and subnet, and E K S connected to 3 availability zones with security group worker nodes under another subnet from the outermost to the innermost layer.</p></div></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 15-1</span><p class="SimplePara"><span id="ITerm13">EKS cluster</span> in an AWS cloud</p></div></figcaption></figure></div>

          <p class="Para" id="Par21">A typical <span id="ITerm14">EKS cluster</span> is shown in Figure <span class="InternalRef"><a href="#Fig1">15-1</a></span>. However, note that, for the Kubernetes server you could have redundancy by having multiple nodes. Even though the diagram depicts three nodes for the worker cluster, this example will be a <span id="ITerm15">customized</span> one to keep the infrastructure simple.</p>

          <p class="Para" id="Par22">Let’s get into the code now. Let’s start by investigating the project structure.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec6">

          <h3 class="Heading">Code Organization</h3>

          <div class="Para" id="Par23">The source <span id="ITerm16">code</span> for this book is available on GitHub via the book’s product page, located at <span class="ExternalRef"><a href="http://www.apress.com/9798868805547"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.apress.com/9798868805547</span></span></a></span>. The source code for this example is organized as shown in Listing <span class="InternalRef"><a href="#PC1">15-1</a></span>, inside the <span class="EmphasisFontCategoryNonProportional ">ch15\ch15-01</span> folder.<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">./ch15-01/</div><div class="FixedLine">├── README.txt</div><div class="FixedLine">├── eks-cluster.tf</div><div class="FixedLine">├── eks-worker-nodes.tf</div><div class="FixedLine">├── outputs.tf</div><div class="FixedLine">├── product-deployment.yaml</div><div class="FixedLine">├── product-service.yaml</div><div class="FixedLine">├── providers.tf</div><div class="FixedLine">├── variables.tf</div><div class="FixedLine">├── vpc.tf</div><div class="FixedLine">└── workstation-external-ip.tf</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-1</span><p class="SimplePara"><span id="ITerm17">Terraform EKS Project Source Code Organization</span></p></div></div></div></div>

          <p class="Para" id="Par24">Chapter <span class="ExternalRef"><a href="Capítulo-16.html"><span class="RefSource">14</span></a></span> showed the contents of a few of these files. In addition, you adapted a few new files from the <span id="ITerm18">EKS</span> example provided on the Terraform website to create this demonstration. Let’s investigate the new aspects in this example.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec7">

          <h3 class="Heading">Understanding the Source Code</h3>

          <div class="Para" id="Par25">Start with the first step of selecting which cloud provider you want to use. See Listing <span class="InternalRef"><a href="#PC2">15-2</a></span>.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">terraform {</div><div class="FixedLine">  required_version = "&gt;= 0.12"</div><div class="FixedLine">}</div><div class="FixedLine">provider "aws" {</div><div class="FixedLine">  region = var.aws_region</div><div class="FixedLine">}</div><div class="FixedLine">data "aws_availability_zones" "available" {}</div><div class="FixedLine">provider "http" {}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-2</span><p class="SimplePara"><span id="ITerm19">AWS Region Configuration</span> (ch15/ch15-01/providers.tf)</p></div></div></div></div>

          <p class="Para" id="Par26">After specifying the Terraform version, you have to mention that you intend to use <span class="EmphasisFontCategoryNonProportional ">aws</span> as the cloud provider. I am using <span class="EmphasisFontCategoryNonProportional ">ap-southeast-1</span>, which is the Singapore region, but you may use whichever region you prefer.</p>

          <p class="Para" id="Par27">The <span id="ITerm20">Availability Zones</span><span id="ITerm21"></span> data source allows access to the list of AWS Availability Zones that can be accessed by an AWS account in the region configured in the provider.</p>

          <div class="Para" id="Par28">The <span id="ITerm22">HTTP provider</span> is used to interact with generic HTTP servers. It provides a data source that issues an HTTP request exposing the response headers and a body for use within a Terraform deployment. You use this HTTP provider to determine your own external IP gateway address (see Listing <span class="InternalRef"><a href="#PC3">15-3</a></span>). If you have that, you can configure inbound <span id="ITerm23">EC2 Security Group access</span> to the Kubernetes cluster. You’ll do that in the next descriptor.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">data "http" "workstation-external-ip" {</div><div class="FixedLine">  url = "http://ipv4.icanhazip.com"</div><div class="FixedLine">}</div><div class="FixedLine">locals {</div><div class="FixedLine">  workstation-external-cidr = "${chomp(data.http.workstation-external-ip.body)}/32"</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-3</span><p class="SimplePara"><span id="ITerm24">Discover External IP Gateway Address</span> (ch15/ch15-01/workstation-external-ip.tf)</p></div></div></div></div>

          <p class="Para" id="Par29">As you can guess, this example overrides in the runtime the value of <span class="EmphasisFontCategoryNonProportional ">workstation-external-cidr</span> with the value of the external IP gateway address. Assuming you want the external IP gateway address, you’ll need to either determine it from the gateway device manually or ask an external service. <span class="ExternalRef"><a href="http://icanhazip.com"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">icanhazip.com</span></span></a></span> is one such service that can show your <span id="ITerm25">Internet-facing IPv4 and IPv6 addresses</span>, among other things.</p>

          <div class="Para" id="Par30">There are a couple of ways to use this service:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par31">In a configuration file, point to <span class="EmphasisFontCategoryNonProportional ">(http://)</span><span class="ExternalRef"><a href="http://ipv4.icanhazip.com"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">ipv4.icanhazip.com</span></span></a></span> (or <span class="EmphasisFontCategoryNonProportional ">ipv6</span> if you need that).</p></li><li><p class="Para" id="Par32">In a script, get the address using curl like this: echo This external IP address is <span class="EmphasisFontCategoryNonProportional ">$(curl -s</span> <span class="ExternalRef"><a href="http://ipv4.icanhazip.com"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">http://ipv4.icanhazip.com</span></span></a></span><span class="EmphasisFontCategoryNonProportional ">).</span></p></li></ul></div></div>

          <div class="Para" id="Par33">Before you proceed, you need to configure the <span class="EmphasisFontCategoryNonProportional ">region = var.aws_region</span> in the <span class="EmphasisFontCategoryNonProportional ">variables</span> configuration. See Listing <span class="InternalRef"><a href="#PC4">15-4</a></span>.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">variable "aws_region" {</div><div class="FixedLine">  default = "ap-southeast-1"</div><div class="FixedLine">}</div><div class="FixedLine">variable "cluster-name" {</div><div class="FixedLine">  default = "bdca-tf-eks-01"</div><div class="FixedLine">  type    = string</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-4</span><p class="SimplePara">Terraform <span id="ITerm26">Variables Configuration</span> (ch15/ch15-01/variables.tf)</p></div></div></div></div>

          <p class="Para" id="Par34">That is self-explanatory.</p>

          <div class="Para" id="Par35">You started with the provider as AWS, now you’ll investigate the <span id="ITerm27">network infrastructure definitions</span>. See Listing <span class="InternalRef"><a href="#PC5">15-5</a></span>.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">resource "aws_vpc" "demo" {</div><div class="FixedLine">  cidr_block = "10.0.0.0/16"</div></div><div class="LineGroup"><div class="FixedLine">  tags = tomap(</div><div class="FixedLine">    {"Name" = "terraform-eks-demo-node",</div><div class="FixedLine">    "kubernetes.io/cluster/${var.cluster-name}" = "shared"}</div><div class="FixedLine">  )</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_subnet" "demo" {</div><div class="FixedLine">  count = 2</div></div><div class="LineGroup"><div class="FixedLine">  availability_zone       = data.aws_availability_zones.available.names[count.index]</div><div class="FixedLine">  cidr_block              = "10.0.${count.index}.0/24"</div><div class="FixedLine">  map_public_ip_on_launch = true</div><div class="FixedLine">  vpc_id                  = aws_vpc.demo.id</div></div><div class="LineGroup"><div class="FixedLine">  tags = tomap(</div><div class="FixedLine">    {"Name" = "terraform-eks-demo-node",</div><div class="FixedLine">    "kubernetes.io/cluster/${var.cluster-name}" = "shared"}</div><div class="FixedLine">  )</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_internet_gateway" "demo" {</div><div class="FixedLine">  vpc_id = aws_vpc.demo.id</div></div><div class="LineGroup"><div class="FixedLine">  tags = {</div><div class="FixedLine">    Name = "terraform-eks-demo"</div><div class="FixedLine">  }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_route_table" "demo" {</div><div class="FixedLine">  vpc_id = aws_vpc.demo.id</div></div><div class="LineGroup"><div class="FixedLine">  route {</div><div class="FixedLine">    cidr_block = "0.0.0.0/0"</div><div class="FixedLine">    gateway_id = aws_internet_gateway.demo.id</div><div class="FixedLine">  }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_route_table_association" "demo" {</div><div class="FixedLine">  count = 2</div></div><div class="LineGroup"><div class="FixedLine">  subnet_id      = aws_subnet.demo.*.id[count.index]</div><div class="FixedLine">  route_table_id = aws_route_table.demo.id</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-5</span><p class="SimplePara">Terraform EKS Network Infrastructure Configuration (ch15/ch15-01/vpc.tf)</p></div></div></div></div>

          <p class="Para" id="Par36">Refer to Chapter <span class="ExternalRef"><a href="Capítulo-16.html"><span class="RefSource">14</span></a></span> for a detailed explanation of many of these configurations.</p>

          <p class="Para" id="Par37">There are a few new <span id="ITerm28">aspects</span>, which I explain here.</p>

          <p class="Para" id="Par38">This specification will create a <span class="EmphasisFontCategoryNonProportional ">10.0.0.0/16</span> VPC, two <span class="EmphasisFontCategoryNonProportional ">10.0.X.0/24</span> subnets, and an Internet gateway, and it will set up the subnet routing to route external traffic through the Internet gateway.</p>

          <p class="Para" id="Par39">The <span class="EmphasisFontCategoryNonProportional ">count = 2</span> is a <span id="ITerm29">meta-argument</span> in Terraform. It can be used with modules and with every resource type. The <span class="EmphasisFontCategoryNonProportional ">count</span> meta-argument accepts a whole number and creates that many instances of the resource or module. Each instance has a distinct infrastructure object associated with it, and each is separately created, updated, or destroyed when the configuration is applied. The intention is to create two subnets.</p>

          <div class="Para" id="Par40">In blocks where <span class="EmphasisFontCategoryNonProportional ">count</span> is set, an additional <span class="EmphasisFontCategoryNonProportional ">count</span> <span id="ITerm30">object</span> is available in expressions, so you can modify the configuration of each instance. This object has one attribute:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par41"><span class="EmphasisFontCategoryNonProportional ">count.index</span>: The distinct index number (starting with <span class="EmphasisFontCategoryNonProportional ">0</span>) corresponding to this instance.</p></li></ul></div></div>

          <p class="Para" id="Par42">You are using the <span class="EmphasisFontCategoryNonProportional ">count = 2</span> as a meta-argument in the <span class="EmphasisFontCategoryNonProportional ">aws_subnet demo</span> resource and in the <span class="EmphasisFontCategoryNonProportional ">aws_route_table_association demo</span> resource. In the first case, you are using <span id="ITerm31"><span class="EmphasisFontCategoryNonProportional ">count.index</span></span> to specify the <span class="EmphasisFontCategoryNonProportional ">cidr_block</span> and in the second case, you are using <span class="EmphasisFontCategoryNonProportional ">count.index</span> to specify the <span class="EmphasisFontCategoryNonProportional ">subnet_id</span> for the route table association.</p>

          <div class="Para" id="Par43">Now comes the cluster and worker specifications. First the cluster description. The cluster in Amazon EKS can be configured in Terraform with the resource name <span id="ITerm32"><span class="EmphasisFontCategoryNonProportional ">aws_eks_cluster</span></span>. See Listing <span class="InternalRef"><a href="#PC6">15-6</a></span>.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">resource "aws_iam_role" "demo-cluster" {</div><div class="FixedLine">  name = "terraform-eks-demo-cluster"</div></div><div class="LineGroup"><div class="FixedLine">  assume_role_policy = &lt;&lt;POLICY</div><div class="FixedLine">{</div><div class="FixedLine">  "Version": "2012-10-17",</div><div class="FixedLine">  "Statement": [</div><div class="FixedLine">    {</div><div class="FixedLine">      "Effect": "Allow",</div><div class="FixedLine">      "Principal": {</div><div class="FixedLine">        "Service": "eks.amazonaws.com"</div><div class="FixedLine">      },</div><div class="FixedLine">      "Action": "sts:AssumeRole"</div><div class="FixedLine">    }</div><div class="FixedLine">  ]</div><div class="FixedLine">}</div><div class="FixedLine">POLICY</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_iam_role_policy_attachment" "demo-cluster-AmazonEKSClusterPolicy" {</div><div class="FixedLine">  policy_arn = "arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"</div><div class="FixedLine">  role       = aws_iam_role.demo-cluster.name</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_iam_role_policy_attachment" "demo-cluster-AmazonEKSVPCResourceController" {</div><div class="FixedLine">  policy_arn = "arn:aws:iam::aws:policy/AmazonEKSVPCResourceController"</div><div class="FixedLine">  role       = aws_iam_role.demo-cluster.name</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_security_group" "demo-cluster" {</div><div class="FixedLine">  name        = "terraform-eks-demo-cluster"</div><div class="FixedLine">  description = "Cluster communication with worker nodes"</div><div class="FixedLine">  vpc_id      = aws_vpc.demo.id</div></div><div class="LineGroup"><div class="FixedLine">  egress {</div><div class="FixedLine">    from_port   = 0</div><div class="FixedLine">    to_port     = 0</div><div class="FixedLine">    protocol    = "-1"</div><div class="FixedLine">    cidr_blocks = ["0.0.0.0/0"]</div><div class="FixedLine">  }</div></div><div class="LineGroup"><div class="FixedLine">  tags = {</div><div class="FixedLine">    Name = "terraform-eks-demo"</div><div class="FixedLine">  }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_security_group_rule" "demo-cluster-ingress-workstation-https" {</div><div class="FixedLine">  cidr_blocks       = [local.workstation-external-cidr]</div><div class="FixedLine">  description       = "Allow workstation to communicate with cluster API Server"</div><div class="FixedLine">  from_port         = 443</div><div class="FixedLine">  protocol          = "tcp"</div><div class="FixedLine">  security_group_id = aws_security_group.demo-cluster.id</div><div class="FixedLine">  to_port           = 443</div><div class="FixedLine">  type              = "ingress"</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_eks_cluster" "demo" {</div><div class="FixedLine">  name     = var.cluster-name</div><div class="FixedLine">  role_arn = aws_iam_role.demo-cluster.arn</div></div><div class="LineGroup"><div class="FixedLine">  vpc_config {</div><div class="FixedLine">    security_group_ids = [aws_security_group.demo-cluster.id]</div><div class="FixedLine">    subnet_ids         = aws_subnet.demo[*].id</div><div class="FixedLine">  }</div></div><div class="LineGroup"><div class="FixedLine">  depends_on = [</div><div class="FixedLine">    aws_iam_role_policy_attachment.demo-cluster-AmazonEKSClusterPolicy,</div><div class="FixedLine">    aws_iam_role_policy_attachment.demo-cluster-AmazonEKSVPCResourceController,</div><div class="FixedLine">  ]</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-6</span><p class="SimplePara">Terraform EKS Cluster <span id="ITerm33">Configuration</span> (ch15/ch15-01/eks-cluster.tf)</p></div></div></div></div>

          <p class="Para" id="Par44">The <span id="ITerm34">security group</span> of worker nodes and the security group that handles the communication of the worker nodes with the control plane have been constructed in a way to avoid communication via the privileged ports in the worker nodes.</p>

          <p class="Para" id="Par45">You need a few <span id="ITerm35">operator-managed resources</span> beforehand so that Kubernetes can properly manage other AWS services and allow inbound networking communication from your local workstation (if desired) and worker nodes.</p>

          <p class="Para" id="Par46"><span class="EmphasisFontCategoryNonProportional ">aws_iam_role</span> and <span class="EmphasisFontCategoryNonProportional ">aws_iam_role_policy_attachment</span> are required to allow the EKS service to manage or retrieve data from other AWS services.</p>

          <p class="Para" id="Par47"><span id="ITerm36"><span class="EmphasisFontCategoryNonProportional ">aws_security_group</span></span> controls networking access to the Kubernetes masters. You then configure this with an <span class="EmphasisFontCategoryNonProportional ">ingress</span> rule to allow traffic from the worker nodes. In both <span class="EmphasisFontCategoryNonProportional ">egress</span> and <span class="EmphasisFontCategoryNonProportional ">ingress</span>, you specify the protocol. Here, the IP protocol name (<span class="EmphasisFontCategoryNonProportional ">tcp</span>, <span class="EmphasisFontCategoryNonProportional ">udp</span>, <span class="EmphasisFontCategoryNonProportional ">icmp</span>) or number for the protocol can be used. When you specify -<span class="EmphasisFontCategoryNonProportional ">1</span> in the <span class="EmphasisFontCategoryNonProportional ">egress</span>, or when you specify a protocol number other than <span class="EmphasisFontCategoryNonProportional ">tcp</span>, <span class="EmphasisFontCategoryNonProportional ">udp</span>, <span class="EmphasisFontCategoryNonProportional ">icmp</span>, or <span class="EmphasisFontCategoryNonProportional ">58</span> (ICMPv6), traffic on all ports is allowed, regardless of any ports you specify. For <span class="EmphasisFontCategoryNonProportional ">tcp</span>, <span class="EmphasisFontCategoryNonProportional ">udp</span>, and <span class="EmphasisFontCategoryNonProportional ">icmp</span>, you must specify a port range. For protocol <span class="EmphasisFontCategoryNonProportional ">58</span> (ICMPv6), you can optionally specify a port range. If you don’t specify anything, traffic of all types and codes is allowed.</p>

          <p class="Para" id="Par48"><span class="EmphasisFontCategoryNonProportional ">aws_security_group_rule</span> allows the worker nodes networking access to the EKS master cluster.</p>

          <div class="Para" id="Par49">Next is the <span id="ITerm37">worker nodes configuration</span>. AWS EKS does not currently provide managed resources for running worker nodes. Hence, you need to create a few operator-managed resources so that Kubernetes can properly manage other AWS services, networking access, and so on.<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">resource "aws_iam_role" "demo-node" {</div><div class="FixedLine">  name = "terraform-eks-demo-node"</div></div><div class="LineGroup"><div class="FixedLine">  assume_role_policy = &lt;&lt;POLICY</div><div class="FixedLine">{</div><div class="FixedLine">  "Version": "2012-10-17",</div><div class="FixedLine">  "Statement": [</div><div class="FixedLine">    {</div><div class="FixedLine">      "Effect": "Allow",</div><div class="FixedLine">      "Principal": {</div><div class="FixedLine">        "Service": "ec2.amazonaws.com"</div><div class="FixedLine">      },</div><div class="FixedLine">      "Action": "sts:AssumeRole"</div><div class="FixedLine">    }</div><div class="FixedLine">  ]</div><div class="FixedLine">}</div><div class="FixedLine">POLICY</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_iam_role_policy_attachment" "demo-node-AmazonEKSWorkerNodePolicy" {</div><div class="FixedLine">  policy_arn = "arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy"</div><div class="FixedLine">  role       = aws_iam_role.demo-node.name</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_iam_role_policy_attachment" "demo-node-AmazonEKS_CNI_Policy" {</div><div class="FixedLine">  policy_arn = "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy"</div><div class="FixedLine">  role       = aws_iam_role.demo-node.name</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_iam_role_policy_attachment" "demo-node-AmazonEC2ContainerRegistryReadOnly" {</div><div class="FixedLine">  policy_arn = "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"</div><div class="FixedLine">  role       = aws_iam_role.demo-node.name</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">resource "aws_eks_node_group" "demo" {</div><div class="FixedLine">  cluster_name    = aws_eks_cluster.demo.name</div><div class="FixedLine">  node_group_name = "demo"</div><div class="FixedLine">  node_role_arn   = aws_iam_role.demo-node.arn</div><div class="FixedLine">  subnet_ids      = aws_subnet.demo[*].id</div></div><div class="LineGroup"><div class="FixedLine">  scaling_config {</div><div class="FixedLine">    desired_size = 1</div><div class="FixedLine">    max_size     = 1</div><div class="FixedLine">    min_size     = 1</div><div class="FixedLine">  }</div></div><div class="LineGroup"><div class="FixedLine">  depends_on = [</div><div class="FixedLine">    aws_iam_role_policy_attachment.demo-node-AmazonEKSWorkerNodePolicy,</div><div class="FixedLine">    aws_iam_role_policy_attachment.demo-node-AmazonEKS_CNI_Policy,</div><div class="FixedLine">    aws_iam_role_policy_attachment.demo-node-AmazonEC2ContainerRegistryReadOnly,</div><div class="FixedLine">  ]</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-7</span><p class="SimplePara">Terraform EKS Worker <span id="ITerm38">Configuration</span> (ch15/ch15-01/eks-worker-nodes.tf)</p></div></div></div></div>

          <p class="Para" id="Par50">As stated earlier, you are running with a minimal number in the <span id="ITerm39">scaling configuration</span> even though in production deployments you may want to have three or more nodes for high availability. The <span class="EmphasisFontCategoryNonProportional ">aws_eks_node_group</span> <span id="ITerm40">resource</span> will manages an EKS node group, which can provision and optionally update an auto-scaling group of Kubernetes worker nodes compatible with EKS.</p>

          <p class="Para" id="Par51">The <span id="ITerm41"><span class="EmphasisFontCategoryNonProportional ">aws_iam_role</span></span> and policy will allow the worker nodes to manage or retrieve data from other AWS services. It is used by Kubernetes to allow worker nodes to join the cluster.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec8">

          <h3 class="Heading">Setups Required to Operate an EKS Cluster</h3>

          <p class="Para" id="Par52">There are a few <span id="ITerm42">setups</span> that come in handy when managing and operating an EKS. I list them here. You may also refer to Appendix F to see a few of these setups in detail.</p>

          <div class="Para" id="Par53">You are advised to do the following:<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent"><p class="Para" id="Par54">Install AWS CLI.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent"><p class="Para" id="Par55">Install AWS IAM Authenticator.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent"><p class="Para" id="Par56">Configure <span class="EmphasisFontCategoryNonProportional ">kunectl</span> for EKS.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">4.</div><div class="ItemContent"><p class="Para" id="Par57">Join the worker nodes to the Kubernetes cluster.</p></div><div class="ClearBoth"> </div></li></ol></div></div>

          <p class="Para" id="Par58">Start by completing the first two steps. Subsequently you may complete the next subsection titled “Build and Spin Your EKS Cluster in AWS,” and once the EKS cluster is formed, you can execute the last two steps.</p>

        </section>

        <section class="Section2 RenderAsSection2" id="Sec9">

          <h3 class="Heading">Build and Spin Your EKS Cluster in AWS</h3>

          <div class="Para" id="Par59">To form an EKS cluster in <span id="ITerm43">AWS</span>, you need to go to the root folder <span class="EmphasisFontCategoryNonProportional ">ch15\ch15-01</span> and run the <span class="EmphasisFontCategoryNonProportional ">terraform init</span> command first. See Listing <span class="InternalRef"><a href="#PC8">15-8</a></span>.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-04/Code/ch15/ch15-01</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$ terraform init</div></div><div class="LineGroup"><div class="FixedLine">Initializing the backend...</div><div class="FixedLine">...</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-8</span><p class="SimplePara">Terraform init</p></div></div></div></div>

          <div class="Para" id="Par60">You then sanity check your code. See Listing <span class="InternalRef"><a href="#PC9">15-9</a></span>.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-04/Code/ch15/ch15-01</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$ terraform validate</div><div class="FixedLine">Success! The configuration is valid.</div></div><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-9</span><p class="SimplePara">Terraform validate</p></div></div></div></div>

          <div class="Para" id="Par61">The <span class="EmphasisFontCategoryNonProportional ">plan</span> <span id="ITerm44">command</span> lets you see what Terraform will do before making any changes, as shown in Listing <span class="InternalRef"><a href="#PC10">15-10</a></span>.<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$ terraform plan</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-10</span><p class="SimplePara"><span id="ITerm45">Terraform plan</span><span id="ITerm46"></span></p></div></div></div></div>

          <div class="Para" id="Par62">The <span class="EmphasisFontCategoryNonProportional ">apply</span> <span id="ITerm47">command</span> shows you the same plan output and asks you to confirm whether you want to proceed with this plan, as shown in Listing <span class="InternalRef"><a href="#PC11">15-11</a></span>.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:001-aws-eks-tf binil$ terraform apply</div><div class="FixedLine">aws_eks_node_group.demo: Creation complete after 2m12s [id=bdca-tf-eks-01:demo]</div></div><div class="LineGroup"><div class="FixedLine">Apply complete! Resources: 18 added, 0 changed, 0 destroyed.</div></div><div class="LineGroup"><div class="FixedLine">Outputs:</div></div><div class="LineGroup"><div class="FixedLine">config_map_aws_auth = &lt;&lt;EOT</div><div class="FixedLine">apiVersion: v1</div><div class="FixedLine">kind: ConfigMap</div><div class="FixedLine">...</div><div class="FixedLine">EOT</div><div class="FixedLine">(base) binildass-MacBook-Pro:001-aws-eks-tf binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-11</span><p class="SimplePara"><span id="ITerm48">Terraform apply</span><span id="ITerm49"></span></p></div></div></div></div>

          <p class="Para" id="Par63">You can now apply the commands mentioned previously in Steps 3 and 4 (configure kunectl for <span id="ITerm50">EKS</span> and Join the worker nodes to Kubernetes cluster). Then watch the status of your nodes and wait for them to reach the Ready status. Refer to Appendix F for more information.</p>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec10">

        <h2 class="Heading">Deploying Containers in AWS EKS</h2>

        <p class="Para" id="Par64">This example uses a relatively simple microservice you have seen in this book, from <span class="EmphasisFontCategoryNonProportional ">ch01/ch01-01/</span>. I assume that you have executed the required commands, in Listings <span class="ExternalRef"><a href="Capítulo-09.html#PC41"><span class="RefSource">7-41</span></a></span> through <span class="ExternalRef"><a href="Capítulo-09.html#PC43"><span class="RefSource">7-43</span></a></span> in Chapter <span class="ExternalRef"><a href="Capítulo-09.html"><span class="RefSource">7</span></a></span>, and that you already have the <span class="EmphasisFontCategoryNonProportional ">binildas/product-web</span> image in the public Docker Hub.</p>

        <p class="Para" id="Par65">You will use this image in <span id="ITerm51">Docker Hub</span> and deploy it to the AWS EKS.</p>

        <div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1">

          <div class="Heading">Note</div>

          <p class="Para FirstParaInFormalPara" id="Par66">This example assumes that <span class="EmphasisFontCategoryNonProportional ">kubectl</span> is configured for the EKS cluster.</p>

        </div>

        <div class="Para" id="Par67">You might have noticed that <span id="ITerm52"><span class="EmphasisFontCategoryNonProportional ">product-deployment.yaml</span></span> and <span id="ITerm53"><span class="EmphasisFontCategoryNonProportional ">product-service.yaml</span></span> are already in the EKS terraform project root folder <span class="EmphasisFontCategoryNonProportional ">ch15/ch15-01/</span>. They are shown in Listings <span class="InternalRef"><a href="#PC12">15-12</a></span> and <span class="InternalRef"><a href="#PC13">15-13</a></span>.<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">apiVersion: apps/v1</div><div class="FixedLine">kind: Deployment</div><div class="FixedLine">metadata:</div><div class="FixedLine">  name: product-deployment</div><div class="FixedLine">  labels:</div><div class="FixedLine">    app: product</div><div class="FixedLine">spec:</div><div class="FixedLine">  replicas: 1</div><div class="FixedLine">  selector:</div><div class="FixedLine">    matchLabels:</div><div class="FixedLine">      app: product</div><div class="FixedLine">  template:</div><div class="FixedLine">    metadata:</div><div class="FixedLine">      labels:</div><div class="FixedLine">        app: product</div><div class="FixedLine">    spec:</div><div class="FixedLine">      containers:</div><div class="FixedLine">      - name: product</div><div class="FixedLine">        image: binildas/product-web</div><div class="FixedLine">        ports:</div><div class="FixedLine">        - containerPort: 8080</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-12</span><p class="SimplePara">Product Web Microservice Deployment Description (ch15/ch15-01/product-deployment.yaml)</p></div></div></div><div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">apiVersion: v1</div><div class="FixedLine">kind: Service</div><div class="FixedLine">metadata:</div><div class="FixedLine">  name: product-service-loadbalancer</div><div class="FixedLine">spec:</div><div class="FixedLine">  type: LoadBalancer</div><div class="FixedLine">  selector:</div><div class="FixedLine">    app: product</div><div class="FixedLine">  ports:</div><div class="FixedLine">    - protocol: TCP</div><div class="FixedLine">      port: 8080</div><div class="FixedLine">      targetPort: 8080</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-13</span><p class="SimplePara"><span id="ITerm54">Product Web Microservice Service Description</span> (ch15/ch15-01/product-service.yaml)</p></div></div></div></div>

        <div class="Para" id="Par68">You can now deploy the specified microservice, as shown in Listing <span class="InternalRef"><a href="#PC14">15-14</a></span>.<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl get pods -l 'app=nginx' -o wide | awk {'print $1" " $3 " " $6'} | column -t</div><div class="FixedLine">No resources found in default namespace.</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl get pods -l 'app=product' -o wide | awk {'print $1" " $3 " " $6'} | column -t</div><div class="FixedLine">No resources found in default namespace.</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl apply -f product-deployment.yaml</div><div class="FixedLine">deployment.apps/product-deployment created</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl get pods -l 'app=product' -o wide | awk {'print $1" " $3 " " $6'} | column -t</div><div class="FixedLine">NAME                                STATUS             IP</div><div class="FixedLine">product-deployment-84b9777c5-9kpz8  ContainerCreating  &lt;none&gt;</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl get pods -l 'app=product' -o wide | awk {'print $1" " $3 " " $6'} | column -t</div><div class="FixedLine">NAME                                STATUS   IP</div><div class="FixedLine">product-deployment-84b9777c5-9kpz8  Running  10.0.0.180</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-14</span><p class="SimplePara">Deploying a Product Web Microservice Image into <span id="ITerm55">EKS</span> (ch15/ch15-01/product-deployment.yaml)</p></div></div></div></div>

        <div class="Para" id="Par69">As shown in Listing <span class="InternalRef"><a href="#PC14">15-14</a></span>, you first assert that you don’t have any valid deployments in your newly formed EKS and subsequently deploy the new container. Once the deployment is ready, you can then deploy the service definition. See Listing <span class="InternalRef"><a href="#PC15">15-15</a></span>.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl get svc</div><div class="FixedLine">NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</div><div class="FixedLine">kubernetes   ClusterIP   172.20.0.1   &lt;none&gt;        443/TCP   11m</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl create -f product-service.yaml</div><div class="FixedLine">service/product-service-loadbalancer created</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ kubectl get svc</div><div class="FixedLine">NAME                           TYPE           CLUSTER-IP      EXTERNAL-IP           PORT(S)          AGE</div><div class="FixedLine">kubernetes                     ClusterIP      172.20.0.1      &lt;none&gt;                443/TCP          12m</div><div class="FixedLine">product-service-loadbalancer   LoadBalancer   172.20.15.199   a2473f05176a6444bb676cf3927fd363-1434093128.ap-southeast-1.elb.amazonaws.com         8080:32087/TCP   49s</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-15</span><p class="SimplePara">Exposing Product Web Microservice Service in <span id="ITerm56">EKS</span> (ch15/ch15-01/product-service.yaml)</p></div></div></div></div>

        <div class="Para" id="Par70">Once all is set, you are ready to test the example. You can also view the EKS console using the appropriate URL formation, which in my case is as follows:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">https://ap-southeast-1.console.aws.amazon.com/eks/home?region=ap-southeast-1#/clusters</div></div></div></div>

        <section class="Section2 RenderAsSection2" id="Sec11">

          <h3 class="Heading">Testing the Microservice in EKS</h3>

          <p class="Para" id="Par71">Once the microservice is up in the EKS <span id="ITerm57">cluster</span> in the AWS Cloud, you can access the web application by using your browser. Point to the application URL, which you can determine from the AWS UI console.</p>

          <div class="Para" id="Par72">You can test the microservice using the URL in Listing <span class="InternalRef"><a href="#PC17">15-16</a></span> in a browser.<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">http://a2473f05176a6444bb676cf3927fd363-1434093128.ap-southeast-1.elb.amazonaws.com:8080/product.html</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-16</span><p class="SimplePara">Testing the Service in EKS Using a Browser</p></div></div></div></div>

          <div class="Para" id="Par73">You can also test the service using cURL, as shown in Listing <span class="InternalRef"><a href="#PC18">15-17</a></span>.<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$ curl -silent http://a2473f05176a6444bb676cf3927fd363-1434093128.ap-southeast-1.elb.amazonaws.com:8080/product.html | grep title</div><div class="FixedLine">&lt;title&gt;Bootstrap CRUD Data Table for Database with Modal Form&lt;/title&gt;</div><div class="FixedLine">    .table-title {</div><div class="FixedLine">    .table-title h2 {</div><div class="FixedLine">    .table-title .btn-group {</div><div class="FixedLine">    .table-title .btn {</div><div class="FixedLine">    .table-title .btn i {</div><div class="FixedLine">    .table-title .btn span {</div><div class="FixedLine">    .modal .modal-title {</div><div class="FixedLine">            &lt;div class="table-title"&gt;</div><div class="FixedLine">                            &lt;td&gt;&lt;span ng-bind="p.title"&gt;&lt;/span&gt;&lt;/td&gt;</div><div class="FixedLine">                                    data-toggle="tooltip" title="Edit"&gt;&amp;#xE254;&lt;/i&gt;&lt;/a&gt; &lt;a</div><div class="FixedLine">                                    class="material-icons" data-toggle="tooltip" title="Delete" ng-click="openDeleteForm(p)"&gt;&amp;#xE872;&lt;/i&gt;&lt;/a&gt;</div><div class="FixedLine">                        &lt;h4 class="modal-title"&gt;Product Details&lt;/h4&gt;</div><div class="FixedLine">                            &lt;textarea class="form-control" ng-model="product.title" required&gt;&lt;/textarea&gt;</div><div class="FixedLine">                        &lt;h4 class="modal-title"&gt;Delete Product&lt;/h4&gt;</div><div class="FixedLine">(base) binildass-MBP:ch15-01 binil$</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-17</span><p class="SimplePara">Testing the <span id="ITerm58">Service</span> in EKS Using cURL</p></div></div></div></div>

          <div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2">

            <div class="Heading">Note</div>

            <p class="Para FirstParaInFormalPara" id="Par74">Do not forget to release the AWS resources once your testing is finished, because unreleased resources might drain your credit card!</p>

          </div>

          <div class="Para" id="Par75">Once the testing is <span id="ITerm59">complete</span>, you can destroy the cloud infrastructure using the <span class="EmphasisFontCategoryNonProportional ">terraform destroy</span> command, as in Listing <span class="InternalRef"><a href="#PC19">15-18</a></span>.<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$ pwd</div><div class="FixedLine">/Users/binil/binil/code/mac/mybooks/docker-04/Code/ch15/ch15-01</div><div class="FixedLine">(base) binildass-MacBook-Pro:ch15-01 binil$ terraform destroy</div><div class="FixedLine">...</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 15-18</span><p class="SimplePara">Releasing AWS Resources</p></div></div></div></div>

        </section>

      </section>

      <section class="Section1 RenderAsSection1" id="Sec12">

        <h2 class="Heading">Summary</h2>

        <p class="Para" id="Par76">Every end is a new beginning. You have reached the end of this book; however, you have just started your microservices and cloud journey. I demystified a few dilemmas around architecture choices and investigated many details. You started with the simplest microservice example in Chapter <span class="ExternalRef"><a href="Capítulo-03.html"><span class="RefSource">1</span></a></span>, and as you pause your journey in Chapter <span class="ExternalRef"><a href="Capítulo-17.html"><span class="RefSource">15</span></a></span>, you have even deployed this microservice container to EKS in the cloud.</p>

        <p class="Para" id="Par77">I hope you have enjoyed many parts of this book in the same way I have enjoyed getting into the intricacies of the code to explain them. I have tried to balance theory with code to give you a hands-on feel of almost all the concepts explained. Frameworks will come and go, and specifications will keep evolving, since “change is the only constant thing.” However, the architectural foundations discussed throughout the book will still be relevant and valid—at least that is what I have experienced in my 25-plus years in IT. Keep moving and keep a fast pace.</p>

      </section>

      <aside aria-label="Footnotes" class="FootnoteSection" epub:type="footnotes">

        <div class="Heading">Footnotes</div>

        <div class="Footnote"><span class="FootnoteNumber"><a href="#Fn1_source">1</a></span><div class="FootnoteContent" epub:type="footnote" id="Fn1" role="doc-footnote"><p class="Para" id="Par19"><em class="EmphasisTypeItalic ">Programming Amazon EC2,</em> O’Reilly Media; ISBN-13: 978-1449393687.</p></div><div class="ClearBoth"> </div></div>

      </aside>

    </div>

  </div>

</body>

</html>